!function(e){e.Polyline.prototype.getLength=function(){var e=0,t=null;return this._latlngs.forEach(function(n,o,i){t=n,o&&(e+=t.distanceTo(i[o-1]))}),e}}(L),function(e,t){"use strict";e.module("geo.map",[]).directive("geoMap",["$rootScope","mapService","waiting",function(e,t,n){var o;return{restrict:"AE",scope:{configuration:"="},controller:["$q","$scope",function(e,t){this.getMap=function(){return t.map?void e.when(t.map):(o||(o=n.wait()),o.waiter().promise)}}],link:function(e,n){e.$watch("configuration",function(i){i&&(i.element=n[0],e.map=t.addMap(i),o&&o.resolve(e.map))})}}}]).factory("mapService",["$q","waiting",function(n,o){function i(t){var n=[];return e.isArray(t.type)?(n=L,t.type.forEach(function(e){n=n[e]})):n=L[t.type],t.parameters&&t.parameters.length>0?new n(t.parameters[0],t.parameters[1],t.parameters[2],t.parameters[3],t.parameters[4]):new n}var a,r,s="MAP_",l=0,c={maps:{}};return c.getMap=function(e){return e||(e=a),a?n.when(c.maps[e]):(r||(r=o.wait()),r.waiter().promise)},c.addMap=function(e){var n,o,u=null;return e.name||(e.name=s+l++),a=e.name,n=c.maps[e.name]=new L.Map(e.element,{center:e.options.center,zoom:e.options.zoom}),e.layers&&e.layers.forEach(function(e){var t=i(e);t.pseudoBaseLayer=e.pseudoBaseLayer,e.addLayerControl&&(u||(u={}),u[e.name]=t),(e.defaultLayer||e.pseudoBaseLayer)&&n.addLayer(t),u&&n.addControl(new L.Control.Layers(u,{}))}),L.control.scale({imperial:!1}).addTo(n),L.control.mousePosition({position:"bottomright",emptyString:"",separator:" ",latFormatter:function(e){return"Lat "+L.Util.formatNum(e,5)+"°"},lngFormatter:function(e){return"Lng "+L.Util.formatNum(e,5)+"°"}}).addTo(n),o=L.control.zoomBox({}),n.addControl(o),t.map=n,r&&r.resolve(n),n.addControl(L.control.legend()),n},c.zoomTo=function(e,t){this.getMap().then(function(n){n.panTo([e,t],{animate:!0})})},c}])}(angular,window),function(e){"use strict";e.module("fairways.add.route",["openLayers.service","explorer.persist","explorer.flasher","explorer.config"]).directive("fairwaysRoutes",["$timeout","mapService","flashService","routeService",function(e,t,n,o){var i={type:"ROAD",name:"",description:"",wkt:""};return{templateUrl:"components/addroute/routeManager.html",restrict:"AE",scope:{item:"="},link:function(a,r,s){a.distanceMeasure={distance:"-"},o.getConfig().then(function(e){a.types={},e.routeTypes.forEach(function(e){a.types[e.code]=e.title})}),o.getRoutes().then(function(e){e?(e.forEach(function(e){o.addToMap(e)}),a.routes=e):a.routes=[]}),a.showAddRoute=function(){a.addRoute=!0,a.newRoute=Object.create(i),n.add("Click on map to start a path or add next point. Double click to end path.",4e3),t.showDistance(null,{endOnDblClick:!0,geometry:a.lastGeometry},function(t,n){a.$apply(function(){n&&e(a.setWkt,100),a.distanceMeasure.distance=t?t:"-"})})},a.showElevation=function(){o.showElevation(this.route.layer)},a.panToVector=function(){o.panTo(this.route.layer)},a.mouseenter=function(){o.overFeatures(this.route)},a.mouseleave=function(){o.outFeatures(this.route)}},controller:["$scope",function(e){e.setWkt=function(){var n=t.getDistanceGeometry();e.newRoute.wkt=(new OpenLayers.Format.WKT).write(new OpenLayers.Feature.Vector(n))},e.toggleRoute=function(){this.route.showing=o.toggleRoute(this.route.layer)},e.removeRoute=function(){var e=this.routes.indexOf(this.route);o.removeRoute(this.route),this.routes.splice(e,1),o.saveRoutes(this.routes)},e.cancelRoute=function(){e.addRoute=!1},e.saveRoute=function(){o.removeDrawTool(),e.addRoute=!1,e.routes.push(e.newRoute),o.saveRoutes(e.routes),n.add("Succesfully added route to collection"),o.addToMap(e.newRoute)}}]}}]).factory("routeService",["$q","$rootScope","mapService","persistService","configService",function(t,n,o,i,a){var r={stroke:!0,strokeColor:"#000000",strokeDashstyle:"4 4",strokeOpacity:.7,strokeWidth:1.5};return{addToMap:function(n){t.all([this.getConfig(),o.getMap()]).then(function(t){var o,i,a,s=(t[1],t[0]),l=(new OpenLayers.Format.WKT).read(n.wkt);s.routeTypes.some(function(e){var t=n.type==e.code;return t&&(a=e.lineStyle),t})||(a=r),i=new OpenLayers.StyleMap({"default":new OpenLayers.Style(a)}),o=new OpenLayers.Layer.Vector("Your route: "+n.name,{styleMap:i}),l=e.isArray(l)?l:[l],o.addFeatures(l),n.control=new OpenLayers.Control.SelectFeature(o,{hover:!0,highlightOnly:!0,clickOut:!1,toggle:!0,renderIntent:"temporary",eventListeners:{}}),n.layer=o})},removeDrawTool:function(){o.hideDistance()},removeRoute:function(e){var t=e.layer;t.map&&t.map.removeLayer(t),t.destroy()},toggleRoute:function(e){var t=!!e.map;return t?e.map.removeLayer(e):o.getMap().then(function(t){t.addLayers([e])}),!t},getConfig:function(){return a.getConfig()},getRoutes:function(){return i.getItem("fwsRoutes")},saveRoutes:function(e){function t(e){var t=[];return e.forEach(function(e){t.push({type:e.type,name:e.name,description:e.description,wkt:e.wkt})}),t}i.setItem("fwsRoutes",t(e))},showElevation:function(e,t){t||(t=e.features[0]);var o=t.geometry,i=o.clone().transform(new OpenLayers.Projection("EPSG:3857"),new OpenLayers.Projection("EPSG:4326")).getGeodesicLength(),a={length:i,geometry:o,heading:"KML"};n.$broadcast("elevation.plot.data",a)},overFeatures:function(e){var t,n=e.layer.features;n&&(t=n[0].layer,t&&(t.removeFeatures(n),t.addFeatures(n),n.forEach(function(t){e.control.overFeature(t)})))},outFeatures:function(e){var t=e.layer.features;t&&t.forEach(function(t){t.layer&&e.control.outFeature(t)})},panTo:function(e){var t=this._boundsPlusPercent(e.getDataExtent(),.2);o.getMap().then(function(e){e.zoomToExtent(t)})},_boundsPlusPercent:function(e,t){var n=(e.right-e.left)*t,o=(e.top-e.bottom)*t;return new OpenLayers.Bounds(e.left-n,e.bottom-o,e.right+n,e.top+o)}}}])}(angular),function(e){"use strict";e.module("geo.baselayer.control",["geo.maphelper","geo.map","ui.bootstrap-slider"]).directive("geoBaselayerControl",["$rootScope","mapHelper","mapService",function(e,t,n){return{template:'<slider min="0" max="1" step="0.1" ng-model="slider.opacity" updateevent="slideStop"></slider>',link:function(e,o){e.slider={opacity:1,visibility:!0,lastOpacity:1},t.getPseudoBaseLayer().then(function(t){e.layer=t,e.slider.opacity=t.options.opacity,e.$watch("slider.opacity",function(t,n){e.layer.setOpacity(t)})}),n.getMap().then(function(t){function n(){var n=t.getZoom();e.lastZoom<12&&(e.lastOpacity=e.layer.options.opacity),12==n?(e.lastZoom>12?e.lastOpacity<.5?(e.slider.opacity=e.lastOpacity,e.layer.setOpacity(e.lastOpacity)):(e.slider.opacity=.5,e.layer.setOpacity(.5)):e.slider.opacity>.5&&(e.slider.opacity=.5,e.layer.setOpacity(.5)),e.slider.visibility=!1,i(!1)):12>n?(e.lastZoom<=12&&(e.slider.opacity=e.lastOpacity,e.layer.setOpacity(e.lastOpacity)),i(!0)):n>12&&e.lastZoom<13&&(e.slider.visibility=!1,e.slider.opacity=0,i(!1)),e.lastZoom=n}function i(e){$(o).find(".slider-input").eq(0).slider(e?"enable":"disable")}t.on("zoomend",n)})}}}]).run(["$rootScope","mapService","flashService",function(e,t,n){var o;t.getMap().then(function(t){t.oldZoomTo=t.zoomTo,t.zoomTo=function(i){this.layers.forEach(function(a){if(a.pseudoBaseLayer&&a.visibility){var r=t.zoom,s=.4,l=a.numZoomLevels,c=i>l-2,u=l-1>i,h=i==l-2,d=l-1>r,p=r==l-2,f=i>r,m=r>i;f?i+1>=l&&!o&&(o=!0,n.add("No detail available at this scale for "+a.name,3e3),e.$broadcast("overlay.has.detail",!1)):o=!1,u&&e.$broadcast("overlay.has.detail",!0),f&&d&&(!h&&!c||p||(a.restoreOpacity=a.opacity),a.opacity>=s&&h&&a.setOpacity(s)),c&&a.opacity&&a.setOpacity(0),m&&u&&(h?a.opacity||a.setOpacity(a.restoreOpacity<s?a.restoreOpacity:s):a.restoreOpacity&&(a.setOpacity(a.restoreOpacity),a.restoreOpacity=null))}}),this.oldZoomTo(i)}})}])}(angular),function(e){"use strict";e.module("mars.clip",["explorer.asynch","openLayers.service","explorer.flasher","explorer.httpdata","explorer.message","explorer.persist"]).directive("marsClip",["$filter","clipService","flashService","messageService",function(e,t,n,o){return{restrict:"AE",scope:{item:"="},templateUrl:"components/clip/clip.html?v=2",link:function(i,a,r){i.noRfcSelector=function(){i.rfcSelector=!1,t.deactivateBoundingBox(),i.item=""},i.$watch("item",function(a,r){"clip"==r?t.deactivateBoundingBox():"clip"==a&&(t.activateBoundingBox().then(function(t){var n=t.clone().toGeometry().getGeodesicArea()/1e6;return n>1e4?(o.error("You selected an area of size "+e("number")(n,0)+" sq km, reduce to under 10,000 sq km."),void(i.item="")):(i.extent=t,void(i.rfcSelector=!0))}),n.add("Drag the mouse across an area of interest...",4e3))})}}}]).directive("marsRfcSelector",["$log","$modal","flashService","clipService","persistService",function(t,n,o,i,a){return{scope:{extent:"=",hide:"=",selector:"="},link:function(r,s){var l;r.$watch("selector",function(s,c){function u(e){t.info("Confirmed : "+e),e&&r.success(),r.selector=!1,r.hide()}s&&(o.add("Select the reference feature classes that you want to download.",4e3),r.confirmed=!1,l=n.open({templateUrl:"components/clip/rfcSelector.html?v=3",size:"sm",backdrop:"static",keyboard:!1,controller:["$scope","$modalInstance",function(t,n){function s(){t.email!=t.oldEmail&&(a.setItem("email",t.email),t.oldEmail=t.email),n.dismiss("cancel")}i.getClipShipAndZipClasses().then(function(e){t.featureClasses=e,a.getItem("rfcSelected").then(function(e){e&&e.forEach(function(e){t.featureClasses[e.key]&&(t.featureClasses[e.key].clipSelected=e.value)})})}),a.getItem("email").then(function(e){t.email=e,t.oldEmail=e}),t.startClipZipShip=function(){var n=o.add("Initiating clip, ship and zip process.",5e3),l=[],c=[];e.forEach(t.featureClasses,function(e,t){e.clipSelected&&(c.push({key:t,value:!0}),l.push({data:e,key:t}))}),a.setItem("rfcSelected",c),i.initiateShipZip(l,r.extent,t.email).then(function(){n.text="Clip ship and zip process initiated succesfully",s()})},t.cancel=function(){s()}}],resolve:{message:function(){return r.expConfirm}}}),l.result.then(function(e){u(e)},function(e){u(!1)}))})}}}]).factory("clipService",["$log","$q","asynch","mapService","httpData",function(e,t,n,o,i){var a,r=null,s=null,l=null,c="resources/config/clipShipaAndZipClasses.json?v=1";return{getClipShipAndZipClasses:function(){return i.get(c,{cache:!0})},initiateShipZip:function(e,t,o){var i,a=(new OpenLayers.Format.WKT).write(new OpenLayers.Feature.Vector(t.toGeometry())),r=[],s=[];return e.forEach(function(e){r.push(e.key),s.push(e.data.label)}),i={now:Date.now(),left:t.left,right:t.right,top:t.top,bottom:t.bottom,envelope:a,to:o,names:s.join(","),fcList:r.join(","),f:"json",spatialRef:4326,returnM:!1,returnZ:!1},n("clipZipShip",i,{urlEncoded:!0,noWait:!0,timeToLive:30})},activateBoundingBox:function(){function n(){e.debug("Bounding box drawn"),o.getMap().then(function(){var e=s.features[0],t=e.geometry.clone().transform(new OpenLayers.Projection("EPSG:3857"),new OpenLayers.Projection("EPSG:4326")).getBounds();r.deactivate(),l&&(map.removeLayer(l),l.destroy()),l=s.clone(),l.name="Drawn clip, ship and zip extent.",map.addLayer(l),s.destroyFeatures(),a.resolve(t)})}return a=t.defer(),null===r?(s=new OpenLayers.Layer.Vector("Prepare clip ship and zip extent"),r=new OpenLayers.Control.DrawFeature(s,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:!0},featureAdded:n}),o.getMap().then(function(e){e.addLayer(s),e.addControl(r),r.activate()})):r.activate(),a.promise},deactivateBoundingBox:function(){this.isActiveBoundingBox()&&r.deactivate(),s&&s.removeAllFeatures(),l&&l.removeAllFeatures()},isActiveBoundingBox:function(){return null!==r&&r.active},destroyBoundingBox:function(){r&&o.getMap().then(function(e){e.removeControl(r),e.removeLayer(s),r.destroy(),r=s=null,l&&(e.removeLayer(l),l.destroy(),l=null)})}}}]).filter("noClipSelected",[function(t){return function(t){var n=!1;return e.forEach(t,function(e){n|=e.clipSelected}),!n}}])}(angular),function(e,t){"use strict";e.module("explorer.crosshair",["geo.map"]).factory("crosshairService",["mapService",function(e){var n,o;return e.getMap().then(function(e){n=e}),{add:function(e){this.move(e)},remove:function(){o&&(n.removeLayer(o),o=null)},move:function(e){var i;if(e)return this.remove(),i=t.icon({iconUrl:"resources/img/cursor-crosshair.png",iconAnchor:[16,16]}),o=t.marker([e.y,e.x],{icon:i}),o.addTo(n),e}}}])}(angular,L),function(e,t){"use strict";e.module("geo.draw",["geo.map"]).directive("geoDraw",["$log","$rootScope","mapService",function(n,o,i){var a={rectangleEvent:"geo.draw.rectangle.created",lineEvent:"geo.draw.line.created"};return{restrict:"AE",scope:{data:"=",rectangleEvent:"@",lineEvent:"@"},link:function(r,s,l,c){e.forEach(a,function(e,t){r[t]||(r[t]=e)}),i.getMap().then(function(i){var a,s=new t.FeatureGroup,l={edit:{featureGroup:s}};r.data&&e.extend(l,r.data),r.drawnItems=s,i.addLayer(s),a=new t.Control.Draw(l),i.addControl(a),i.on("draw:created",function(e){r.$apply(function(){({polyline:function(){var t={length:e.layer.getLength(),geometry:e.layer.getLatLngs()};o.$broadcast(r.lineEvent,t)},rectangle:function(){n.info("rect")}})[e.layerType]()})})})}}}])}(angular,L),function(e,t,n){"use strict";e.module("geo.elevation",["graph","explorer.crosshair","explorer.flasher","explorer.feature.summary","geo.map","geo.path"]).directive("pathElevationPlot",["$log","$timeout","$rootScope","$filter","elevationService","crosshairService","featureSummaryService",function(e,t,n,o,i,a,r){var s={fill:"orange",fillOpacity:.4,stroke:"darkred",strokeWidth:1.5},l={fill:"lightblue",fillOpacity:.8,stroke:"darkblue",strokeWidth:1.5},c='<span><img alt="Waiting..." src="resources/img/tinyloader.gif" ng-show="message.spinner" style="position:relative;top:2px;" width="12"></img></span>';return{templateUrl:"map/elevation/elevation.html?v=2",scope:!0,controller:["$scope",function(e){e.paths=[],e.config={yLabel:"Elevation (m)",xLabel:"Distance: 3000m"},n.$on("elevation.plot.data",function(t,n){e.length=n.length,e.geometry=n.geometry,e.config.xLabel="Distance: "+n.length.toFixed(1)+"m",e.waterTable=null,e.length&&e.geometry&&(i.getElevation(e.geometry,e.length).then(function(t){e.elevation={style:s,data:t},e.config.leftText="Elevation Range: "+o("length")(d3.min(t,function(e){return e.z}),!0)+" - "+o("length")(d3.max(t,function(e){return e.z}),!0),e.paths=[e.elevation]}),i.intersectsWaterTable(e.geometry).then(function(t){e.intersectsWaterTable=t}))}),e.getInfoText=function(){e.infoText||(e.infoText=c,i.getInfoText().then(function(t){e.infoText=t}))},e.toggleWaterTable=function(){var n=e.paths.length;e.paths=[],e.waterTable?t(function(){e.paths=1==n?[e.elevation,e.waterTable]:[e.elevation]}):i.getWaterTable(e.geometry,e.length).then(function(t){e.waterTable={style:l,data:t},e.paths=[e.elevation,e.waterTable]})},e.close=function(){e.paths=e.geometry=e.length=null}}],link:function(t,n){function o(){t.line&&(t.line=i.pathHide(t.line)),t.geometry?t.line=i.pathShow(t.geometry):i.hideWaterTable()}function s(){e.info("Deferred view"),r.deferView(t.position).then(function(e){t.featuresUnderPoint=e})}function l(){e.info("Cancel deferred view"),r.cancelView(),t.featuresUnderPoint=null}t.graphClick=function(e){if(e.position){var n=e.position.points[0].point;i.panToPoint(n),t.point=n}},t.graphLeave=function(n){t.position=null,a.remove(),l(),e.debug("Mouse left"),t.mapListener&&(e.info("offMapMove"),r.offMapMove(t.mapListener))},t.graphEnter=function(t){e.debug("Graph be entered")},t.graphMove=function(n){var o;t.position=n.position,t.position&&(o=t.position.point,t.position.markerLonlat=a.move(o),s()),t.mapListener||(t.mapListener=function(){l(),s()},e.info("onMapMove"),r.onMapMove(t.mapListener)),e.debug("Mouse moving...")},t.$watch("geometry",o)}}}]).directive("marsInfoElevation",["$log","elevationService",function(e,t){return{templateUrl:"map/elevation/elevationInfo.html",scope:!0,link:function(e,n){e.toggleWaterTableShowing=function(){e.state=t.getState(),t.isWaterTableShowing()?t.hideWaterTable():t.showWaterTable()}}}}]).provider("elevationService",function(){var e,o=500,i="service/path/elevation",a="service/path/waterTable",r="service/artesianBasin/geometry/kml",s="service/artesianBasin/intersects",l=null,c={isWaterTableShowing:!1};this.setIntersectUrl=function(e){s=e},this.setKmlUrl=function(e){r=e},this.setElevationUrl=function(e){i=e},this.setWaterTableUrl=function(e){a=e},this.$get=["$log","$http","$q","mapService","flashService",function(u,h,d,p,f){p.getMap().then(function(t){e=t});var m={panToPoint:function(e){p.zoomTo(e.y,e.x)},getState:function(){return c},getElevation:function(e,n){var a=f.add("Retrieving elevation details...",8e3),r=t.Util.toLineStringWkt(e);return h.post(i,{wkt:r,count:o,distance:n}).then(function(e){return f.remove(a),e.data})},intersectsWaterTable:function(e){var n=s+(s.indexOf("?")>-1?"":"?wkt=");return h.get(n+t.Util.toLineStringWkt(e),{cache:!0}).then(function(e){return e.data.intersects})},isWaterTableShowing:function(){return c.isWaterTableShowing=null!==l},showWaterTable:function(){l||this.getWaterTableLayer().then(function(t){t.addTo(e)}),c.isWaterTableShowing=!0},hideWaterTable:function(){l&&e.removeLayer(l),l=null,c.isWaterTableShowing=!1},createWaterTableLayer:function(){return p.getMap().then(function(e){var t=new n.KML(r,{async:!0});return t.on("loaded",function(e){return l=e.target})})},getWaterTableLayer:function(){return this.createWaterTableLayer()},getWaterTable:function(e,n){var i=f.add("Retrieving water table details...",8e3),r=t.Util.toLineStringWkt(e);return h.post(a,{wkt:r,count:o,distance:n}).then(function(e){return f.remove(i),e.data})},getInfoText:function(){return h("map/elevation/elevationInfo.html",{cache:!0}).then(function(e){return e.data})},pathShow:function(t){var o=n.polyline(t,{color:"black",weight:2}).addTo(e);return o},pathHide:function(t){return e.removeLayer(t),null}};return m}]})}(angular,Exp,L),function(e){"use strict";e.Control.Legend=e.Control.extend({_active:!1,_map:null,includes:e.Mixin.Events,options:{position:"topleft",className:"fa fa-search-minus",modal:!1},onAdd:function(t){this._map=t,this._container=e.DomUtil.create("div","leaflet-zoom-box-control leaflet-bar"),this._container.title="Zoom out";var n=e.DomUtil.create("a",this.options.className,this._container);return n.href="#",t.on("zoomend",function(){t.getZoom()==t.getMaxZoom()?e.DomUtil.addClass(n,"leaflet-disabled"):e.DomUtil.removeClass(n,"leaflet-disabled")},this),t.on("boxzoomend",this.deactivate,this),e.DomEvent.on(this._container,"dblclick",e.DomEvent.stop).on(this._container,"click",e.DomEvent.stop).on(this._container,"click",function(){this._active=!this._active;var e,n=t.getZoom();n<=t.getMinZoom()||(e=10>n?n-1:13>n?n-2:n-3,t.setZoom(e))},this),this._container},activate:function(){e.DomUtil.addClass(this._container,"active")},deactivate:function(){e.DomUtil.removeClass(this._container,"active"),this._active=!1}}),e.control.zoomout=function(t){return new e.Control.Zoomout(t)};var t=e.control({position:"bottomright"}),n=e.control({position:"bottomright"});t.onAdd=function(t){var n=e.DomUtil.create("div","info legend");return n.innerHTML+='<img src="legend.png" alt="legend" width="134" height="147">',n},n.onAdd=function(t){var n=e.DomUtil.create("div","info legend");return n.innerHTML+='<img src="change_legend.png" alt="legend" width="134" height="147">',n},t.addTo(map),map.on("overlayadd",function(e){"Population"===e.name?(this.removeControl(n),t.addTo(this)):(this.removeControl(t),n.addTo(this))})}(L),function(e,t){"use strict";e.module("explorer.feature.summary",["geo.map"]).directive("expPointFeatures",["mapService","featureSummaryService",function(e,t){return{scope:{features:"="},link:function(e,n){e.$watch("features",function(n,o){e.features?t.showPopup(e.features):o&&t.hidePopup()})}}}]).directive("featuresUnderPoint",["$timeout","featureSummaryService","mapService",function(e,t,n){var o=400;return{restrict:"AE",scope:!0,link:function(i,a){n.getMap().then(function(n){function i(e){n.on("mousemove",s),n.on("mouseout",r)}function a(o){e.cancel(l),t.hidePopup(),n.off("mousemove",s),n.off("mouseout",r)}function r(){e.cancel(l)}function s(n){e.cancel(l),l=e(function(){var e={markerLonLat:n.latlng,point:{x:n.latlng.lng,y:n.latlng.lat}};t.getAndShowFeatures(e)},o)}var l,c=L.control.features();n.addControl(c),n.on("featuresactivate",i),n.on("featuresdeactivate",a)})}}}]).factory("featureSummaryService",["$log","configService","mapService","$timeout","$rootScope","$q","$http",function(t,n,o,i,a,r,s){var l,c,u="service/path/featureCount";return o.getMap().then(function(e){l=e}),{getAndShowFeatures:function(e){this.view(e).then(function(e){this.showPopup(e)}.bind(this))},showPopup:function(t){var n=t.position.point;o.getMap().then(function(o){var i=[];e.forEach(t.data,function(e,t){i.push(t+" ("+e+")")}),L.popup().setLatLng([n.y,n.x]).setContent(i.length?i.join("<br />"):"No nearby features").openOn(o)})},hidePopup:function(){o.getMap().then(function(e){e.closePopup()})},view:function(t){var n=r.defer();return c=null,t.point&&this.featuresUnderPoint(t.point).then(function(o){var i=0;e.forEach(o,function(e){i+=e}),n.resolve({data:o,position:t,count:i})}),n.promise},deferView:function(e){var t=this,n=r.defer();return this.cancelView(),c=i(function(){t.view(e).then(function(e){n.resolve(e)})}.bind(this),200),n.promise},cancelView:function(){c&&i.cancel(c)},clearView:function(){},onMapMove:function(e){return t.debug("Adding event handler"),l.on("moveend",l,e),e},offMapMove:function(e){t.debug("Removing event handler"),l.off("moveend",l,e)},positionFromLonlat:function(e){var t=e.lat?e.lat:e.y,n=e.lon?e.lon:e.x,o=[t,n],i=l.project(o);return console.log([o,i]),i},getViewPort:function(){return l._container.getBoundingClientRect()},featuresUnderPoint:function(e){var t=r.defer(),o=l._container.getBoundingClientRect(),i=window.devicePixelRatio?window.devicePixelRatio:1,a=l.getBounds();return n.getConfig("clientSessionId").then(function(n){s.post(u,{clientSessionId:n,x:e.x,y:e.y,width:o.width/i,height:o.height/i,extent:{left:a.left,right:a.right,top:a.top,bottom:a.bottom}}).then(function(e){t.resolve(e.data)})}),t.promise}}}])}(angular,window),function(e,t,n){"use strict";e.module("geo.geosearch",["ngAutocomplete"]).directive("expSearch",[function(){return{templateUrl:"components/geosearch/search.html",scope:{hideTo:"="},link:function(e,t){t.addClass("")}}}]).directive("geoSearch",["$log","$q","googleService","mapHelper",function(e,t,n,o){return{controller:["$scope",function(i){i.values={from:{},to:{}},i.zoom=function(a){var r,s=[];i.values.from.description&&(r=n.getAddressDetails(i.values.from.description,i).then(function(t){e.debug("Received the results for from"),i.values.from.results=t,i.item=""},function(t){e.debug("Failed to complete the from lookup.")}),s.push(r)),i.values.to&&i.values.to.description&&(r=n.getAddressDetails(i.values.to.description,i).then(function(t){e.debug("Received the results for to"),i.values.to.results=t},function(t){e.debug("Failed to complete the to lookup.")}),s.push(r)),s.length>0&&t.all(s).then(function(){var t=[];i.values.from&&i.values.from.results&&t.push(i.values.from.results),i.values.to&&i.values.to.results&&t.push(i.values.to.results),o.zoomToMarkPoints(t,a),1==s.length,e.debug("Updating the map with what we have")}),e.debug("Zooming to map soon.")}}]}}]).factory("googleService",["$log","$q",function(e,n){var o,i=new t.maps.Geocoder;try{o=new t.maps.places.AutocompleteService(null,{types:["geocode"]})}catch(a){e.debug("Catching google error that manifests itself when debugging in Firefox only")}return{getAddressDetails:function(e,o){var a=n.defer();return i.geocode({address:e,region:"au"},function(e,n){o.$apply(n!=t.maps.GeocoderStatus.OK?function(){a.reject("Failed to find address")}:function(){a.resolve({lat:e[0].geometry.location.lat(),lon:e[0].geometry.location.lng(),address:e[0].formatted_address})})}),a.promise}}}])}(angular,google,window),function(e,t){"use strict";e.module("explorer.layers",["geo.map"]).factory("layerService",["mapService","$log","$q",function(n,o,i){var a=null,r=["addToMap","removeFromMap","handleShow","init","destroy","moveUp","moveDown"],s={},l=0,c={WMS:{addToMap:function(){return this.layer=t.tileLayer.wms(this.wmsUrl,{layers:this.layers,format:"image/png",transparent:!0}),i.when(this.layer)},removeFromMap:function(){this.layer.map&&this.map.removeLayer(this.layer)},handleShow:function(){return this.layer._map?(this.map.removeLayer(this.layer),!1):(this.layer.addTo(this.map),!0)},moveUp:function(){var e,t,n=this.map.layers,o=0,i=this.map.getLayerIndex(this.layer);for(e=0;e<n.length;e++)if(t=n[e],!t.isBaseLayer&&!t.pseudoBaseLayer){o=e;break}return i>o?(a.raiseLayer(this.layer,-1),!0):!1},moveDown:function(){var e=a.getLayerIndex(this.layer),t=a.layers.length;return t-1>e?(a.raiseLayer(this.layer,1),!0):!1},init:function(){return this.addToMap()},destroy:function(){this.removeFromMap()}}},u={WMS:function(e){this.legend=this.legendUrl,this.thumbUrl||(this.thumbUrl=window.location.protocol+"//"+window.location.host+window.location.pathname.substr(0,window.location.pathname.substr(1).indexOf("/")+2)+"service/thumb/wms?wmsService="+encodeURIComponent(this.url)+"&layers="+encodeURIComponent(this.layers))},Tile:function(e){this.legend=this.legendUrl},Vector:function(e){}};return window.typeProtos=c,c.Tile=Object.create(c.WMS),c.Tile.addToMap=function(){function e(e){var t=e.map.getLayersByClass("OpenLayers.Layer.Markers");t.forEach(function(t){e.map.setLayerIndex(t,e.map.layers.length-1)}.bind(e))}this.layer?(this.layer.visibility=this.visibility=!1,this.map.addLayer(this.layer),e(this)):n.addLayer(this).then(function(t){try{this.layer=t,this.layer.feature=this,e(this)}catch(n){o.warn("Why is there no function?")}}.bind(this))},c.Vector=Object.create(c.WMS),c.Vector.addToMap=function(){},{decorate:function(t){var n,o;return t.assetId||(t.assetId="bogus_"+l++),s[t.assetId]?t:(this._createMapFeature(t),t.isWrapped=!0,n=t.type,o=c[n],o&&e.forEach(r,function(e){t[e]=o[e]}),t)},_createMapFeature:function(e){var t;"Vector"==e.type&&o.debug("Handling a vector service"),t=u[e.type],t&&(u[e.type].call(e),s[e.assetId]=e)}}}])}(angular,L),function(e){"use strict";e.module("explorer.layer.inpector",["explorer.layers"]).directive("layerInspector",["$rootScope","layerService",function(e,t){return{restrict:"AE",scope:{click:"&",showClose:"=?",active:"=",name:"=?"},controller:["$scope",function(e){e.toggleShow=function(){var e=this.active;e.isWrapped||(e=t.decorate(e),e.init(),e.show=!0,e.showExtra=!0),e.displayed=e.handleShow()}}],templateUrl:"map/layerinspector/layerInspector.html?v=1"}}])}(angular),function(e){"use strict";e.module("explorer.layer.slider",[]).directive("explorerLayerSlider",[function(){return{template:'<slider min="0" max="1" step="0.1" updateevent="slideStop" ng-model="slider.opacity" ng-disabled="!slider.visibility" ui-tooltip="hide"></slider>',scope:{layer:"=?"},link:function(e,t,n){e.slider={opacity:1,visibility:!0},e.$watch("slider.opacity",function(t,n){e.layer&&e.layer.setOpacity(t)}),e.$watch("layer.options.opacity",function(t,n){e.slider.opacity=t})}}}])}(angular),function(e,t){"use strict";e.module("explorer.least.cost.path",["openLayers.service","explorer.config","explorer.flasher","explorer.persist","explorer.message","explorer.asynch"]).directive("leastCostPathDraw",["$log","lcpService","flashService","persistService","configService",function(e,t,n,o,i){return{templateUrl:"components/leastcostpath/draw.html",replace:!0,restrict:"AE",scope:{item:"="},controller:["$scope",function(e){e.points=[],i.getConfig().then(function(t){e.lcpExtent=t.leastCostPathExtent}),e.remove=function(){var n=e.points.indexOf(this.point);n>-1&&(e.points.splice(n,1),t.removePoint(this.point))},e.pathComplete=function(){e.item="",e.pathGeometry=t.getPathGeometry(),e.lastResistanceCategories?e.resistanceCategories=e.lastResistanceCategories:t.weightings().then(function(t){o.getItem("lcpWeightings").then(function(e){e&&t.forEach(function(t){t.group.forEach(function(t){var n=e[t.key];(n||0===n)&&(t.value=n.value,t.selected=n.selected)})})}),e.resistanceCategories=t})},e.$watch("resistanceCategories",function(t,n){if(n){e.lastResistanceCategories=n;var i={};n.forEach(function(e){e.group.forEach(function(e){i[e.key]={value:e.value,selected:e.selected}})}),o.setItem("lcpWeightings",i)}else e.item=""})}],link:function(o,i){function a(e){n.add("The maximum 4 way points have been added to the path.",4500),o.points=e}var r,s;o.$watch("item",function(i,l){"leastCostPath"==i?(o.show=!0,t.activatePath(o.lcpExtent).then(function(t){e.debug("Complete")},function(t){e.debug("Error")},function(t){e.debug("Notification type "+t.type),"maximumVertices"==t.type?a():"pointOutOfBounds"==t.type?(n.remove(r),r=n.add("Point is out of area with data",4e3)):t.points&&(o.points=t.points),"distance"in t&&(o.distance=t.distance,n.remove(s),t.distance>3e5&&(s=n.add("Reduce the length of your path. A limit of 300km applies.",12e3)))})):"leastCostPath"==l&&(o.show=!1,o.points=[],t.deactivateAll())})}}}]).directive("marsLeastCostWeightings",["$log","$modal","lcpService","configService","messageService",function(e,t,n,o,i){return{scope:{weightings:"=",pathGeometry:"="},controller:[function(){}],link:function(e,a,r){function s(e){i.error(e.text)}function l(){e.weightings=null}var c;e.$watch("weightings",function(a,r){function u(t,o){var i=e.pathGeometry,a=i.clone().transform(new OpenLayers.Projection("EPSG:3857"),new OpenLayers.Projection("EPSG:4326")).getGeodesicLength(),r={};t.forEach(function(e){e.group.forEach(function(e){r[e.key]=e})}),n.getLeastCostPath(i,r,0===o||o?o:.25).then(function(t){var o=n.results();t&&("displayMessage"==t.jobName||t.error)?(t.text||(t.text=t.details),s(t),e.leastCostPath=null):(window.scoopla=e,o.data=t.data,o.data.geometry=i,o.distance=a,o.data.timeStamp=Date.now()),n.removeInterimPath()},s)}a&&(c=t.open({templateUrl:"components/leastcostpath/leastCostWeightings.html?v=5",size:"md",controller:["$scope","$modalInstance","weightings","pathGeometry",function(e,t,a,r){function s(){function t(e,t){return function(n){var o=(e.right-e.left)*n,i=(e.top-e.bottom)*n,a=o>i?o:i,r=e.left-a,s=e.right+a,l=e.bottom-a,c=e.top+a;return t.top>c&&t.left<r&&t.right>s&&t.bottom<l}}o.getConfig().then(function(n){var o=e.pathGeometry.clone().transform(new OpenLayers.Projection("EPSG:3857"),new OpenLayers.Projection("EPSG:4326")).getBounds(),a={0:0},r="0",s=n.leastCostPathExtent,l=t(o,s),c=null;l(.1)?(a[.1]=10,r="0.1",l(.25)?(a[.25]=25,r="0.25",l(.5)?(a[.5]=50,r="0.25"):c="Can not buffer extent by more than 25% as it would exceed the extent of our data"):c="Can not buffer extent by more than 10% as it would exceed the extent of our data"):c="Extent buffering restricted to line extent due to lack of data",e.bufferValues=a,e.bufferPercent=r,c&&i.info(c)})}e.weightings=a,e.pathGeometry=r,n.showInterimPath(r),s(),e.close=function(){e.weightings=null},o.getConfig().then(function(t){e.maxExtent=t.leastCostPathExtent}),e.cancelLeastCostPath=function(){e.weightings=null,n.removeInterimPath(),t.dismiss(null)},e.showLeastCostPath=function(n){n.stopPropagation(),t.close(e.bufferPercent)}}],resolve:{weightings:function(){return e.weightings},pathGeometry:function(){return e.pathGeometry}}}),c.result.then(function(t){u(e.weightings,t),l()},function(){l()}))})}}}]).directive("marsLeastCostPathDisplay",["$log","lcpService","$filter",function(t,n,o){return{templateUrl:"components/leastcostpath/leastCostDisplay.html?v=2",restrict:"AE",controller:["$scope",function(o){o.results=n.results(),o.urls={},o.$watch("results.data",function(){o.results.data&&(o.lcpKmlShown=o.lcpBufferKmlShown=o.pathShown=o.costSurfaceShown=!1,e.forEach(o.results.data.results,function(e,t){n.getResourceUrl(o.results.data.jobId,t).then(function(e){o.urls[t]=e,"lcpKml"==t?(o.lcpKmlShown=!0,n.showPathKml(e)):"lcpCorridorKml"==t&&(o.lcpBufferKmlShown=!0,n.showBufferKml(e))})}))}),o.clear=function(){o.results.data=o.results.distance=null},o.stringify=function(e){return e?JSON.stringify(e):void 0},o.bringToTop=function(){n.bringToTop()},o.zoomToCentre=function(){
n.zoomToBufferlLayer()},o.toggleLcpKml=function(){o.lcpKmlShown=n.togglePathKml(o.urls.lcpKml),t.debug("Showing path from KML")},o.toggleLcpBufferKml=function(){o.lcpBufferKmlShown=n.toggleBufferKml(o.urls.lcpCorridorKml),t.debug("Showing buffer from KML")},o.togglePath=function(){o.pathShown=n.toggleLcpSourcePath(o.results.data.geometry,"Least cost path elevation plot")},o.elevationLcpKml=function(){n.elevationLcpKml(),t.debug("Showing path from KML")},o.elevationPath=function(e){n.elevationPath(o.results.data.geometry,"Elevation plot of original path for least cost path")},o.mouseenterPathBuffers=function(){t.debug("mouse enter path buffers")},o.mouseleavePathBuffers=function(){t.debug("mouse leave Path Buffers")},o.mouseenterCostSurface=function(){t.debug("mouse enter cost surface")},o.mouseleaveCostSurface=function(){t.debug("mouse leave cost surface")},o.toggleCostSurface=function(){o.costSurfaceShown=n.toggleCostSurface({outline:o.urls.fullSegExtKml,image:o.urls.png,extent:o.urls.csExtKml})}}],link:function(e,t,o){e.$watch("results.distance",function(t,o){t?(e.pathShown=!0,n.showLcpSourcePath(e.results.data.geometry)):o&&(n.removePathKml(),n.removeBufferKml(),n.removeLcpSourcePath(),n.removePathBuffers(),n.removeCostSurface())})}}}]).directive("pathLeastCostSlider",[function(){return{template:'<slider min="0" max="1" step="0.1" ng-model="weighting.value" updateevent="slideStop" ng-disabled="!weighting.selected" ui-tooltip="hide"></slider>',link:function(e,t){}}}]).factory("lcpService",["$log","$q","$http","$timeout","$rootScope","asynch","mapService","flashService",function(t,n,o,i,a,r,s,l){var c,u,h,d,p,f=0,m="leastCostPath",g={pathBuffersKmlLayer:null,imageLayer:null,bufferKmlLayer:null,lcpSourcePath:null,pathKmlLayer:null},v=["pathBuffersKmlLayer","imageLayer","bufferKmlLayer","lcpSourcePath","pathKmlLayer"],y=null,L={data:null,distance:null};return{results:function(){return L},triggerElevationPlot:function(e){a.$broadcast("elevation.plot.data",e)},elevationPath:function(e,t){var n=e.clone().transform(new OpenLayers.Projection("EPSG:3857"),new OpenLayers.Projection("EPSG:4326")).getGeodesicLength();this.triggerElevationPlot({length:n,geometry:e,heading:t})},elevationLcpKml:function(){var e,t,n=[];g.pathKmlLayer.features.forEach(function(e){n=e.geometry.getVertices().concat(n)}),e=new OpenLayers.Geometry.LineString(n),t=e.clone().transform(new OpenLayers.Projection("EPSG:3857"),new OpenLayers.Projection("EPSG:4326")).getGeodesicLength(),this.triggerElevationPlot({length:t,geometry:e,heading:"Least cost path elevation plot"})},bringToTop:function(){this._renderPaths()},_renderPaths:function(e){function t(e){var t=[];v.forEach(function(n){var o=g[n];o&&(t.push(o),o.map&&e.removeLayer(o))}),t.length&&e.addLayers(t)}e?t(e):s.getMap().then(function(e){t(e)})},removeLcpSourcePath:function(){return this._remove("lcpSourcePath")},removeBufferKml:function(){return this._remove("bufferKmlLayer")},removeCostSurface:function(){return this._remove("imageLayer")},removePathBuffers:function(){return this._remove("pathBuffersKmlLayer")},removePathKml:function(){return this._remove("pathKmlLayer")},_remove:function(e){var t=null,n=g[e];return n&&n.map&&(t=n.map,t.removeLayer(n),n.destroy(),g[e]=null),t},_showing:function(e){var t=g[e];return t&&t.map},showInterimPath:function(e,t){var n;this.removeInterimPath(),d=new OpenLayers.Layer.Vector("Interim source layer for least cost path",{style:new OpenLayers.Style({strokeColor:"#000000"})}),d.addFeatures([new OpenLayers.Feature.Vector(e)]),map.addLayer(d),p=new OpenLayers.Layer.Markers("Waypoint Markers"),map.addLayer(p),n=new OpenLayers.Size(16,16),e.components.forEach(function(t,o){var i,a,r;i=t.x,a=t.y,o>0&&o<e.components.length-1?r=new OpenLayers.TextIcon('<i class="fa fa-anchor textMarker"></i>',n):0===o?r=new OpenLayers.TextIcon('<i class="fa fa-bullseye" style="color:green;font-size:120%"></i>',n):(n=new OpenLayers.Size(11,15),r=new OpenLayers.TextIcon('<i class="fa fa-remove textMarker" style="color:red; font-size:120%"></i>',n)),p.addMarker(new OpenLayers.Marker(new OpenLayers.LonLat(i,a),r))})},removeInterimPath:function(){d&&(map.removeLayer(d),d.destroy(),d=null),p&&(map.removeLayer(p),p.destroy(),p=null)},getKml:function(e){var t=n.defer();return e.indexOf("http")<0&&(e=window.location.href+e),o.post(kmlEndpoint,{url:e}).then(function(e){t.resolve(e.data)},function(e){t.reject({error:"E1101",text:"Failed to retrieve KMZ"})}),t.promise},zoomToBufferlLayer:function(){v.some(function(e){var t=g[e];return t?(map.zoomToExtent(t.getDataExtent()),!0):!1})},toggleLcpSourcePath:function(e){var t=this._showing("lcpSourcePath");return t?this.removeLcpSourcePath():this.showLcpSourcePath(e),!t},showLcpSourcePath:function(e){this.removeLcpSourcePath(),g.lcpSourcePath=new OpenLayers.Layer.Vector("Source layer for least cost path",{style:new OpenLayers.Style({strokeColor:"#101000"})}),g.lcpSourcePath.addFeatures([new OpenLayers.Feature.Vector(e)]),this._renderPaths()},toggleCostSurface:function(e){var t=this._showing("imageLayer");return t?(this.removeCostSurface(),this.removePathBuffers()):this.showCostSurface(e),!t},showCostSurface:function(e){var t=this,i=new Image;i.onload=function(){var i=this.width,a=this.height;n.all([t.showPathBuffers(e.outline),o.get(e.extent,{cache:!0})]).then(function(n){var o=n[0],r=n[1].data,s=new OpenLayers.Format.KML({internalProjection:o.baseLayer.projection,externalProjection:new OpenLayers.Projection("EPSG:4326")}),l=s.read(r),c=l[0].geometry.getBounds();t.removeCostSurface(o),g.imageLayer=new OpenLayers.Layer.Image("Cost surface image",e.image,c,new OpenLayers.Size(i,a),{alwaysInRange:!0,isBaseLayer:!1,visibility:!0,opacity:.9,displayOutsideMaxExtent:!0,numZoomLevels:17}),t._renderPaths(o)})},i.src=e.image},showPathBuffers:function(e){var t=this,o=n.defer();return s.getMap().then(function(n){t.removePathBuffers(n),g.pathBuffersKmlLayer=new OpenLayers.Layer.Vector("Path segment buffers",{strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:e,format:new OpenLayers.Format.KML({maxDepth:2,internalProjection:n.getProjectionObject(),externalProjection:new OpenLayers.Projection("EPSG:4326")})}),styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style({pointRadius:6,fillOpacity:.15,fillColor:"#ccff77",strokeColor:"#44ee11",strokeWidth:2})})}),t._renderPaths(n),o.resolve(n)}),o.promise},toggleBufferKml:function(e){var t=this._showing("bufferKmlLayer");return t?this.removeBufferKml():this.showBufferKml(e),!t},showBufferKml:function(e){var t=this;s.getMap().then(function(n){t.removeBufferKml(n),g.bufferKmlLayer=new OpenLayers.Layer.Vector("Least cost path buffer KML",{strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:e,format:new OpenLayers.Format.KML({maxDepth:2,internalProjection:n.getProjectionObject(),externalProjection:new OpenLayers.Projection("EPSG:4326")})}),styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style({pointRadius:6,fillOpacity:.3,fillColor:"#bbff55",strokeColor:"#ff4411",strokeWidth:2})})}),t._renderPaths(n)})},togglePathKml:function(e){var t=this._showing("pathKmlLayer");return t?this.removePathKml():this.showPathKml(e),!t},showPathKml:function(e){var t=this;s.getMap().then(function(n){t.removePathKml(),g.pathKmlLayer=new OpenLayers.Layer.Vector("Least cost path KML",{strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:e,format:new OpenLayers.Format.KML({maxDepth:2,internalProjection:n.getProjectionObject(),externalProjection:new OpenLayers.Projection("EPSG:4326")})}),styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style({graphicName:"cross",pointRadius:6,fillOpacity:.5,fillColor:"#ffcc66",strokeColor:"#ff9933",strokeWidth:2})})}),t._renderPaths(n)})},getResourceUrl:function(e,t){var i=n.defer();return o.get("service/resource/leastCostPath/"+e+"/"+t).then(function(e){e.data&&e.data.value&&i.resolve(e.data.value.url),i.reject()}),i.promise},getLeastCostPath:function(o,a,s){var c=new OpenLayers.Feature.Vector(o.clone().transform(new OpenLayers.Projection("EPSG:3857"),new OpenLayers.Projection("EPSG:4326"))),u=(new OpenLayers.Format.WKT).write(c),h=n.defer(),d=[],p=!1;return l.add("Initiating least cost path process...",3e3),i(function(){p||(y=l.add("Least cost path process is running.",6e4,!0))},4500),e.forEach(a,function(e,t){e.selected&&d.push('["'+t+'","'+e.label+'",'+e.value+"]")}),r(m,{wkt:u,wTable:"["+d.join()+"]",f:"json",buffPct:s,returnZ:!1,returnM:!1},{urlEncoded:!0}).then(function(e){var t="A least cost process has completed";e.data&&"esriJobFailed"==e.data.jobStatus&&(t="A least cost process has failed"),p=!0,l.remove(y),l.add(t,4e3),h.resolve(e)},function(e){p=!0,l.remove(y),l.add("A least cost process has failed",4e3),t.debug(JSON.stringify(e))}),h.promise},getPathGeometry:function(){return u.features[0].geometry},activatePath:function(e){var t=n.defer();return s.getMap().then(function(n){if(!c){var o={strokeColor:"#ff0000",fillColor:"#ff0000",strokeOpacity:1,strokeWidth:2,pointRadius:5,graphicName:"cross",cursor:"pointer"},i=new OpenLayers.StyleMap({"default":OpenLayers.Feature.Vector.style["default"],vertex:o},{extendDefault:!1});u=new OpenLayers.Layer.Vector("Least Cost Input Path",{styleMap:i}),u.events.on({featuremodified:function(e){var n=e.feature.geometry.components,o=n.length;n.length>5?(h.createVertices=!1,5==f&&(h.resetVertices(),t.notify({type:"maximumVertices",points:n}))):(h.createVertices=!0,6==f&&h.resetVertices()),f=o,t.notify({type:"changed",points:n,distance:e.feature.geometry.getLength()})}}),c=new OpenLayers.Control.DrawFeatureOpt(u,OpenLayers.Handler.RestrictedPath,{title:"Draw",displayClass:"olControlDraw",handlerOptions:{maxVertices:6,restrictedExtent:e},callbacks:{outofbounds:function(e){t.notify({type:"pointOutOfBounds",lonlat:e})},point:function(e,n){t.notify({type:"adding",distance:n.getLength()})}}}),h=new OpenLayers.Control.RestrictedModifyFeature(u,{restrictedExtent:e,clickout:!1,toggle:!1,deleteCodes:[46,68,27],title:"Modify",vertexRenderIntent:"vertex",outOfBounds:function(e){t.notify({type:"pointOutOfBounds",lonlat:e})}}),n.addControl(c),n.addControl(h),n.addLayer(u),c.events.register("featureadded",this,function(e){var n=e.feature.geometry.components;f=n.length,f>5&&(h.createVertices=!1,t.notify({type:"maximumVertices",points:n})),h.selectFeature(e.feature),h.activate(),c.deactivate(),t.notify({type:"created",points:n,distance:e.feature.geometry.getLength()})})}f=0,c.activate(),h.deactivate(),n.addLayer(u)}),t.promise},removePoint:function(e){u.features[0].geometry.removeComponent(e)},deactivateAll:function(){c&&c.deactivate(),h&&h.deactivate(),u&&(u.removeAllFeatures(),map.removeLayer(u))},deactivatePath:function(){c.deactivate()},activateModify:function(){h.mode=OpenLayers.Control.ModifyFeature.RESHAPE,h.activate(),c.deactivate()},deactivateModify:function(){h.deactivate(),c.activate()},weightings:function(){var e=n.defer();return o.get("resources/config/defaultLeastCostPathWeightings.json?v=1",{cache:!0}).then(function(t){e.resolve(t.data)},function(t){e.reject({error:"E1100",text:"Failed to retrieve weightings"})}),e.promise}}}]).run(["$templateCache",function(e){e.put("components/leastcostpath/draw.html",'<div class="popover bottom lcpPathDisplay" mars-lcp-path ng-show="show || resistanceCategories">	<div class="arrow"></div>	<div class="popover-inner">		<div class="pathHeader">			<span style="font-weight:bold">Least Cost Path</span><div style="float:right" ng-show="distance">{{(distance/1000) | number : 3}}km</div>		</div>       <div ng-hide="resistanceCategories">		   <div ng-hide="points.length > 0">Click on map to start path. Double click to end path.</div>		   <div ng-show="points.length > 0">Drag vertices with mouse to change waypoints. Hover over waypoints and use the delete key to remove.</div>		   <div style="font-weight:bold;text-align:center" ng-cloak ng-show="distance > 300000">Reduce the length of your path. <br/>A limit of 300k applies.</div>		   <div class="buttons">			  <button ng-show="points.length > 1" type="button" class="btn btn-default" style="width:98%;margin:2px" ng-click="pathComplete($event)" ng-disabled="distance > 300000">Least cost path...</button>		   </div>       </div>	</div>	<div mars-least-cost-weightings weightings="resistanceCategories" path-geometry="pathGeometry" class="marsWeightings" success="disable"></div></div>')}]).filter("lcpLookup",[function(){var e={lcpKml:{name:"Least cost path KML",fileType:"kml",fileName:"lcp.kml",showInGoogle:!1},lcpCorridorKml:{name:"Least cost path buffer KML",fileType:"kml",fileName:"lcpCorridor.kml",showInGoogle:!1},cRasterKmz:{name:"Cost surface KML",fileType:"kmz",fileName:"costRaster.kmz",showInGoogle:!1},combinedKMZ:{name:"Combined KMZ",fileType:"kmz",fileName:"combinedKMZ",showInGoogle:!0},docPath:{name:"Least cost path report",fileType:"pdf",fileName:"lcpReport.pdf",showInGoogle:!0}};return function(t,n){var o;return((o=e[t])?o:{name:t,fileType:""})[n?n:"name"]}}]),OpenLayers.Control.DrawFeatureOpt=OpenLayers.Class(OpenLayers.Control.DrawFeature,{handlers:null,initialize:function(e,t,n){OpenLayers.Control.DrawFeature.prototype.initialize.apply(this,[e,t,n]);var o={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,o)}},handleKeypress:function(e){var t,n=e.keyCode;return this.handler.active&&(27===n&&(t=this.handler.line.geometry.components.length-1,this.handler.line.geometry.removeComponent(this.handler.line.geometry.components[t]),this.handler.finalize()),46===n&&(t=this.handler.line.geometry.components.length-2,this.handler.line.geometry.removeComponent(this.handler.line.geometry.components[t]),this.handler.drawFeature())),!0},activate:function(){return this.handlers.keyboard.activate()&&OpenLayers.Control.DrawFeature.prototype.activate.apply(this,arguments)},deactivate:function(){var e=!1;return OpenLayers.Control.DrawFeature.prototype.deactivate.apply(this,arguments)&&(this.handlers.keyboard.deactivate(),e=!0),e},CLASS_NAME:"OpenLayers.Control.DrawFeatureOpt"});var n=function(e){if(null===this.restrictedExtent)return!0;this.restrictedBound||(this.restrictedBounds=new OpenLayers.Bounds(this.restrictedExtent.left,this.restrictedExtent.bottom,this.restrictedExtent.right,this.restrictedExtent.top).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:3857")));var t=this.map.getLonLatFromPixel(e);return this.restrictedBounds.containsLonLat(t)};OpenLayers.Control.RestrictedModifyFeature=OpenLayers.Class(OpenLayers.Control.ModifyFeature,{restrictedExtent:null,outOfBounds:null,dragVertex:function(e,t){this.inBounds(t)?OpenLayers.Control.ModifyFeature.prototype.dragVertex.apply(this,arguments):this.outOfBounds&&this.outOfBounds(this.map.getLonLatFromPixel(t))},CLASS_NAME:"OpenLayers.Control.RestrictedModifyFeature"}),OpenLayers.Control.RestrictedModifyFeature.prototype.inBounds=n,OpenLayers.Handler.RestrictedPath=OpenLayers.Class(OpenLayers.Handler.Path,{restrictedExtent:null,addPoint:function(e){var t=this.inBounds(e);t?OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments):this.callback("outofbounds",this.map.getLonLatFromPixel(e))},CLASS_NAME:"OpenLayers.Handler.RestrictedPath"}),OpenLayers.Handler.RestrictedPath.prototype.inBounds=n,OpenLayers.TextIcon=OpenLayers.Class(OpenLayers.Icon,{initialize:function(e,t,n,o){this.text=e,this.size=t||{w:20,h:20},this.offset=n||{x:-(this.size.w/2),y:-(this.size.h/2)},this.calculateOffset=o;var i=OpenLayers.Util.createUniqueID("OL_TextIcon_");this.imageDiv=OpenLayers.Util.createDiv(i)},draw:function(e){return $(this.imageDiv).html(this.text),OpenLayers.Util.modifyDOMElement(this.imageDiv,null,null,this.size,"absolute"),this.moveTo(e),this.imageDiv}})}(angular,window),function(e,t,n){"use strict";e.module("geo.maphelper",["geo.map"]).factory("mapHelper",["mapService","$timeout","$q","$rootScope","flashService",function(e,t,n,o,i){var a={timeoutPeriod:200,timeout:null,callbacks:{},checkMarkers:function(){},zoomToMarkPoints:function(t,n){e.getMap().then(function(e){e.setView(t[0],12,{animate:!0})})},zoomToLonLats:function(e){},markPoint:function(e){},getPseudoBaseLayer:function(){return e.getMap().then(function(e){var t=null;return e.eachLayer(function(e){e.pseudoBaseLayer&&(t=e)}),t})},subscribe:function(e,t){this.callbacks[e]||(this.callbacks[e]={subscribers:[]}),this.callbacks[e].subscribers.push(t)},pubChangeBaseLayerBias:function(e){},getExtentWkt:function(){return e.getMap().then(function(e){return Exp.Util.boundsToWktPoly(e.getBounds())})},decorateWfsLayer:function(e){}};return e.getMap().then(function(e){function n(n){t.cancel(a.timeout),a.timeout=t(function(){o.$broadcast("extentOfInterestChanged",e)},a.timoutPeriod)}e.on("moveend",n)}),a}])}(angular,window,L),function(e){"use strict";e.module("explorer.mapstate",[]).factory("mapStateService",["$log","mapService","persistService",function(e,t,n){var o=24e11;return{persist:function(){var e=Date.now();o-100>e&&n.setItem("marsMapTab",t.getState()),o=e},restore:function(){n.getItem("marsMapTab").then(function(e){e&&t.setState(e)})}}}])}(angular),function(e){"use strict";e.module("geo.measure",[]).directive("geoMeasure",["$log",function(e){return{require:"^geoMap",restrict:"AE",link:function(t,n,o,i){i.getMap().then(function(t){L.Control.measureControl().addTo(t),t.on("draw:drawstop",function(t){e.info("Draw stopped"),e.info(t)})})}}}])}(angular),function(e,t,n){"use strict";function o(e,t){this.click=function(){console.log("Click")},this.mouseenter=function(e){console.log("enter"),t.overFeatures(e.feature)},this.mouseleave=function(e){console.log("leave"),t.outFeatures(e.feature)},this.groupEnter=function(n,o){var i=e("filterGroupsByLayername")(n,o);i.forEach(function(e){t.overFeatures(e.feature)})},this.groupLeave=function(n,o){var i=e("filterGroupsByLayername")(n,o);i.forEach(function(e){t.outFeatures(e.feature)})}}e.module("explorer.point",["geo.map","explorer.flasher"]).directive("expPoint",["pointService",function(e){return{scope:{data:"=point"},controller:["$scope",function(t){t.$watch("data",function(n,o){(n||o)&&e.showPoint(t.data)})}]}}]).directive("expClickMapPoint",["pointService",function(e){return{restrict:"AE",scope:{},link:function(t,n){e.addMapListener(function(t){e.showPoint(t)},this)}}}]).directive("expPointInspector",["pointService","flashService","$rootScope","$filter",function(t,n,o,i){var a={actions:[],visible:!0,modal:!1,minWidth:240,title:"Features within approx 2km",position:{top:140,left:40}};return{restrict:"AE",templateUrl:"map/point/point.html?v=2.7",scope:!0,controller:["$scope",function(t){t.windowOptions=t.options?e.extend({},a,scope.options):e.extend({},a)}],link:function(e,n){function a(n){e.featuresInfo=n,t.createLayer()}console.log("Id = ",e.$id),o.$on("map.point.changed",function(n,o){e.point=o,t.removeLayer(),"undefined"!=typeof o&&o&&(e.changePoint(o),t.getMetaData().then(function(t){e.metadata=t.data}))}),e.createTitle=function(){var e=!this.greaterThanOneItem(),t=this.feature.layerName,n=this.metadata[t],o=n.preferredLabel,i=this.feature.attributes[o];return!e&&i&&"Null"!=i?i:n.label},e.changePoint=function(e){t.moveMarker(e),e&&t.getInfo(e).then(function(e){a(e)}),t.removeLayer()},e.clearPoint=function(){e.point=!1,t.removeLayer(),t.removeMarker()},e.toggleShow=function(){this.feature.displayed=!this.feature.displayed,this.feature.displayed?this.feature.feature=t.showFeature(this.feature):(t.hideFeature(this.feature.feature),this.feature.layer=null)},e.oneShowing=function(){var t=i("filterGroupsByLayername")(e.featuresInfo.results,this.item),n=!1;return t.forEach(function(e){n|=e.displayed}),n},e.greaterThanOneItem=function(){return i("filterGroupsByLayername")(e.featuresInfo.results,this.item).length>1},e.groupShow=function(){var n=i("filterGroupsByLayername")(e.featuresInfo.results,this.item),o=!1;n.forEach(function(e){o|=e.displayed}),n.forEach(function(e){o?(e.feature=t.hideFeature(e.feature),e.displayed=!1):(e.feature=t.showFeature(e),e.displayed=!0)})},e.allHidden=function(){var e=!0;return this.featuresInfo&&this.featuresInfo.results&&this.featuresInfo.results.forEach(function(t){e&=!t.displayed}),e},e.toggleAll=function(){var n=e.allHidden();this.featuresInfo.results.forEach(function(e){n?e.displayed||(e.displayed=!0,e.feature=t.showFeature(e)):e.displayed&&(e.displayed=!1,e.feature=t.hideFeature(e.feature))})},e.elevationPath=function(e){this.feature.feature||(this.feature.feature=t.createFeature(this.feature)),t.triggerElevationPlot(this.feature.feature[0],e)}}}}]).factory("pointService",["$http","$q","configService","mapService","$rootScope",function(o,i,a,r,s){var l="service/path/featureInfo",c=null,u={esriGeometryPoint:{createFeatures:function(e){var n=[e.y,e.x];return[t.circleMarker(n)]},type:"x,y"},esriGeometryPolyline:{createFeatures:function(e){var n=[];return e.paths.forEach(function(e){var o=[];e.forEach(function(e){o.push([e[1],e[0]])}),n.push(t.polyline(o))}),n},type:"paths"},esriGeometryPolygon:{createFeatures:function(e){var n,o=[];return e.rings.forEach(function(e){var t=[];e.forEach(function(e){t.push([e[1],e[0]])}),o.push(t)}),n=t.multiPolygon(o),[n]},type:"rings"}},h="map/point/pointMetadata.json?v=1",d=null,p=null,f=[];return{triggerElevationPlot:function(e,t){var n=e.getLength();s.$broadcast("elevation.plot.data",{length:n,geometry:e.getLatLngs(),heading:t})},addMapListener:function(e,t){var n=!1;f.forEach(function(o){o.callback==e&&o.bound==t&&(n=!0)}),n||f.push({callback:e,bound:t}),p||(p=!0,r.getMap().then(function(e){e.on("click",function(e){f.forEach(function(t){var n=t.callback,o={x:e.latlng.lng,y:e.latlng.lat};o.lat=o.y,o.lng=o.x,t.bound&&n.bind(t.bound),n(o)})})}))},getMetaData:function(){return o.get(h,{cache:!0})},moveMarker:function(e){r.getMap().then(function(n){d&&n.removeLayer(d),d=t.marker(e).addTo(n)})},removeMarker:function(){d&&r.getMap().then(function(e){e.removeLayer(d),d=null})},showPoint:function(e){s.$broadcast("map.point.changed",e)},removePoint:function(){s.$broadcast("map.point.changed",null)},getBehaviour:function(e){},getInfo:function(e){return r.getMap().then(function(t){var i=t._container.getBoundingClientRect(),r=n.devicePixelRatio?n.devicePixelRatio:1,s=t.getBounds();return a.getConfig("clientSessionId").then(function(t){return o.post(l,{clientSessionId:t,x:e.x,y:e.y,width:i.width/r,height:i.height/r,extent:{left:s.left,right:s.right,top:s.top,bottom:s.bottom}}).then(function(e){return e.data})})})},overFeatures:function(t){var n;t&&(n=e.isArray(t)?t[0]:t,n&&n.bringToFront().setStyle({color:"red"}))},outFeatures:function(e){e&&e.forEach(function(e){e.setStyle({color:"#03f"})})},createLayer:function(){return r.getMap().then(function(e){return c=t.layerGroup(),e.addLayer(c),c})},removeLayer:function(){return r.getMap().then(function(e){return c&&e.removeLayer(c),c=null})},createFeature:function(e){return u[e.geometryType].createFeatures(e.geometry)},showFeature:function(e){var t=this.createFeature(e);return t.forEach(function(e){c.addLayer(e)}),t},hideFeature:function(e){e&&e.forEach(function(e){c.removeLayer(e)})}}}]).filter("dashNull",[function(){return function(e){return e&&"Null"!=e?e:"-"}}]).filter("featureGroups",[function(){return function(e){var t=[],n={};return e?(e.forEach(function(e){var o=e.layerName;n[o]||(n[o]=!0,t.push(o))}),t):t}}]).filter("filterGroupsByLayername",[function(){return function(e,t){var n=[];return e?(e.forEach(function(e){t==e.layerName&&n.push(e)}),n):n}}]).controller("OverFeatureCtrl",o),o.$invoke=["$filter","pointService"]}(angular,L,window),function(e,t){"use strict";e.module("geo.path",["geo.map","explorer.config","explorer.flasher","explorer.message"]).directive("geoPath",["mapService","pathService","$rootScope","flashService","messageService","configService","$timeout","$q",function(e,n,o,i,a,r,s,l){var c,u="distance";return{controller:["$scope",function(e){e.name="PATH"}],link:function(o,a,r){function s(){e.getMap().then(function(e){e.removeLayer(c)})}o.distanceMeasure={distance:"-"},o.showElevation=function(){var t=(c.getLatLngs(),e.getDistanceGeometry()),i=t.clone().transform(EPSG3857,EPSG4326).getGeodesicLength();o.disable(),n.triggerElevationPlot({length:i,geometry:t})},o.disable=function(){o.item="",s()},o.$watch("item",function(n,o){n==u?(i.add("Click on map to start a path or add next point. Double click to end path.",4e3),e.getMap().then(function(e){c=t.Polyline.Plotter([],{weight:4}),c.addTo(e)})):o==u&&s()})}}}]).factory("pathService",["$http","mapService","$q","flashService","$timeout","$window","$rootScope",function(e,t,n,o,i,a,r){return{triggerElevationPlot:function(e){r.$broadcast("elevation.plot.data",e)}}}]).filter("length",["$filter",function(e){var t={units:"m",threshold:1e5,aboveThresholdUnits:"km",divideBy:1e3};return function(n,o){var i,a;return n||0===n?(t.threshold&&n>t.threshold?(n/=t.divideBy,i=t.aboveThresholdUnits):i=t.units,a=e("number")(n,0)+" "+i,o?a:"("+a+")"):null}}])}(angular,L),function(e){"use strict";e.module("mars.poly",["openLayers.service"]).directive("marsBoundingArea",["$timeout","$rootScope","polyService",function(e,t,n){var o="boundingArea";return{template:'<i class="fa fa-bookmark-o fa-rotate-270" ></i>',scope:{item:"="},link:function(i,a,r){a.on("click",function(a){n.isActive()?i.item="":(i.item=o,n.initiate(function(n){e(function(){i.item="",t.$broadcast("extentOfInterestChanged",n)})}),t.$broadcast("extentOfInterestChanged",map))}).on("dblclick",function(e){i.item="",n.remove().then(function(e){t.$broadcast("extentOfInterestChanged",e)})}),i.$watch("item",function(e,t){t==o&&n.stop()})}}}]).factory("polyService",["$q","mapService",function(e,t){var n,o,i,a="Restricted Extent Poly";return{initiate:function(r){var s=e.defer();return o?(this.remove(),o.activate(),s.resolve(i)):t.getMap().then(function(e){i=e,n=new OpenLayers.Layer.Vector(a),o=new OpenLayers.Control.DrawFeature(n,OpenLayers.Handler.Polygon,{callbacks:{done:function(e){this.drawFeature(e),r&&r(e)}},handlerOptions:{holeModifier:"altKey",persist:!0}}),i.addLayer(n),i.addControl(o),o.activate(),s.resolve(i)}),s.promise},getFeatures:function(){var e=null;return o&&o.layer&&o.layer.features&&o.layer.features.length>0&&(e=o.layer.features),e},isActive:function(){return o&&o.active},remove:function(){if(i&&o){var t=i.getLayersByName(a);t&&t.forEach(function(e){e.removeAllFeatures()})}return e.when(i)},stop:function(){return o&&o.deactivate(),e.when(i)}}}])}(angular),void 0===window.Exp&&(window.Exp={}),function(e,t){"use strict";function n(t,o){function i(e){function t(e,t){return e.x1-t.x1}window.bugger=e;for(var n,o,i=e.getLatLngs(),a=i.length-1,r=[],s=0;a>s;++s)n=i[s],o=i[s+1],r[s]=n.lng<o.lng?{x1:n.lng,y1:n.lat,x2:o.lng,y2:o.lat}:{x1:o.lng,y1:o.lat,x2:n.lng,y2:n.lat};return r.sort(t)}function a(e,t,n){var o,i,a=n&&n.point,r=n&&n.tolerance,s=!1,l=e.x1-t.x1,c=e.y1-t.y1,u=e.x2-e.x1,h=e.y2-e.y1,d=t.y2-t.y1,p=t.x2-t.x1,f=d*u-p*h,m=p*c-d*l,g=u*c-h*l;if(0===f)0===m&&0===g&&(s=!0);else{var v=m/f,y=g/f;v>=0&&1>=v&&y>=0&&1>=y&&(a?(o=e.x1+v*u,i=e.y1+v*h,s=new OpenLayers.Geometry.Point(o,i)):s=!0)}if(r){var L,w,b,x,S=[e,t];if(s){if(a)e:for(b=0;2>b;++b)for(w=S[b],x=1;3>x;++x)if(o=w["x"+x],i=w["y"+x],L=Math.sqrt(Math.pow(o-s.x,2)+Math.pow(i-s.y,2)),r>L){s.x=o,s.y=i;break e}}else{var P,k,C,E;e:for(b=0;2>b;++b)for(P=S[b],k=S[(b+1)%2],x=1;3>x;++x)if(C={x:P["x"+x],y:P["y"+x]},E=OpenLayers.Geometry.distanceToSegment(C,k),E.distance<r){s=a?new OpenLayers.Geometry.Point(C.x,C.y):!0;break e}}}return s}var r=!1;if(t instanceof e.Polyline||t instanceof e.Polygon||t instanceof e.Marker){var s,l,c=i(o);t instanceof e.Marker?(l=t.getLatLng(),s=[{x1:l.lng,y1:l.lat,x2:l.lng,y2:l.lat}]):s=i(t);var u,h,d,p,f,m,g,v;e:for(var y=0,L=c.length;L>y;++y){u=c[y],h=u.x1,d=u.x2,p=u.y1,f=u.y2;for(var w=0,b=s.length;b>w&&(m=s[w],!(m.x1>d));++w)if(!(m.x2<h||(g=m.y1,v=m.y2,Math.min(g,v)>Math.max(p,f)||Math.max(g,v)<Math.min(p,f)||!a(u,m)))){r=!0;break e}}}else r=n(o,t);return r}function o(e){var t=[],n=e.getWest()+" "+e.getSouth();return t.push(n),t.push(e.getEast()+" "+e.getSouth()),t.push(e.getEast()+" "+e.getNorth()),t.push(e.getWest()+" "+e.getNorth()),t.push(n),"POLYGON(("+t.join(",")+"))"}function i(e){var t=[];return e&&e.forEach(function(e){t.push(e.lng+" "+e.lat)}),"LINESTRING("+t.join(",")+")"}t.Util||(t.Util={}),t.Util.toLineStringWkt=i,t.Util.intersects=n,t.Util.boundsToWktPoly=o,t.Util.toGeoJSON=function(){function e(e){if(!e||!e.length)return 0;for(var t=0,n=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t)|0;return n}function t(e,t){return e.getElementsByTagName(t)}function n(e,t){return e.getAttribute(t)}function o(e,t){return parseFloat(n(e,t))}function i(e,n){var o=t(e,n);return o.length?o[0]:null}function a(e){return e.normalize&&e.normalize(),e}function r(e){for(var t=0,n=[];t<e.length;t++)n[t]=parseFloat(e[t]);return n}function s(e){var t={};for(var n in e)e[n]&&(t[n]=e[n]);return t}function l(e){return e&&a(e),e&&e.textContent||""}function c(e){return r(e.replace(m,"").split(","))}function u(e){for(var t=e.replace(g,"").split(v),n=[],o=0;o<t.length;o++)n.push(c(t[o]));return n}function h(e){var t,n=[o(e,"lon"),o(e,"lat")],a=i(e,"ele"),r=i(e,"gpxtpx:hr")||i(e,"hr"),s=i(e,"time");return a&&(t=parseFloat(l(a)),t&&n.push(t)),{coordinates:n,time:s?l(s):null,heartRate:r?parseFloat(l(r)):null}}function d(){return{type:"FeatureCollection",features:[]}}function p(e){return void 0!==e.xml?e.xml:f.serializeToString(e)}var f,m=/\s*/g,g=/^\s*|\s*$/g,v=/\s+/;"undefined"!=typeof XMLSerializer?f=new XMLSerializer:"object"!=typeof exports||"object"!=typeof process||process.browser||(f=new(require("xmldom").XMLSerializer));var y={kml:function(o){function a(e){var t,n;return e=e||"","#"===e.substr(0,1)&&(e=e.substr(1)),(6===e.length||3===e.length)&&(t=e),8===e.length&&(n=parseInt(e.substr(0,2),16)/255,t=e.substr(2)),[t,isNaN(n)?void 0:n]}function s(e){return r(e.split(" "))}function h(e){var n,o=t(e,"coord","gx"),i=[],a=[];for(0===o.length&&(o=t(e,"gx:coord")),n=0;n<o.length;n++)i.push(s(l(o[n])));var r=t(e,"when");for(n=0;n<r.length;n++)a.push(l(r[n]));return{coords:i,times:a}}function f(e){var n,o,a,r,s,d=[],p=[];if(i(e,"MultiGeometry"))return f(i(e,"MultiGeometry"));if(i(e,"MultiTrack"))return f(i(e,"MultiTrack"));if(i(e,"gx:MultiTrack"))return f(i(e,"gx:MultiTrack"));for(a=0;a<y.length;a++)if(o=t(e,y[a]))for(r=0;r<o.length;r++)if(n=o[r],"Point"===y[a])d.push({type:"Point",coordinates:c(l(i(n,"coordinates")))});else if("LineString"===y[a])d.push({type:"LineString",coordinates:u(l(i(n,"coordinates")))});else if("Polygon"===y[a]){var m=t(n,"LinearRing"),g=[];for(s=0;s<m.length;s++)g.push(u(l(i(m[s],"coordinates"))));d.push({type:"Polygon",coordinates:g})}else if("Track"===y[a]||"gx:Track"===y[a]){var v=h(n);d.push({type:"LineString",coordinates:v.coords}),v.times.length&&p.push(v.times)}return{geoms:d,coordTimes:p}}function m(e){var o,r=f(e),s={},c=l(i(e,"name")),u=l(i(e,"styleUrl")),h=l(i(e,"description")),d=i(e,"TimeSpan"),p=i(e,"ExtendedData"),m=i(e,"LineStyle"),g=i(e,"PolyStyle");if(!r.geoms.length)return[];if(c&&(s.name=c),u&&v[u]&&(s.styleUrl=u,s.styleHash=v[u]),h&&(s.description=h),d){var y=l(i(d,"begin")),L=l(i(d,"end"));s.timespan={begin:y,end:L}}if(m){var w=a(l(i(m,"color"))),b=w[0],x=w[1],S=parseFloat(l(i(m,"width")));b&&(s.stroke=b),isNaN(x)||(s["stroke-opacity"]=x),isNaN(S)||(s["stroke-width"]=S)}if(g){var P=a(l(i(g,"color"))),k=P[0],C=P[1],E=l(i(g,"fill")),M=l(i(g,"outline"));k&&(s.fill=k),isNaN(C)||(s["fill-opacity"]=C),E&&(s["fill-opacity"]="1"===E?1:0),M&&(s["stroke-opacity"]="1"===M?1:0)}if(p){var _=t(p,"Data"),T=t(p,"SimpleData");for(o=0;o<_.length;o++)s[_[o].getAttribute("name")]=l(i(_[o],"value"));for(o=0;o<T.length;o++)s[T[o].getAttribute("name")]=l(T[o])}r.coordTimes.length&&(s.coordTimes=1===r.coordTimes.length?r.coordTimes[0]:r.coordTimes);var O={type:"Feature",geometry:1===r.geoms.length?r.geoms[0]:{type:"GeometryCollection",geometries:r.geoms},properties:s};

return n(e,"id")&&(O.id=n(e,"id")),[O]}for(var g=d(),v={},y=["Polygon","LineString","Point","Track","gx:Track"],L=t(o,"Placemark"),w=t(o,"Style"),b=0;b<w.length;b++)v["#"+n(w[b],"id")]=e(p(w[b])).toString(16);for(var x=0;x<L.length;x++)g.features=g.features.concat(m(L[x]));return g},gpx:function(e){function n(e,n){var o=t(e,n),i=[],a=[],r=[],s=o.length;if(2>s)return{};for(var l=0;s>l;l++){var c=h(o[l]);i.push(c.coordinates),c.time&&a.push(c.time),c.heartRate&&r.push(c.heartRate)}return{line:i,times:a,heartRates:r}}function o(e){for(var o,i=t(e,"trkseg"),a=[],r=[],s=[],l=0;l<i.length;l++)o=n(i[l],"trkpt"),o.line&&a.push(o.line),o.times&&o.times.length&&r.push(o.times),o.heartRates&&o.heartRates.length&&s.push(o.heartRates);if(0!==a.length){var u=c(e);return r.length&&(u.coordTimes=1===a.length?r[0]:r),s.length&&(u.heartRates=1===a.length?s[0]:s),{type:"Feature",properties:u,geometry:{type:1===a.length?"LineString":"MultiLineString",coordinates:1===a.length?a[0]:a}}}}function a(e){var t=n(e,"rtept");if(t){var o={type:"Feature",properties:c(e),geometry:{type:"LineString",coordinates:t.line}};return o}}function r(e){var t=c(e);return t.sym=l(i(e,"sym")),{type:"Feature",properties:t,geometry:{type:"Point",coordinates:h(e).coordinates}}}function c(e){var t,n=["name","desc","author","copyright","link","time","keywords"],o={};for(t=0;t<n.length;t++)o[n[t]]=l(i(e,n[t]));return s(o)}var u,p,f=t(e,"trk"),m=t(e,"rte"),g=t(e,"wpt"),v=d();for(u=0;u<f.length;u++)p=o(f[u]),p&&v.features.push(p);for(u=0;u<m.length;u++)p=a(m[u]),p&&v.features.push(p);for(u=0;u<g.length;u++)v.features.push(r(g[u]));return v}};return y}(),e.KML=e.FeatureGroup.extend({options:{async:!0},initialize:function(t,n){e.Util.setOptions(this,n),this._kml=t,this._layers={},t&&this.addKML(t,n,this.options.async)},loadXML:function(e,t,n,o){void 0===o&&(o=this.options.async),void 0===n&&(n=this.options);var i=new window.XMLHttpRequest;i.open("GET",e,o);try{i.overrideMimeType("text/xml")}catch(a){}i.onreadystatechange=function(){4==i.readyState&&200==i.status&&t(i.responseXML,n)},i.send(null)},addKML:function(e,t,n){var o=this,i=function(e,t){o._addKML(e,t)};this.loadXML(e,i,t,n)},_addKML:function(t,n){var o=e.KML.parseKML(t);if(o&&o.length){for(var i=0;i<o.length;i++)this.fire("addlayer",{layer:o[i]}),this.addLayer(o[i]);this.latLngs=e.KML.getLatLngs(t),this.fire("loaded")}},latLngs:[]}),e.Util.extend(e.KML,{parseKML:function(e){for(var t,n=this.parseStyle(e),o=e.getElementsByTagName("Folder"),i=[],a=0;a<o.length;a++)this._check_folder(o[a])&&(t=this.parseFolder(o[a],n),t&&i.push(t));o=e.getElementsByTagName("Placemark");for(var r=0;r<o.length;r++)this._check_folder(o[r])&&(t=this.parsePlacemark(o[r],e,n),t&&i.push(t));return i},_check_folder:function(e,t){for(e=e.parentElement;e&&"Folder"!==e.tagName;)e=e.parentElement;return!e||e===t},parseStyle:function(t){function n(e){for(var t={},o=0;o<e.childNodes.length;o++){var i=e.childNodes[o],r=i.tagName;if(a[r])if("hotSpot"===r)for(var s=0;s<i.attributes.length;s++)t[i.attributes[s].name]=i.attributes[s].nodeValue;else{var l=i.childNodes[0].nodeValue;"color"===r?(t.opacity=parseInt(l.substring(0,2),16)/255,t.color="#"+l.substring(2,8)):"width"===r?t.weight=l:"Icon"===r?(h=n(i),h.href&&(t.href=h.href)):"href"===r&&(t.href=l)}}return t}for(var o={},i=t.getElementsByTagName("Style"),a={color:!0,width:!0,Icon:!0,href:!0,hotSpot:!0},r=0;r<i.length;r++){var s,l=i[r],c={},u={},h={};s=l.getElementsByTagName("LineStyle"),s&&s[0]&&(c=n(s[0])),s=l.getElementsByTagName("PolyStyle"),s&&s[0]&&(u=n(s[0])),u.color&&(c.fillColor=u.color),u.opacity&&(c.fillOpacity=u.opacity),s=l.getElementsByTagName("IconStyle"),s&&s[0]&&(h=n(s[0])),h.href&&(c.icon=new e.KMLIcon({iconUrl:h.href,shadowUrl:null,iconAnchorRef:{x:h.x,y:h.y},iconAnchorType:{x:h.xunits,y:h.yunits}})),o["#"+l.getAttribute("id")]=c}return o},parseFolder:function(t,n){var o,i,a=[];o=t.getElementsByTagName("Folder");for(var r=0;r<o.length;r++)this._check_folder(o[r],t)&&(i=this.parseFolder(o[r],n),i&&a.push(i));o=t.getElementsByTagName("Placemark");for(var s=0;s<o.length;s++)this._check_folder(o[s],t)&&(i=this.parsePlacemark(o[s],t,n),i&&a.push(i));if(a.length)return 1===a.length?a[0]:new e.FeatureGroup(a)},parsePlacemark:function(t,n,o){var i,a,r,s={};for(r=t.getElementsByTagName("styleUrl"),i=0;i<r.length;i++){var l=r[i].childNodes[0].nodeValue;for(var c in o[l])s[c]=o[l][c]}var u=[],h=["LineString","Polygon","Point"];for(a in h){var d=h[a];for(r=t.getElementsByTagName(d),i=0;i<r.length;i++){var p=this["parse"+d](r[i],n,s);p&&u.push(p)}}if(u.length){var f=u[0];u.length>1&&(f=new e.FeatureGroup(u));var m,g="";for(r=t.getElementsByTagName("name"),r.length&&(m=r[0].childNodes[0].nodeValue),r=t.getElementsByTagName("description"),i=0;i<r.length;i++)for(a=0;a<r[i].childNodes.length;a++)g+=r[i].childNodes[a].nodeValue;return m&&f.bindPopup("<h2>"+m+"</h2>"+g),f}},parseCoords:function(e){var t=e.getElementsByTagName("coordinates");return this._read_coords(t[0])},parseLineString:function(t,n,o){var i=this.parseCoords(t);if(i.length)return new e.Polyline(i,o)},parsePoint:function(t,n,o){var i=t.getElementsByTagName("coordinates");if(i.length){var a=i[0].childNodes[0].nodeValue.split(",");return new e.KMLMarker(new e.LatLng(a[1],a[0]),o)}},parsePolygon:function(t,n,o){var i,a,r,s=[],l=[];for(i=t.getElementsByTagName("outerBoundaryIs"),a=0;a<i.length;a++)r=this.parseCoords(i[a]),r&&s.push(r);for(i=t.getElementsByTagName("innerBoundaryIs"),a=0;a<i.length;a++)r=this.parseCoords(i[a]),r&&l.push(r);return s.length?(o.fillColor&&(o.fill=!0),1===s.length?new e.Polygon(s.concat(l),o):new e.MultiPolygon(s,o)):void 0},getLatLngs:function(e){for(var t=e.getElementsByTagName("coordinates"),n=[],o=0;o<t.length;o++)n=n.concat(this._read_coords(t[o]));return n},_read_coords:function(t){var n,o="",i=[];for(n=0;n<t.childNodes.length;n++)o+=t.childNodes[n].nodeValue;for(o=o.split(/[\s\n]+/),n=0;n<o.length;n++){var a=o[n].split(",");a.length<2||i.push(new e.LatLng(a[1],a[0]))}return i}}),e.KMLIcon=e.Icon.extend({createIcon:function(){var e=this._createIcon("icon");return e.onload=function(){var t=new Image;t.src=this.src,this.style.width=t.width+"px",this.style.height=t.height+"px",("UNITS_FRACTION"===this.anchorType.x||"fraction"===this.anchorType.x)&&(e.style.marginLeft=-this.anchor.x*t.width+"px"),("UNITS_FRACTION"===this.anchorType.y||"fraction"===this.anchorType.x)&&(e.style.marginTop=-(1-this.anchor.y)*t.height+"px"),this.style.display=""},e},_setIconStyles:function(t,n){e.Icon.prototype._setIconStyles.apply(this,[t,n]),t.anchor=this.options.iconAnchorRef,t.anchorType=this.options.iconAnchorType}}),e.KMLMarker=e.Marker.extend({options:{icon:new e.KMLIcon.Default}})}(L,Exp),function(){"use strict";var e={VIEW:1,CREATE:2,EDIT:4,DELETE:8,APPEND:16,EDIT_APPEND:20,ALL:31};L.Pather=L.FeatureGroup.extend({initialize:function(e){this.options=Object.assign(this.defaultOptions(),e||{}),this.creating=!1,this.polylines=[],this.eventHandlers=[]},createPath:function(e){if(e.length<=1)return!1;this.clearAll();var t=new L.Pather.Polyline(this.map,e,this.options,{fire:this.fire.bind(this),mode:this.getMode.bind(this),remove:this.removePath.bind(this)});return this.polylines.push(t),this.fire("created",{polyline:t,latLngs:t.getLatLngs()}),t},removePath:function(e){if(e instanceof L.Pather.Polyline){var t=this.polylines.indexOf(e);return this.polylines.splice(t,1),e.softRemove(),this.fire("deleted",{polyline:e,latLngs:[]}),!0}return!1},getPaths:function(){return this.polylines},onAdd:function(e){var t=this.element=this.options.element||e.getContainer();this.draggingState=e.dragging._enabled,this.map=e,this.fromPoint={x:0,y:0},this.svg=d3.select(t).append("svg").attr("pointer-events","none").attr("class",this.getOption("moduleClass")).attr("width",this.getOption("width")).attr("height",this.getOption("height")),e.dragging.disable(),this.attachEvents(e),this.setMode(this.options.mode)},onRemove:function(){if(this.svg.remove(),this.options.removePolylines)for(var e=this.polylines.length;e--;)this.removePath(this.polylines[e]);this.map.off("mousedown",this.eventHandlers.mouseDown),this.map.off("mousemove",this.eventHandlers.mouseMove),this.map.off("mouseup",this.eventHandlers.mouseUp),this.map.getContainer().removeEventListener("mouseleave",this.eventHandlers.mouseLeave),this.element.classList.remove("mode-create"),this.element.classList.remove("mode-delete"),this.element.classList.remove("mode-edit"),this.element.classList.remove("mode-append");var t=this.map.getContainer().querySelector(".leaflet-tile-pane"),n=this.draggingState?"enable":"disable";t.style.pointerEvents="all",this.map.dragging[n]()},getEvent:function(e){return e.touches?e.touches[0]:e},edgeBeingChanged:function(){var e=this.polylines.filter(function(e){return e.manipulating});return 0===e.length?null:e[0]},isPolylineCreatable:function(){return!!(this.options.mode&e.CREATE)},events:{mouseDown:function(e){e=e.originalEvent||this.getEvent(e);var t=this.map.mouseEventToContainerPoint(e),n=this.map.containerPointToLatLng(t);this.isPolylineCreatable()&&!this.edgeBeingChanged()&&(this.creating=!0,this.fromPoint=this.map.latLngToContainerPoint(n),this.latLngs=[])},mouseMove:function(e){e=e.originalEvent||this.getEvent(e);var t=this.map.mouseEventToContainerPoint(e);if(this.edgeBeingChanged())return void this.edgeBeingChanged().moveTo(this.map.containerPointToLayerPoint(t));var n=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear");if(this.creating){var o=[this.fromPoint,new L.Point(t.x,t.y,!1)];this.latLngs.push(t),this.svg.append("path").classed(this.getOption("lineClass"),!0).attr("d",n(o)).attr("stroke",this.getOption("strokeColour")).attr("stroke-width",this.getOption("strokeWidth")).attr("fill","none"),this.fromPoint={x:t.x,y:t.y}}},mouseLeave:function(){this.clearAll(),this.creating=!1},mouseUp:function(){return this.creating?(this.creating=!1,this.createPath(this.convertPointsToLatLngs(this.latLngs)),void(this.latLngs=[])):void(this.edgeBeingChanged()&&(this.edgeBeingChanged().attachElbows(),this.edgeBeingChanged().finished(),this.edgeBeingChanged().manipulating=!1))}},attachEvents:function(e){this.eventHandlers={mouseDown:this.events.mouseDown.bind(this),mouseMove:this.events.mouseMove.bind(this),mouseUp:this.events.mouseUp.bind(this),mouseLeave:this.events.mouseLeave.bind(this)},this.map.on("mousedown",this.eventHandlers.mouseDown),this.map.on("mousemove",this.eventHandlers.mouseMove),this.map.on("mouseup",this.eventHandlers.mouseUp),this.map.getContainer().addEventListener("mouseleave",this.eventHandlers.mouseLeave),this.map.getContainer().addEventListener("touchstart",this.fire.bind(e,"mousedown")),this.map.getContainer().addEventListener("touchmove",this.fire.bind(e,"mousemove")),this.map.getContainer().addEventListener("touchend",this.fire.bind(e,"mouseup"))},convertPointsToLatLngs:function(e){return e.map(function(e){return this.map.containerPointToLatLng(e)}.bind(this))},clearAll:function(){this.svg.text("")},getOption:function(e){return this.options[e]||this.defaultOptions()[e]},defaultOptions:function(){return{moduleClass:"pather",lineClass:"drawing-line",detectTouch:!0,elbowClass:"elbow",removePolylines:!0,strokeColour:"rgba(0,0,0,.5)",strokeWidth:2,width:"100%",height:"100%",smoothFactor:10,pathColour:"black",pathOpacity:.55,pathWidth:3,mode:e.ALL}},setSmoothFactor:function(e){this.options.smoothFactor=parseInt(e)},setMode:function(t){this.setClassName(t),this.options.mode=t;var n=this.map.getContainer().querySelector(".leaflet-tile-pane"),o=function(){return this.detectTouch&&("ontouchstart"in $window||"onmsgesturechange"in $window)?this.options.mode&e.CREATE||this.options.mode&e.EDIT:this.options.mode&e.CREATE}.bind(this);if(o()){var i=this.draggingState?"disable":"enable";return n.style.pointerEvents="none",void this.map.dragging[i]()}n.style.pointerEvents="all",this.map.dragging.enable()},setClassName:function(t){var n=function(n){var o=["mode",n].join("-");return e[n.toUpperCase()]&t?void this.element.classList.add(o):void this.element.classList.remove(o)}.bind(this);n("create"),n("delete"),n("edit"),n("append")},getMode:function(){return this.options.mode},setOptions:function(e){this.options=Object.assign(this.options,e||{})}}),L.Pather.MODE=e,L.pather=function(e){return new L.Pather(e)}}(window),function(){"use strict";Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var n=Object(e),o=1;o<arguments.length;o++){var i=arguments[o];if(void 0!==i&&null!==i){i=Object(i);for(var a=Object.keys(Object(i)),r=0,s=a.length;s>r;r++){var l=a[r],c=Object.getOwnPropertyDescriptor(i,l);void 0!==c&&c.enumerable&&(n[l]=i[l])}}}return n}})}(),function(){"use strict";var e="undefined"==typeof Symbol?"_pather":Symbol["for"]("pather");L.Pather.Polyline=function(e,t,n,o){this.options={color:n.pathColour,opacity:n.pathOpacity,weight:n.pathWidth,smoothFactor:n.smoothFactor||1,elbowClass:n.elbowClass},this.polyline=new L.Polyline(t,this.options).addTo(e),this.map=e,this.methods=o,this.edges=[],this.manipulating=!1,this.attachPolylineEvents(this.polyline),this.select()},L.Pather.Polyline.prototype={select:function(){this.attachElbows()},deselect:function(){this.manipulating=!1},attachElbows:function(){this.detachElbows(),this.polyline._parts[0].forEach(function(t){var n=new L.DivIcon({className:this.options.elbowClass}),o=this.map.layerPointToLatLng(t),i=new L.Marker(o,{icon:n}).addTo(this.map);i[e]={point:t},this.attachElbowEvents(i),this.edges.push(i)}.bind(this))},detachElbows:function(){this.edges.forEach(function(e){this.map.removeLayer(e)}.bind(this)),this.edges.length=0},attachPolylineEvents:function(e){e.on("click",function(e){if(e.originalEvent.stopPropagation(),e.originalEvent.preventDefault(),this.methods.mode()&L.Pather.MODE.APPEND){var t=this.map.mouseEventToLatLng(e.originalEvent);this.insertElbow(t)}else this.methods.mode()&L.Pather.MODE.DELETE&&this.methods.remove(this)}.bind(this))},attachElbowEvents:function(e){e.on("mousedown",function(t){t=t.originalEvent||t,this.methods.mode()&L.Pather.MODE.EDIT&&(t.stopPropagation&&(t.stopPropagation(),t.preventDefault()),this.manipulating=e)}.bind(this)),e.on("mouseup",function(e){e=e.originalEvent||e,e.stopPropagation&&(e.stopPropagation(),e.preventDefault()),this.manipulating=!1}),e._icon.addEventListener("touchstart",e.fire.bind(e,"mousedown")),e._icon.addEventListener("touchend",e.fire.bind(e,"mouseup"))},insertElbow:function(e){var t=this.map.latLngToLayerPoint(e),n=1/0,o=-1,i=this.polyline._parts[0];i.forEach(function(e,a){var r=i[a+1]||i[0],s=L.LineUtil.pointToSegmentDistance(t,e,r);n>s&&(n=s,o=a)}.bind(this)),i.splice(o+1,0,t);var a=i.map(function(e){var t=this.map.layerPointToLatLng(e);return{_latlng:t}}.bind(this));this.redraw(a),this.attachElbows()},moveTo:function(e){var t=this.map.layerPointToLatLng(e);this.manipulating.setLatLng(t),this.redraw(this.edges)},finished:function(){this.methods.fire("edited",{polyline:this,latLngs:this.getLatLngs()})},redraw:function(e){var t=[],n={};e.forEach(function(e){t.push(e._latlng)}),Object.keys(this.options).forEach(function(e){n[e]=this.options[e]}.bind(this)),n.smoothFactor=0,this.softRemove(!1),this.polyline=new L.Polyline(t,n).addTo(this.map),this.attachPolylineEvents(this.polyline)},softRemove:function(e){e="undefined"==typeof e?!0:e,this.map.removeLayer(this.polyline),e&&this.edges.forEach(function(e){this.map.removeLayer(e)}.bind(this))},getLatLngs:function(){return this.polyline._parts[0].map(function(e){return this.map.layerPointToLatLng(e)}.bind(this))}}}(),function(e){"use strict";e.Control.Features=e.Control.extend({_active:!1,_map:null,includes:e.Mixin.Events,options:{position:"topleft",className:"fa fa-location-arrow fa-rotate-180",modal:!1},onAdd:function(t){this._map=t,this._container=e.DomUtil.create("div","leaflet-feature-control leaflet-bar"),this._container.title="Show features under point";var n=e.DomUtil.create("a",this.options.className,this._container);return n.href="#",e.DomEvent.on(this._container,"dblclick",e.DomEvent.stop).on(this._container,"click",e.DomEvent.stop).on(this._container,"click",function(n){this._active=!this._active,this._active?(t.fireEvent("featuresactivate",n),e.DomUtil.addClass(this,"active")):(t.fireEvent("featuresdeactivate",n),e.DomUtil.removeClass(this,"active"))}),this._container},activate:function(){e.DomUtil.addClass(this._container,"active")},deactivate:function(){e.DomUtil.removeClass(this._container,"active"),this._active=!1}}),e.control.features=function(t){return new e.Control.Features(t)}}(L),L.Google=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1,mapOptions:{backgroundColor:"#dddddd"}},initialize:function(e,t){L.Util.setOptions(this,t),this._ready=void 0!==google.maps.Map,this._ready||L.Google.asyncWait.push(this),this._type=e||"SATELLITE"},onAdd:function(e,t){this._map=e,this._insertAtTheBottom=t,this._initContainer(),this._initMapObject(),e.on("viewreset",this._resetCallback,this),this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this),e.on("move",this._update,this),e.on("zoomanim",this._handleZoomAnim,this),e._controlCorners.bottomright.style.marginBottom="20px",this._reset(),this._update()},onRemove:function(e){e._container.removeChild(this._container),e.off("viewreset",this._resetCallback,this),e.off("move",this._update,this),e.off("zoomanim",this._handleZoomAnim,this),e._controlCorners.bottomright.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(e){this.options.opacity=e,1>e&&L.DomUtil.setOpacity(this._container,e)},setElementSize:function(e,t){e.style.width=t.x+"px",e.style.height=t.y+"px"},_initContainer:function(){var e=this._map._container,t=e.firstChild;this._container||(this._container=L.DomUtil.create("div","leaflet-google-layer leaflet-top leaflet-left"),this._container.id="_GMapContainer_"+L.Util.stamp(this),this._container.style.zIndex="auto"),e.insertBefore(this._container,t),this.setOpacity(this.options.opacity),this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(this._ready){this._google_center=new google.maps.LatLng(0,0);var e=new google.maps.Map(this._container,{center:this._google_center,zoom:0,tilt:0,mapTypeId:google.maps.MapTypeId[this._type],disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:this.options.mapOptions.styles,backgroundColor:this.options.mapOptions.backgroundColor}),t=this;this._reposition=google.maps.event.addListenerOnce(e,"center_changed",function(){t.onReposition()}),this._google=e,google.maps.event.addListenerOnce(e,"idle",function(){t._checkZoomLevels()}),this.fire("MapObjectInitialized",{mapObject:e})}},_checkZoomLevels:function(){this._google.getZoom()!==this._map.getZoom()&&this._map.setZoom(this._google.getZoom())},_resetCallback:function(e){this._reset(e.hard)},_reset:function(e){this._initContainer()},_update:function(e){if(this._google){this._resize();var t=this._map.getCenter(),n=new google.maps.LatLng(t.lat,t.lng);this._google.setCenter(n),this._google.setZoom(Math.round(this._map.getZoom())),this._checkZoomLevels()}},_resize:function(){var e=this._map.getSize();(this._container.style.width!==e.x||this._container.style.height!==e.y)&&(this.setElementSize(this._container,e),this.onReposition())},_handleZoomAnim:function(e){var t=e.center,n=new google.maps.LatLng(t.lat,t.lng);this._google.setCenter(n),this._google.setZoom(Math.round(e.zoom))},onReposition:function(){this._google&&google.maps.event.trigger(this._google,"resize")}}),L.Google.asyncWait=[],L.Google.asyncInitialize=function(){var e;for(e=0;e<L.Google.asyncWait.length;e++){var t=L.Google.asyncWait[e];t._ready=!0,t._container&&(t._initMapObject(),t._update())}L.Google.asyncWait=[]},function(e){"use strict";e.Control.Legend=e.Control.extend({_active:!1,_map:null,includes:e.Mixin.Events,options:{position:"topleft",className:"fa fa-list",modal:!1},onAdd:function(t){this._map=t,this._container=e.DomUtil.create("div","leaflet-legend-control leaflet-bar"),this._container.title="Show legend";var n=e.DomUtil.create("a",this.options.className,this._container);return n.href="#",e.DomEvent.on(this._container,"dblclick",e.DomEvent.stop).on(this._container,"click",e.DomEvent.stop).on(this._container,"click",function(){this._active=!this._active,this._active?(this._legend=e.control({position:"topleft"}),this._legend.onAdd=function(t){var n=e.DomUtil.create("div","leaflet-legend"),o='<img src="resources/img/mapkey_topo2.png"></img>';return n.innerHTML=o,n},t.addControl(this._legend)):t.removeControl(this._legend)}),this._container},activate:function(){e.DomUtil.addClass(this._container,"active")},deactivate:function(){e.DomUtil.removeClass(this._container,"active"),this._active=!1}}),e.control.legend=function(t){return new e.Control.Legend(t)}}(L),L.Control.MousePosition=L.Control.extend({options:{position:"bottomleft",separator:" : ",emptyString:"Unavailable",lngFirst:!1,numDigits:5,lngFormatter:void 0,latFormatter:void 0,prefix:""},onAdd:function(e){return this._container=L.DomUtil.create("div","leaflet-control-mouseposition"),L.DomEvent.disableClickPropagation(this._container),e.on("mousemove",this._onMouseMove,this),this._container.innerHTML=this.options.emptyString,this._container},onRemove:function(e){e.off("mousemove",this._onMouseMove)},_onMouseMove:function(e){var t=this.options.lngFormatter?this.options.lngFormatter(e.latlng.lng):L.Util.formatNum(e.latlng.lng,this.options.numDigits),n=this.options.latFormatter?this.options.latFormatter(e.latlng.lat):L.Util.formatNum(e.latlng.lat,this.options.numDigits),o=this.options.lngFirst?t+this.options.separator+n:n+this.options.separator+t,i=this.options.prefix+" "+o;this._container.innerHTML=i}}),L.Map.mergeOptions({positionControl:!1}),L.Map.addInitHook(function(){this.options.positionControl&&(this.positionControl=new L.Control.MousePosition,this.addControl(this.positionControl))}),L.control.mousePosition=function(e){return new L.Control.MousePosition(e)},L.Control.ZoomBox=L.Control.extend({_active:!1,_map:null,includes:L.Mixin.Events,options:{position:"topleft",className:"fa fa-search-plus",modal:!1},onAdd:function(e){this._map=e,this._container=L.DomUtil.create("div","leaflet-zoom-box-control leaflet-bar"),this._container.title="Zoom to specific area";var t=L.DomUtil.create("a",this.options.className,this._container);t.href="#";var n=e.boxZoom._onMouseDown;return e.boxZoom._onMouseDown=function(t){n.call(e.boxZoom,{clientX:t.clientX,clientY:t.clientY,which:1,shiftKey:!0})},e.on("zoomend",function(){e.getZoom()==e.getMaxZoom()?L.DomUtil.addClass(t,"leaflet-disabled"):L.DomUtil.removeClass(t,"leaflet-disabled")},this),this.options.modal||e.on("boxzoomend",this.deactivate,this),L.DomEvent.on(this._container,"dblclick",L.DomEvent.stop).on(this._container,"click",L.DomEvent.stop).on(this._container,"click",function(){this._active=!this._active,this._active&&e.getZoom()!=e.getMaxZoom()?this.activate():this.deactivate()},this),this._container},activate:function(){L.DomUtil.addClass(this._container,"active"),this._map.dragging.disable(),this._map.boxZoom.addHooks(),L.DomUtil.addClass(this._map.getContainer(),"leaflet-zoom-box-crosshair")},deactivate:function(){L.DomUtil.removeClass(this._container,"active"),this._map.dragging.enable(),this._map.boxZoom.removeHooks(),L.DomUtil.removeClass(this._map.getContainer(),"leaflet-zoom-box-crosshair"),this._active=!1,this._map.boxZoom._moved=!1}}),L.control.zoomBox=function(e){return new L.Control.ZoomBox(e)},L.Control.Zoomout=L.Control.extend({_active:!1,_map:null,includes:L.Mixin.Events,options:{position:"topleft",className:"fa fa-search-minus",modal:!1},onAdd:function(e){this._map=e,this._container=L.DomUtil.create("div","leaflet-zoom-box-control leaflet-bar"),this._container.title="Zoom out";var t=L.DomUtil.create("a",this.options.className,this._container);return t.href="#",e.on("zoomend",function(){e.getZoom()==e.getMaxZoom()?L.DomUtil.addClass(t,"leaflet-disabled"):L.DomUtil.removeClass(t,"leaflet-disabled")},this),e.on("boxzoomend",this.deactivate,this),L.DomEvent.on(this._container,"dblclick",L.DomEvent.stop).on(this._container,"click",L.DomEvent.stop).on(this._container,"click",function(){this._active=!this._active;var t,n=e.getZoom();n<=e.getMinZoom()||(t=10>n?n-1:13>n?n-2:n-3,e.setZoom(t))},this),this._container},activate:function(){L.DomUtil.addClass(this._container,"active")},deactivate:function(){L.DomUtil.removeClass(this._container,"active"),this._active=!1}}),L.control.zoomout=function(e){return new L.Control.Zoomout(e)},angular.module("exp.map.templates",[]).run(["$templateCache",function(e){e.put("map/addroute/routeManager.html",'<div>\r\n	<div ng-repeat="route in routes" ng-title="{{route.description}}">\r\n		<i class="fa" ng-class="{\'fa-road\':route.type == \'ROAD\', \'rail\':route.type == \'RAIL\', \'power\':route.type == \'POWERLINE\', \'pipe\':route.type == \'PIPELINE\'}"\r\n			title="{{route.type == \'ROAD\'?\'Road\':route.type == \'RAIL\'?\'Rail line\' :route.type == \'POWERLINE\'?\'Power line\' :route.type == \'PIPELINE\'?\'Pipe line\':\'\'}}"></i>\r\n		<span class="ellipsis" style="width:18em;" ng-mouseenter="mouseenter()" ng-mouseleave="mouseleave()">{{route.name}}</span>\r\n		<div style="float:right">\r\n			<a class="featureLink" href="javascript:;" title="Plot feature\'s elevation" \r\n				ng-click="showElevation()"><i class="fa fa-align-left fa-rotate-270"></i></a>\r\n			<a class="featureLink" href="javascript:;" title="Show on map" \r\n				ng-click="toggleRoute()"><i class="fa" ng-class="{\'fa-eye\':(!route.showing), \'fa-eye-slash\':route.showing}"></i></a>\r\n			<a class="featureLink" href="javascript:;" title="Pan map to feature" \r\n				ng-click="panToVector()"><i class="fa fa-flag"></i></a>		\r\n			<a href="javascript:" exp-confirm="\'Are you sure that you want to delete this route?\'" success="removeRoute()" title="Remove route from collection.">\r\n				<i class="fa fa-remove" title="Remove this route from your added routes."></i>\r\n			</a>						\r\n		</div>\r\n	</div>\r\n	\r\n</div>\r\n<div>\r\n	<button type="button" class="btn btn-default" style="margin:2px;width:100%" ng-hide="addRoute" ng-click="showAddRoute()">Add infrastructure route</button>\r\n	<div ng-show="addRoute" class="addRoute">\r\n		<div>\r\n			<label for="addRouteType">Type</label>\r\n			<select ng-model="newRoute.type" ng-options="k as v for (k,v) in types"></select>\r\n		</div>\r\n		<div>\r\n			<label for="addRouteName">Name</label>\r\n			<input type="text" ng-model="newRoute.name" id="addRouteName" required="required"/>\r\n		</div>\r\n		<div>\r\n			<label for="addRouteDescription">Description</label>\r\n			<input type="text" ng-model="newRoute.description" id="addRouteDescription"/>\r\n		</div>\r\n		<div>\r\n			<label for="routeWktAdded">Path drawn</label>\r\n			<i class="fa fa-check" style="font-size:120%; color:lightgreen" ng-show="newRoute.wkt"></i>\r\n			<span ng-hide="newRoute.wkt" style="border:1px solid #eb0d0a;padding:2px">Click map for points. Double click to complete</span>\r\n		</div>\r\n	</div>\r\n	<div ng-show="addRoute" style="text-align: right;">\r\n		<button type="button" class="btn btn-default" style="width:6em" ng-click="cancelRoute()">Cancel</button>\r\n		<button type="button" class="btn btn-default" style="width:6em" ng-click="saveRoute()" ng-disabled="!(newRoute.type && newRoute.name && newRoute.wkt)">Save</button>\r\n	</div>\r\n</div>\r\n</div>\r\n'),e.put("map/baselayer/baseLayerSlider.html",'<span style="width:30em;">\r\n	<span id="baselayerCtrl">\r\n 		<input id="baselayerSlider" class="temperature" baselayer-slider title="Slide to emphasize either a satellite or topography view." />\r\n	</span>\r\n</span>'),e.put("map/clip/clip.html",'<div mars-rfc-selector hide="noRfcSelector" extent="extent" selector="rfcSelector" ng-show="rfcSelector"></div>\r\n'),e.put("map/clip/rfcSelector.html",'<div class="rfcSelectorWindow">\r\n    <div class="modal-header">\r\n        <h3 class="modal-title" style="font-weight:bold">Select reference feature classes of interest</h3>\r\n    </div>\r\n	<div ng-repeat="(key, asset) in featureClasses" class="rfcSelectorList" style="padding:2px">\r\n		<span>\r\n			<input type="checkbox" ng-attr-name="szc{{key}}" ng-model="asset.clipSelected"/>\r\n		</span>\r\n		<span class="ellipsis" style="width:250px;display:inline-block">\r\n			<label ng-attr-for="szc{{key}}" style="margin-bottom:0px">{{asset.label}}</label>\r\n		</span>\r\n	</div>\r\n	\r\n	<div style="width: 100%; overflow: hidden;padding-top:5px">\r\n	    <div style="width: 4em; float: left;padding-top:5px;font-weight:bold"><label for="szcEmailAddress">Notify</label></div>\r\n    	<div style="margin-left: 4em;">\r\n    		<input type="email" ng-model="email" name="szcEmailAddress" style="width:100%" placeholder="Email address"/>\r\n    	</div>\r\n		<div style="text-align:center">Email job completion notification.</div>\r\n	</div>\r\n	<div style="clear:both"></div>\r\n	<div  class="buttons" style="text-align:right; padding:7px">\r\n		<button type="button" class="btn btn-default" style="width:4em;margin-top:2px" ng-click="cancel()" title="Cancel calculation of least cost path">Cancel</button>\r\n		<button type="button" class="btn btn-default focusMe" style="width:4em;margin-top:2px" ng-click="startClipZipShip()" title="Select one or more reference feature classes before continuing." ng-disabled="featureClasses | noClipSelected">Process</button>\r\n	</div>\r\n</div>'),e.put("map/elevation/elevation.html",'<div class="container-full elevationContainer" ng-show="geometry" style="background-color:white; opacity:0.9;padding:2px">\r\n	<div class="row">\r\n		<div class="col-md-4">\r\n			<span class="graph-brand">Path Elevation</span>\r\n		</div>	\r\n		<div class="col-md-8">\r\n			<div class="btn-toolbar pull-right" role="toolbar" style="margin-right: 3px;">\r\n				<div class="btn-group" ng-show="intersectsWaterTable">	\r\n					<button type="button" class="btn btn-default" ng-click="toggleWaterTable()" \r\n							title="Show groundwater over elevation">{{paths.length == 1?\'Show\':\'Hide\'}} Water Table</button>\r\n				</div>	\r\n				<div class="btn-group">	\r\n					<button type="button" class="btn btn-default" title="Find out information about the data behind these graphs" \r\n							ng-click="showInfo = !showInfo">\r\n						<i class="fa fa-info-circle" role="presentation" style="font-size:16px; color:black"></i>\r\n					</button>\r\n					<exp-info title="Graph Information" style="width:400px;position:absolute;bottom:-80px;right:60px" is-open="showInfo"><div mars-info-elevation></div></exp-info>				\r\n					<button type="button" class="btn btn-default" title="Close graphs" ng-click="close()">\r\n						<i class="fa fa-times-circle" role="presentation" style="font-size:16px; color:black"></i>\r\n					</button>				\r\n				</div>\r\n			</div>\r\n		</div>	\r\n	</div>\r\n	<div explorer-graph data="paths" config="config" click="graphClick(event)" move="graphMove(event)" leave="graphLeave(event)" enter="graphEnter(event)" show-zero-line="true"></div>\r\n	<div exp-point-features features="featuresUnderPoint" class="featuresUnderPoint"></div>\r\n	<div exp-point point="point" class="featuresInfo" style="display:none"></div>\r\n</div>'),e.put("map/elevation/elevationInfo.html",'<div>\r\nThe elevation graph is calculated from the 3" DEM data. \r\nThe data is held in a grid with a cell size of approx. 90 m. \r\nThe data has a &plusmn;5 m error. Full metadata about the data and how to acquire the data can be found \r\n<a target="_blank" href="http://www.ga.gov.au/metadata-gateway/metadata/record/gcat_aac46307-fce9-449d-e044-00144fdd4fa6">here</a>\r\n<br/>\r\nIf the path of the graph intersects areas that we have prepared water table data there will be the ability to plot this data. \r\nThe accuracy is not as high as the elevation data and has &plusmn;50 m error. Smoothing with this error can make the \r\nwater table appear above the elevation of the surface on occasions. \r\nData availability will be indicated by the button labelled "Show Water Table". \r\n<a href="javascript:;" ng-click="toggleWaterTableShowing()">Click to {{state.isWaterTableShowing?\'hide\':\'view\'}} the water table extent.</a>\r\n</div>\r\n'),
e.put("map/featuresummary/featuresSummary.html",'<div class="marsfeatures" ng-show="features" ng-style="featurePanelPosition()" ng-class="features.popupClass">\r\n	<div id="menu_mn_active_tt_active" data-role="popup" role="tooltip">\r\n		<div class="pathContent">\r\n			<div ng-repeat="(key, feature) in features.data">\r\n				{{mappings[key].title}}  ({{feature}})\r\n			</div>\r\n			<div ng-hide="features.count">No nearby features</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'),e.put("map/layerinspector/layerInspector.html",'<div class="interactionPanel">\r\n	<div class="exp-block" ng-show="active" style="height:100%">\r\n		<div class="exp-header">\r\n			<div class="interactionPanelHeader" ng-hide="hidename">\r\n				<a href="javascript:;" ng-click="click()" ng-show="showClose" title="Name is {{name || active.name}}">{{name || active.name}}</a>\r\n				<span ng-hide="showClose">{{name || active.name}}</span>\r\n			</div>\r\n			<div style="float:right">\r\n				<a class="featureLink" href="javascript:;" title="Show on map" \r\n						ng-click="toggleShow(active)"><i class="fa" ng-class="{\'fa-eye-slash\':(!active.displayed), \'fa-eye\':active.displayed}"></i></a>\r\n				<a class="featureLink" href="javascript:;" title="Collapse extra information" ng-show="showClose"\r\n						ng-click="click()"><i class="fa fa-caret-square-o-up"></i></a>\r\n			</div>\r\n		</div>\r\n		<div>\r\n			<div class="thumbNailContainer" ng-show="active.thumbUrl">\r\n				<img width="100" ng-src="{{active.thumbUrl}}" class="img-thumbnail" alt="{{active.description}}"></img>\r\n			</div>\r\n			<strong>Opacity</strong><br/>\r\n			<span explorer-layer-slider layer="active.layer" title="Change the opacity of the selected layer when shown on the map" class="opacitySlider"></span>\r\n			<p/>\r\n			{{active.description}}\r\n		</div> \r\n	</div>\r\n</div>'),e.put("map/leastcostpath/leastCostDisplay.html",'<exp-modal is-open="results.data" style="position:fixed;top:132px;left:42px" title="Least cost path control panel" on-close="clear()">\r\n	<div ng-if="results.data.jobStatus != \'esriJobFailed\'" class="esriLcpSuccess">\r\n		<div>\r\n			<div>\r\n				<div style="float:left;font-zize:120%; font-weight:bold; padding:5px;">View...</div>\r\n				<div style="float:right">\r\n					<a class="featureLink" href="javascript:;" title="Bring least cost path layers to the top of the map."\r\n							ng-click="bringToTop()"><i class="fa fa-arrow-up"></i> </a>\r\n				</div>\r\n				<div ng-mouseenter="mouseenterPath()" ng-mouseleave="mouseleavePath()" style="clear:both">\r\n					<div>\r\n						<div style="float: left;padding-left:16px">\r\n							Original drawn path\r\n						</div>\r\n						<div style="float: right">					\r\n							<a class="featureLink" href="javascript:;" title="Plot elevation for path."\r\n								ng-click="elevationPath()"><i class="fa fa-align-left fa-rotate-270"></i> </a>									\r\n							<a class="featureLink" href="javascript:;" title="Toggle showing original drawn path on map" \r\n								ng-click="togglePath()"><i class="fa" ng-class="{\'fa-eye\':(!pathShown), \'fa-eye-slash\':pathShown}"></i></a>\r\n						</div>\r\n					</div>\r\n				</div>\r\n\r\n				<div ng-mouseenter="mouseenterLcp()" ng-mouseleave="mouseleaveLcp()" >\r\n					<div>\r\n						<div style="float: left;padding-left:16px">\r\n							Least cost path\r\n						</div>\r\n						<div style="float: right">				\r\n							<a class="featureLink" href="javascript:;" title="Plot elevation for least cost path."\r\n								ng-click="elevationLcpKml()"><i class="fa fa-align-left fa-rotate-270"></i> </a>\r\n							<a class="featureLink" href="javascript:;" title="Toggle showing least cost path on map" \r\n								ng-click="toggleLcpKml()"><i class="fa" ng-class="{\'fa-eye\':(!lcpKmlShown), \'fa-eye-slash\':lcpKmlShown}"></i></a>\r\n						</div>\r\n					</div>\r\n				</div>\r\n\r\n\r\n				<div ng-mouseenter="mouseenterLcpBuffer()" ng-mouseleave="mouseleaveLcpBuffer()" >\r\n					<div>\r\n						<div style="float: left;padding-left:16px">\r\n							Least cost path buffer\r\n						</div>\r\n						<div style="float: right">\r\n							<a class="featureLink" href="javascript:;" title="Toggle showing least cost path buffer on map" \r\n								ng-click="toggleLcpBufferKml()"><i class="fa" ng-class="{\'fa-eye\':(!lcpBufferKmlShown), \'fa-eye-slash\':lcpBufferKmlShown}"></i></a>							\r\n						</div>\r\n					</div>\r\n				</div>\r\n	\r\n				<div ng-mouseenter="mouseenterCostSurface()" ng-mouseleave="mouseleaveCostSurface()" >\r\n					<div>\r\n						<div style="float: left;padding-left:16px">\r\n							Cost surface\r\n						</div>\r\n						<div style="float: right">		\r\n							<a class="featureLink" href="javascript:;" title="Toggle showing cost surface on map" \r\n								ng-click="toggleCostSurface()"><i class="fa" ng-class="{\'fa-eye\':(!costSurfaceShown), \'fa-eye-slash\':costSurfaceShown}"></i></a>	\r\n						</div>\r\n					</div>\r\n				</div>	\r\n	\r\n				<button type="button" class="btn btn-default" style="margin:2px;width:90%" ng-click="zoomToCentre()">Zoom to least cost path.</button>\r\n			</div>\r\n			<br/>\r\n			<div>\r\n				<div style="font-zize:120%; font-weight:bold; padding:5px;" title="Requires that you have Google Earth installed and associated with KML and KMZ files.">Link to Google Earth...</div>\r\n				<div ng-repeat="(key, result) in results.data.results" ng-show="key | lcpLookup : \'showInGoogle\'">\r\n					<a target="_blank" ng-href="{{urls[key]}}" style="margin:3px;width:14em;display:inline-block">{{key | lcpLookup}}</a> ({{key | lcpLookup : "fileType"}})<br/>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div ng-if="results.data.jobStatus == \'esriJobFailed\'">\r\n		<div>\r\n			The least cost path process failed. You may be able to help provide<br/>\r\n			information to assist the resolution of this problem by reporting:\r\n			<pre>ESRI Least cost path processing failed.\r\nTime: {{results.data.timeStamp | date : \'d/M/yyyy hh:mm:ss a\'}}\r\nJob ID: {{results.data.jobId}}</pre>\r\n		</div>\r\n	</div>\r\n	<div style="clear:both;padding:5px;text-align:center"></div>\r\n</exp-modal>'),e.put("map/leastcostpath/leastCostWeightings.html",'<div class="marsWeightings">\r\n	<div class="panel-group" id="accordion">\r\n		<div class="panel panel-default" ng-repeat="category in weightings"  ng-show="category.group.length">\r\n   			<div class="panel-heading">\r\n   				{{category.label}}\r\n   			</div>\r\n   			<div id="collapseOne" class="panel-collapse collapse in">\r\n   				<div class="panel-body">\r\n					<div ng-repeat="weighting in category.group" class="lcpSlider">\r\n						<div style="float:left">\r\n							<input type="checkbox" ng-model="weighting.selected" class="fixAlignment" />\r\n							<span class="leastCostPathLabel" ng-class="{disabled:!weighting.selected}">{{weighting.label}}</span>\r\n						</div>\r\n						<span style="width:180px;float:right;margin-right:20px" path-least-cost-slider></span>\r\n						<div style="clear:both"></div>\r\n					</div>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div style="padding-left:7px;padding-bottom:7px">\r\n		<label for="lcpBufferSelect">Path bounding box buffered by:</label>\r\n		<select ng-model="bufferPercent" ng-options="k as v for (k, v) in bufferValues"></select>%\r\n	</div>\r\n	<div  class="buttons" style="float:right">\r\n		<button type="button" class="btn btn-default" style="width:6em;margin:2px" ng-click="cancelLeastCostPath()" title="Cancel calculation of least cost path">Cancel</button>\r\n		<button type="button" class="btn btn-default focusMe" style="width:6em;margin:2px" ng-click="showLeastCostPath($event)" title="Confirm to continue calculation of least cost path">Continue</button>\r\n	</div>\r\n	<div style="clear:both;text-align:center"><strong>Note:</strong>The processing can take a while.<br/>You will be notified when the process is complete.</div>\r\n</div>'),e.put("map/point/point.html",'<exp-modal class="pointInspector ng-cloak" icon-class="fa-map-marker" is-open="point" on-close="clearPoint()" title="Features within approx. 2km">	\r\n	<div class="pointContent" ng-controller="OverFeatureCtrl as over">\r\n		<div style="padding-bottom:7px;">Elev. {{point.z | length : true}}, Lat. {{point.y | number : 3}}&deg;, Long. {{point.x | number:3}}&deg;</div>\r\n		<div ng-show="featuresInfo.results.length > 0">\r\n			<div>\r\n				<div style="float:left; padding-bottom:10px">{{allHidden() && "Show" || "Hide"}} all features</div>\r\n				<div style="float: right">				\r\n					<a class="featureLink" href="javascript:;" title="Show all features on map"\r\n						ng-click="toggleAll()"><i class="fa" ng-class="{\'fa-eye-slash\':allHidden(), \'fa-eye\':!allHidden()}"></i></a>\r\n				</div>\r\n			</div>\r\n			<div style="clear:both;"></div>\r\n		</div>\r\n		<div ng-hide="featuresInfo.results.length > 0">No nearby features.</div>\r\n	\r\n		<div ng-repeat="item in featuresInfo.results | featureGroups" ng-class="{\'underlined\':!$last}">\r\n			<div ng-show="greaterThanOneItem()"  ng-mouseover="over.groupEnter(featuresInfo.results, item)" ng-mouseout="over.groupLeave(featuresInfo.results, item)">\r\n				<div style="float:left">\r\n					<button type="button" class="undecorated" ng-click="expanded = !expanded"><i class="fa fa-caret-right pad-right" ng-class="{\'fa-caret-down\':expanded,\'fa-caret-right\':(!expanded)}"></i></button></button><strong>{{metadata[item].heading}}</strong>\r\n				</div>\r\n				<div style="float: right">	\r\n					<a class="featureLink" href="javascript:;" title="Show on map"   \r\n						ng-click="groupShow(item)"><i class="fa" ng-class="{\'fa-eye-slash\':(!oneShowing()), \'fa-eye\':oneShowing()}"></i></a>\r\n				</div>\r\n				<div style="clear:both;"></div>\r\n			</div>\r\n			<div ng-repeat="feature in featuresInfo.results | filterGroupsByLayername : item" ng-show="expanded || !greaterThanOneItem()">\r\n				<div ng-mouseover="over.mouseenter(feature)" ng-mouseout="over.mouseleave(feature)" ng-click="over.click()">\r\n					<div style="float: left;" ng-class="{\'pad-left-big\':greaterThanOneItem()}">\r\n						<button type="button" ng-click="feature.expanded = !feature.expanded" class="undecorated"><i class="fa fa-caret-right pad-right" ng-class="{\'fa-caret-down\':feature.expanded,\'fa-caret-right\':(!feature.expanded)}"></i></button>\r\n						<a href="javascript:;" class="featureLink" title="{{metadata[feature.layerName].description}}"\r\n							ng-click="makeFeatureActive()" ng-class="{active:(feature.active)}">{{createTitle()}}</a>\r\n					</div>\r\n					<div style="float: right">	\r\n						<a class="featureLink" href="javascript:;" title="Graph elevation changes for feature\'s path."\r\n							ng-click="elevationPath(metadata[feature.layerName].label + \' elevation plot\')"><i class="fa fa-align-left fa-rotate-270" ng-show="feature.geometryType == \'esriGeometryPolyline\'"></i></a>					\r\n						<a class="featureLink" href="javascript:;" title="Show on map"\r\n							ng-click="toggleShow(feature)"><i class="fa" ng-class="{\'fa-eye-slash\':(!feature.displayed), \'fa-eye\':feature.displayed}"></i> </a>\r\n					</div>\r\n				</div>\r\n				<div style="clear:both;" ng-init="featureMeta = metadata[feature.layerName]">\r\n					<div ng-repeat="attribute in featureMeta.attributes" ng-show="feature.expanded">\r\n						<div style="width:7em;float:left;font-weight:bold;padding-left:9px">{{attribute.label}}</div>\r\n						<div style="min-width:12em;width:12em;margin-left:7.5em;" class="ellipsis" title="{{feature.attributes[attribute.key]}}">{{feature.attributes[attribute.key] | dashNull}}</div>\r\n					</div>\r\n					<div style="border-bottom:1px solid lightgray" ng-show="feature.expanded && !last"></div>\r\n				</div>\r\n			</div>	\r\n		</div>\r\n	</div>\r\n</exp-modal>')}]);