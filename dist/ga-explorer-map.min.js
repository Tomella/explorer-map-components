void 0===window.Exp&&(window.Exp={}),function(e,t){"use strict";function n(t,o){function i(e){function t(e,t){return e.x1-t.x1}window.bugger=e;for(var n,o,i=e.getLatLngs(),a=i.length-1,r=[],s=0;a>s;++s)n=i[s],o=i[s+1],n.lng<o.lng?r[s]={x1:n.lng,y1:n.lat,x2:o.lng,y2:o.lat}:r[s]={x1:o.lng,y1:o.lat,x2:n.lng,y2:n.lat};return r.sort(t)}function a(e,t,n){var o,i,a=n&&n.point,r=n&&n.tolerance,s=!1,l=e.x1-t.x1,c=e.y1-t.y1,u=e.x2-e.x1,h=e.y2-e.y1,p=t.y2-t.y1,f=t.x2-t.x1,d=p*u-f*h,g=f*c-p*l,m=u*c-h*l;if(0===d)0===g&&0===m&&(s=!0);else{var v=g/d,y=m/d;v>=0&&1>=v&&y>=0&&1>=y&&(a?(o=e.x1+v*u,i=e.y1+v*h,s=new OpenLayers.Geometry.Point(o,i)):s=!0)}if(r){var b,w,L,x,S=[e,t];if(s){if(a)e:for(L=0;2>L;++L)for(w=S[L],x=1;3>x;++x)if(o=w["x"+x],i=w["y"+x],b=Math.sqrt(Math.pow(o-s.x,2)+Math.pow(i-s.y,2)),r>b){s.x=o,s.y=i;break e}}else{var C,k,E,P;e:for(L=0;2>L;++L)for(C=S[L],k=S[(L+1)%2],x=1;3>x;++x)if(E={x:C["x"+x],y:C["y"+x]},P=OpenLayers.Geometry.distanceToSegment(E,k),P.distance<r){s=a?new OpenLayers.Geometry.Point(E.x,E.y):!0;break e}}}return s}var r=!1;if(t instanceof e.Polyline||t instanceof e.Polygon||t instanceof e.Marker){var s,l,c=i(o);t instanceof e.Marker?(l=t.getLatLng(),s=[{x1:l.lng,y1:l.lat,x2:l.lng,y2:l.lat}]):s=i(t);var u,h,p,f,d,g,m,v;e:for(var y=0,b=c.length;b>y;++y){u=c[y],h=u.x1,p=u.x2,f=u.y1,d=u.y2;for(var w=0,L=s.length;L>w&&(g=s[w],!(g.x1>p));++w)if(!(g.x2<h)&&(m=g.y1,v=g.y2,!(Math.min(m,v)>Math.max(f,d))&&!(Math.max(m,v)<Math.min(f,d))&&a(u,g))){r=!0;break e}}}else r=n(o,t);return r}function o(e){var t=[],n=e.getWest()+" "+e.getSouth();return t.push(n),t.push(e.getEast()+" "+e.getSouth()),t.push(e.getEast()+" "+e.getNorth()),t.push(e.getWest()+" "+e.getNorth()),t.push(n),"POLYGON(("+t.join(",")+"))"}function i(e){var t,n=0;if(e)for(t=e.length;--t>0;)n+=e[t].distanceTo(e[t-1]);return n}function a(e){var t=[];return e&&e.forEach(function(e){t.push(e.lng+" "+e.lat)}),"LINESTRING("+t.join(",")+")"}function r(e){var t=[];return e&&e.forEach(function(e){t.push([e.lng,e.lat])}),{type:"Feature",properties:{prop0:"value0"},geometry:{type:"LineString",coordinates:t}}}t.Util||(t.Util={}),t.Util.toGeoJSONFeature=r,t.Util.toLineDistance=i,t.Util.toLineStringWkt=a,t.Util.intersects=n,t.Util.boundsToWktPoly=o,t.Util.toGeoJSON=function(){function e(e){if(!e||!e.length)return 0;for(var t=0,n=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t)|0;return n}function t(e,t){return e.getElementsByTagName(t)}function n(e,t){return e.getAttribute(t)}function o(e,t){return parseFloat(n(e,t))}function i(e,n){var o=t(e,n);return o.length?o[0]:null}function a(e){return e.normalize&&e.normalize(),e}function r(e){for(var t=0,n=[];t<e.length;t++)n[t]=parseFloat(e[t]);return n}function s(e){var t={};for(var n in e)e[n]&&(t[n]=e[n]);return t}function l(e){return e&&a(e),e&&e.textContent||""}function c(e){return r(e.replace(g,"").split(","))}function u(e){for(var t=e.replace(m,"").split(v),n=[],o=0;o<t.length;o++)n.push(c(t[o]));return n}function h(e){var t,n=[o(e,"lon"),o(e,"lat")],a=i(e,"ele"),r=i(e,"gpxtpx:hr")||i(e,"hr"),s=i(e,"time");return a&&(t=parseFloat(l(a)),t&&n.push(t)),{coordinates:n,time:s?l(s):null,heartRate:r?parseFloat(l(r)):null}}function p(){return{type:"FeatureCollection",features:[]}}function f(e){return void 0!==e.xml?e.xml:d.serializeToString(e)}var d,g=/\s*/g,m=/^\s*|\s*$/g,v=/\s+/;"undefined"!=typeof XMLSerializer?d=new XMLSerializer:"object"!=typeof exports||"object"!=typeof process||process.browser||(d=new(require("xmldom").XMLSerializer));var y={kml:function(o){function a(e){var t,n;return e=e||"","#"===e.substr(0,1)&&(e=e.substr(1)),6!==e.length&&3!==e.length||(t=e),8===e.length&&(n=parseInt(e.substr(0,2),16)/255,t=e.substr(2)),[t,isNaN(n)?void 0:n]}function s(e){return r(e.split(" "))}function h(e){var n,o=t(e,"coord","gx"),i=[],a=[];for(0===o.length&&(o=t(e,"gx:coord")),n=0;n<o.length;n++)i.push(s(l(o[n])));var r=t(e,"when");for(n=0;n<r.length;n++)a.push(l(r[n]));return{coords:i,times:a}}function d(e){var n,o,a,r,s,p=[],f=[];if(i(e,"MultiGeometry"))return d(i(e,"MultiGeometry"));if(i(e,"MultiTrack"))return d(i(e,"MultiTrack"));if(i(e,"gx:MultiTrack"))return d(i(e,"gx:MultiTrack"));for(a=0;a<y.length;a++)if(o=t(e,y[a]))for(r=0;r<o.length;r++)if(n=o[r],"Point"===y[a])p.push({type:"Point",coordinates:c(l(i(n,"coordinates")))});else if("LineString"===y[a])p.push({type:"LineString",coordinates:u(l(i(n,"coordinates")))});else if("Polygon"===y[a]){var g=t(n,"LinearRing"),m=[];for(s=0;s<g.length;s++)m.push(u(l(i(g[s],"coordinates"))));p.push({type:"Polygon",coordinates:m})}else if("Track"===y[a]||"gx:Track"===y[a]){var v=h(n);p.push({type:"LineString",coordinates:v.coords}),v.times.length&&f.push(v.times)}return{geoms:p,coordTimes:f}}function g(e){var o,r=d(e),s={},c=l(i(e,"name")),u=l(i(e,"styleUrl")),h=l(i(e,"description")),p=i(e,"TimeSpan"),f=i(e,"ExtendedData"),g=i(e,"LineStyle"),m=i(e,"PolyStyle");if(!r.geoms.length)return[];if(c&&(s.name=c),u&&v[u]&&(s.styleUrl=u,s.styleHash=v[u]),h&&(s.description=h),p){var y=l(i(p,"begin")),b=l(i(p,"end"));s.timespan={begin:y,end:b}}if(g){var w=a(l(i(g,"color"))),L=w[0],x=w[1],S=parseFloat(l(i(g,"width")));L&&(s.stroke=L),isNaN(x)||(s["stroke-opacity"]=x),isNaN(S)||(s["stroke-width"]=S)}if(m){var C=a(l(i(m,"color"))),k=C[0],E=C[1],P=l(i(m,"fill")),T=l(i(m,"outline"));k&&(s.fill=k),isNaN(E)||(s["fill-opacity"]=E),P&&(s["fill-opacity"]="1"===P?1:0),T&&(s["stroke-opacity"]="1"===T?1:0)}if(f){var M=t(f,"Data"),_=t(f,"SimpleData");for(o=0;o<M.length;o++)s[M[o].getAttribute("name")]=l(i(M[o],"value"));for(o=0;o<_.length;o++)s[_[o].getAttribute("name")]=l(_[o])}r.coordTimes.length&&(s.coordTimes=1===r.coordTimes.length?r.coordTimes[0]:r.coordTimes);var D={type:"Feature",geometry:1===r.geoms.length?r.geoms[0]:{type:"GeometryCollection",geometries:r.geoms},properties:s};return n(e,"id")&&(D.id=n(e,"id")),[D]}for(var m=p(),v={},y=["Polygon","LineString","Point","Track","gx:Track"],b=t(o,"Placemark"),w=t(o,"Style"),L=0;L<w.length;L++)v["#"+n(w[L],"id")]=e(f(w[L])).toString(16);for(var x=0;x<b.length;x++)m.features=m.features.concat(g(b[x]));return m},gpx:function(e){function n(e,n){var o=t(e,n),i=[],a=[],r=[],s=o.length;if(2>s)return{};for(var l=0;s>l;l++){var c=h(o[l]);i.push(c.coordinates),c.time&&a.push(c.time),c.heartRate&&r.push(c.heartRate)}return{line:i,times:a,heartRates:r}}function o(e){for(var o,i=t(e,"trkseg"),a=[],r=[],s=[],l=0;l<i.length;l++)o=n(i[l],"trkpt"),o.line&&a.push(o.line),o.times&&o.times.length&&r.push(o.times),o.heartRates&&o.heartRates.length&&s.push(o.heartRates);if(0!==a.length){var u=c(e);return r.length&&(u.coordTimes=1===a.length?r[0]:r),s.length&&(u.heartRates=1===a.length?s[0]:s),{type:"Feature",properties:u,geometry:{type:1===a.length?"LineString":"MultiLineString",coordinates:1===a.length?a[0]:a}}}}function a(e){var t=n(e,"rtept");if(t){var o={type:"Feature",properties:c(e),geometry:{type:"LineString",coordinates:t.line}};return o}}function r(e){var t=c(e);return t.sym=l(i(e,"sym")),{type:"Feature",properties:t,geometry:{type:"Point",coordinates:h(e).coordinates}}}function c(e){var t,n=["name","desc","author","copyright","link","time","keywords"],o={};for(t=0;t<n.length;t++)o[n[t]]=l(i(e,n[t]));return s(o)}var u,f,d=t(e,"trk"),g=t(e,"rte"),m=t(e,"wpt"),v=p();for(u=0;u<d.length;u++)f=o(d[u]),f&&v.features.push(f);for(u=0;u<g.length;u++)f=a(g[u]),f&&v.features.push(f);for(u=0;u<m.length;u++)v.features.push(r(m[u]));return v}};return y}(),e.KML=e.FeatureGroup.extend({options:{async:!0},initialize:function(t,n){e.Util.setOptions(this,n),this._kml=t,this._layers={},t&&this.addKML(t,n,this.options.async)},loadXML:function(e,t,n,o){void 0===o&&(o=this.options.async),void 0===n&&(n=this.options);var i=new window.XMLHttpRequest;i.open("GET",e,o);try{i.overrideMimeType("text/xml")}catch(a){}i.onreadystatechange=function(){4==i.readyState&&200==i.status&&t(i.responseXML,n)},i.send(null)},addKML:function(e,t,n){var o=this,i=function(e,t){o._addKML(e,t)};this.loadXML(e,i,t,n)},_addKML:function(t,n){var o=e.KML.parseKML(t);if(o&&o.length){for(var i=0;i<o.length;i++)this.fire("addlayer",{layer:o[i]}),this.addLayer(o[i]);this.latLngs=e.KML.getLatLngs(t),this.fire("loaded")}},latLngs:[]}),e.Util.extend(e.KML,{parseKML:function(e){for(var t,n=this.parseStyle(e),o=e.getElementsByTagName("Folder"),i=[],a=0;a<o.length;a++)this._check_folder(o[a])&&(t=this.parseFolder(o[a],n),t&&i.push(t));o=e.getElementsByTagName("Placemark");for(var r=0;r<o.length;r++)this._check_folder(o[r])&&(t=this.parsePlacemark(o[r],e,n),t&&i.push(t));return i},_check_folder:function(e,t){for(e=e.parentElement;e&&"Folder"!==e.tagName;)e=e.parentElement;return!e||e===t},parseStyle:function(t){function n(e){for(var t={},o=0;o<e.childNodes.length;o++){var i=e.childNodes[o],r=i.tagName;if(a[r])if("hotSpot"===r)for(var s=0;s<i.attributes.length;s++)t[i.attributes[s].name]=i.attributes[s].nodeValue;else{var l=i.childNodes[0].nodeValue;"color"===r?(t.opacity=parseInt(l.substring(0,2),16)/255,t.color="#"+l.substring(2,8)):"width"===r?t.weight=l:"Icon"===r?(h=n(i),h.href&&(t.href=h.href)):"href"===r&&(t.href=l)}}return t}for(var o={},i=t.getElementsByTagName("Style"),a={color:!0,width:!0,Icon:!0,href:!0,hotSpot:!0},r=0;r<i.length;r++){var s,l=i[r],c={},u={},h={};s=l.getElementsByTagName("LineStyle"),s&&s[0]&&(c=n(s[0])),s=l.getElementsByTagName("PolyStyle"),s&&s[0]&&(u=n(s[0])),u.color&&(c.fillColor=u.color),u.opacity&&(c.fillOpacity=u.opacity),s=l.getElementsByTagName("IconStyle"),s&&s[0]&&(h=n(s[0])),h.href&&(c.icon=new e.KMLIcon({iconUrl:h.href,shadowUrl:null,iconAnchorRef:{x:h.x,y:h.y},iconAnchorType:{x:h.xunits,y:h.yunits}})),o["#"+l.getAttribute("id")]=c}return o},parseFolder:function(t,n){var o,i,a=[];o=t.getElementsByTagName("Folder");for(var r=0;r<o.length;r++)this._check_folder(o[r],t)&&(i=this.parseFolder(o[r],n),i&&a.push(i));o=t.getElementsByTagName("Placemark");for(var s=0;s<o.length;s++)this._check_folder(o[s],t)&&(i=this.parsePlacemark(o[s],t,n),i&&a.push(i));if(a.length)return 1===a.length?a[0]:new e.FeatureGroup(a)},parsePlacemark:function(t,n,o){var i,a,r,s={};for(r=t.getElementsByTagName("styleUrl"),i=0;i<r.length;i++){var l=r[i].childNodes[0].nodeValue;for(var c in o[l])s[c]=o[l][c]}var u=[],h=["LineString","Polygon","Point"];for(a in h){var p=h[a];for(r=t.getElementsByTagName(p),i=0;i<r.length;i++){var f=this["parse"+p](r[i],n,s);f&&u.push(f)}}if(u.length){var d=u[0];u.length>1&&(d=new e.FeatureGroup(u));var g,m="";for(r=t.getElementsByTagName("name"),r.length&&(g=r[0].childNodes[0].nodeValue),r=t.getElementsByTagName("description"),i=0;i<r.length;i++)for(a=0;a<r[i].childNodes.length;a++)m+=r[i].childNodes[a].nodeValue;return g&&d.bindPopup("<h2>"+g+"</h2>"+m),d}},parseCoords:function(e){var t=e.getElementsByTagName("coordinates");return this._read_coords(t[0])},parseLineString:function(t,n,o){var i=this.parseCoords(t);if(i.length)return new e.Polyline(i,o)},parsePoint:function(t,n,o){var i=t.getElementsByTagName("coordinates");if(i.length){var a=i[0].childNodes[0].nodeValue.split(",");return new e.KMLMarker(new e.LatLng(a[1],a[0]),o)}},parsePolygon:function(t,n,o){var i,a,r,s=[],l=[];for(i=t.getElementsByTagName("outerBoundaryIs"),a=0;a<i.length;a++)r=this.parseCoords(i[a]),r&&s.push(r);for(i=t.getElementsByTagName("innerBoundaryIs"),a=0;a<i.length;a++)r=this.parseCoords(i[a]),r&&l.push(r);return s.length?(o.fillColor&&(o.fill=!0),1===s.length?new e.Polygon(s.concat(l),o):new e.MultiPolygon(s,o)):void 0},getLatLngs:function(e){for(var t=e.getElementsByTagName("coordinates"),n=[],o=0;o<t.length;o++)n=n.concat(this._read_coords(t[o]));return n},_read_coords:function(t){var n,o="",i=[];for(n=0;n<t.childNodes.length;n++)o+=t.childNodes[n].nodeValue;for(o=o.split(/[\s\n]+/),n=0;n<o.length;n++){var a=o[n].split(",");a.length<2||i.push(new e.LatLng(a[1],a[0]))}return i}}),e.KMLIcon=e.Icon.extend({createIcon:function(){var e=this._createIcon("icon");return e.onload=function(){var t=new Image;t.src=this.src,this.style.width=t.width+"px",this.style.height=t.height+"px","UNITS_FRACTION"!==this.anchorType.x&&"fraction"!==this.anchorType.x||(e.style.marginLeft=-this.anchor.x*t.width+"px"),"UNITS_FRACTION"!==this.anchorType.y&&"fraction"!==this.anchorType.x||(e.style.marginTop=-(1-this.anchor.y)*t.height+"px"),this.style.display=""},e},_setIconStyles:function(t,n){e.Icon.prototype._setIconStyles.apply(this,[t,n]),t.anchor=this.options.iconAnchorRef,t.anchorType=this.options.iconAnchorType}}),e.KMLMarker=e.Marker.extend({options:{icon:new e.KMLIcon.Default}})}(L,Exp),function(e){"use strict";e.module("geo.baselayer.control",["geo.maphelper","geo.map","ui.bootstrap-slider"]).directive("geoBaselayerControl",["$rootScope","mapHelper","mapService",function(e,t,n){var o={maxZoom:12};return{template:'<slider min="0" max="1" step="0.1" ng-model="slider.opacity" updateevent="slideStop"></slider>',scope:{maxZoom:"=?12"},link:function(e,i){"undefined"==typeof e.maxZoom&&(e.maxZoom=o.maxZoom),e.slider={opacity:1,visibility:!0,lastOpacity:1},t.getPseudoBaseLayer().then(function(t){e.layer=t,e.slider.opacity=t.options.opacity,e.$watch("slider.opacity",function(t,n){e.layer.setOpacity(t)})}),n.getMap().then(function(t){function n(){var n=t.getZoom();e.lastZoom<e.maxZoom&&(e.lastOpacity=e.layer.options.opacity),n==e.maxZoom?(e.lastZoom>e.maxZoom?e.lastOpacity<.5?(e.slider.opacity=e.lastOpacity,e.layer.setOpacity(e.lastOpacity)):(e.slider.opacity=.5,e.layer.setOpacity(.5)):e.slider.opacity>.5&&(e.slider.opacity=.5,e.layer.setOpacity(.5)),e.slider.visibility=!1,o(!1)):n<e.maxZoom?(e.lastZoom<=e.maxZoom&&(e.slider.opacity=e.lastOpacity,e.layer.setOpacity(e.lastOpacity)),o(!0)):n>e.maxZoom&&e.lastZoom<=e.maxZoom&&(e.slider.visibility=!1,e.slider.opacity=0,o(!1)),e.lastZoom=n}function o(e){$(i).find(".slider-input").eq(0).slider(e?"enable":"disable")}t.on("zoomend",n)})}}}]).run(["$rootScope","mapService","flashService",function(e,t,n){var o;t.getMap().then(function(t){t.oldZoomTo=t.zoomTo,t.zoomTo=function(i){this.layers.forEach(function(a){if(a.pseudoBaseLayer&&a.visibility){var r=t.zoom,s=.4,l=a.numZoomLevels,c=i>l-2,u=l-1>i,h=i==l-2,p=l-1>r,f=r==l-2,d=i>r,g=r>i;d?i+1>=l&&!o&&(o=!0,n.add("No detail available at this scale for "+a.name,3e3),e.$broadcast("overlay.has.detail",!1)):o=!1,u&&e.$broadcast("overlay.has.detail",!0),d&&p&&(!h&&!c||f||(a.restoreOpacity=a.opacity),a.opacity>=s&&h&&a.setOpacity(s)),c&&a.opacity&&a.setOpacity(0),g&&u&&(h?a.opacity||a.setOpacity(a.restoreOpacity<s?a.restoreOpacity:s):a.restoreOpacity&&(a.setOpacity(a.restoreOpacity),a.restoreOpacity=null))}}),this.oldZoomTo(i)}})}])}(angular),function(e,t,n){"use strict";e.module("geo.chart.transect",["geo.transect"]).directive("chartTransect",[function(){return{templateUrl:"map/chartTransect/chartTransect.html",controller:"transectChartController"}}]).controller("transectChartController",["$rootScope","$scope","chartState","transectChartService",function(e,t,n,o){t.chartState=n,t.transectChartService=o,e.$on("transect.plot.data",function(n,i){i&&i.length&&i.positions&&i.positions.length>1?(t.positions=i.positions,o.drawChart(i)):e.$broadcast("chart.update",{targetChartId:""})})}]).factory("transectChartService",["$rootScope","$q","$timeout","$filter","httpData","chartState","crosshairService","mapHelper","mapPanelState","transectService","featureSummaryService",function(t,o,i,a,r,s,l,c,u,h,p){var f,d={};return d.url="resources/mock-service/explorer-cossap-services/service/path/transect-esri.json",d.propertyColors={},d.targetData=void 0,d.pathDistance=void 0,d.faultTransected=!1,d.line=void 0,d.entity=void 0,d.hideChart=function(e){t.$broadcast("chart.update",{targetChartId:!1})},d.processGeometry=function(){d.line&&(c.removeLayer(d.line),d.line=void 0,l.remove(),p.hidePopup()),d.entity&&d.entity.positions&&(d.line=L.polyline(d.entity.positions,{color:"black",weight:2,opacity:.8}),c.addLayer(d.line))},d.cleanUpCallback=function(){d.entity=void 0,d.processGeometry(),document.getElementById("transectChartD3").innerHTML=""},d.drawChart=function(s){function u(e){return e.x}function g(e){return e.z}function m(){T.domain([n.min(d.properties,function(e){return n.min(e.values,g)}),1.1*n.max(d.properties,function(e){return n.max(e.values,g)})]),$.selectAll(".y.axis").remove(),$.append("g").attr("class","y axis").call(_),$.selectAll(".property").remove(),$.selectAll(".property").data(d.properties).enter().append("g").attr("class","property").append("path").attr("class","line").attr("d",function(e){return D(e.values)}).style("stroke",function(e){return e.color}).style("stroke-width",4).style("z-index","2").style("opacity",.6)}function v(e){N=e;for(var o,i,r,s=O.ELEVATION.values,h=0;h<e.length;h++){var f=e[h].geometry.coordinates;s.push({x:f[0],y:f[1],z:f[2]}),i=L.latLng(f[0],f[1]),r?o+=i.distanceTo(r):o=0,r=i,U.push(f[0])}U=U.sort(),d.pathDistance=o,d.pathDistance=a("length")(d.pathDistance,!0),P.domain([n.min(s,u),n.max(s,u)]),$.append("g").attr("class","x axis").attr("transform","translate(0,"+C+")").call(M),$.append("text").attr("y",-30).attr("x",20).attr("dy",".71em").style("text-anchor","end").text("Z (m)"),$.append("text").attr("x",k/2).attr("y",C+10).attr("dy",".71em").style("text-anchor","middle").style("fill","#000").text("Path Distance: "+d.pathDistance);var g=n.select("#transectChartD3").append("div").attr("class","ng-hide").style("position","absolute").style("z-index","2").style("width","2px").style("height",C+"px").style("top","50px").style("bottom","0px").style("left","20px").style("margin-left","-1px").style("background","#000");n.select("#transectChartD3").append("div").attr("class","x-index").style("left",P(P)+x+"px"),n.select("#transectChartD3 .chart-svg").on("mousemove",function(){if(w){if(n.mousex=n.mouse(this),n.mousex=n.mousex[0]+20,!(n.mousex>x&&n.mousex<k+x))return g.attr("class","ng-hide"),!1;g.style("left",n.mousex+"px"),g.attr("class","ng-show vertical-transect"),n.mousex=n.mousex-x;var e=n.bisectLeft(U,P.invert(n.mousex)),o={};d.properties.forEach(function(t){o[t.name]=t.values[e]});var i={markerLonLat:L.latLng(o.ELEVATION.y,o.ELEVATION.x),point:o.ELEVATION};l.move(o.ELEVATION),p.getAndShowFeatures(i),d.targetData=o,t.$$phase||t.$apply()}}).on("mouseover",function(){w&&(n.mousex=n.mouse(this),n.mousex=n.mousex[0]+20,n.mousex>x&&n.mousex<k+x?(g.style("left",n.mousex+"px"),g.attr("class","ng-show vertical-transect")):g.attr("class","ng-hide"))}),n.select("#transectChartD3").on("click",function(){w=!w,n.select(".vertical-transect").style("width",(w?2:4)+"px").style("margin-left",-(w?1:2)+"px"),w||c.zoomToMarkPoints([[d.targetData.ELEVATION.x,d.targetData.ELEVATION.y]])})}function y(e){for(var t=n.select("#transectChartD3"),o=0;o<e.length;o++){var i=e[o].geometry.coordinates;0!==i[2]&&t.append("div").attr("class","fault-transect").style("height",C+"px").style("left",P(i[0])+x+"px")}}function b(e,t){t=N;for(var n=O[e].values,o=100*Math.random(),i=0;i<t.length;i++){var a=t[i].geometry.coordinates;n.push({x:a[0],y:a[1],z:o+=10*Math.random()-5})}}if(!f)return r.get("resources/mock-service/explorer-cossap-services/service/path/transect.json").then(function(e){f=e.data.meta,d.drawChart(s)});d.entity=s,d.processGeometry(),t.$broadcast("chart.update",{targetChartId:"transectChart",cleanUpCallback:d.cleanUpCallback});var w=!0,x=70,S={top:50,right:20,bottom:30,left:50},C=(.35*document.body.clientHeight>235?.35*document.body.clientHeight:235)-S.top-S.bottom,k=document.body.clientWidth-S.left-S.right-275;k=k>725?k:725;var E=k+260+S.left+S.right;d.minPanelWidth=E>1e3?E:1e3;var P=n.scale.linear().range([0,k]),T=n.scale.linear().range([C,0]),M=n.svg.axis().scale(P).orient("bottom").tickValues([0]),_=n.svg.axis().scale(T).orient("left").innerTickSize(-k).outerTickSize(10).tickPadding(10),D=n.svg.line().defined(function(e){return 0!==e.z}).x(function(e){return P(+e.x)}).y(function(e){return T(+e.z)});n.selectAll("#transectChartD3 svg").remove();var $=n.select("#transectChartD3").append("svg").attr("width",k+S.left+S.right).attr("height",C+S.top+S.bottom).attr("class","chart-svg").style("z-index","2").append("g").attr("transform","translate("+S.left+","+S.top+")");d.properties=[];var I=[],U=[],O={},B=o.defer();e.forEach(f,function(e,n){I.push(e.label),"FAULT"!=n&&(d.propertyColors[n]=e.color,d.properties.push(O[n]={name:n,color:e.color,label:e.label,description:e.description,values:[]}));var o=1e3*d.properties.length;h.getServiceData(n,s.positions).then(function(e){"ELEVATION"===n?(v(e.features),m(),B.resolve(!0),t.$$phase||t.$apply()):B.promise.then(function(){"FAULT"===n?y(e.features):i(function(){b(n,e.features),m()},o),t.$$phase||t.$apply()})})});var N=null},d}])}(angular,$,d3),function(e,t){"use strict";e.module("explorer.crosshair",["geo.map"]).factory("crosshairService",["mapService",function(e){var n,o;return e.getMap().then(function(e){n=e}),{add:function(e){this.move(e)},remove:function(){o&&(n.removeLayer(o),o=null)},move:function(e){var i;if(e)return this.remove(),i=t.icon({iconUrl:"resources/img/cursor-crosshair.png",iconAnchor:[16,16]}),o=t.marker([e.y,e.x],{icon:i}),o.addTo(n),e}}}])}(angular,L),function(e){"use strict";e.module("geo.draw",["geo.map"]).directive("geoDraw",["$log","$rootScope","drawService",function(t,n,o){var i={rectangleEvent:"geo.draw.rectangle.created",lineEvent:"geo.draw.line.created"};return{restrict:"AE",scope:{data:"=",rectangleEvent:"@",lineEvent:"@"},link:function(t,n,a,r){e.forEach(i,function(e,n){t[n]||(t[n]=e)}),o.createControl(t)}}}]).factory("drawService",["$q","$rootScope","mapService",function(t,n,o){var i,a,r,s;return{createControl:function(a){return i&&t.when(i),o.getMap().then(function(t){var o=new L.FeatureGroup,l={edit:{featureGroup:o}};return a.data&&e.extend(l,a.data),r=a.drawnItems=o,t.addLayer(o),i=new L.Control.Draw(l),t.addControl(i),t.on("draw:created",function(e){({polyline:function(){var t={length:e.layer.getLength(),geometry:e.layer.getLatLngs()};n.$broadcast(a.lineEvent,t)},rectangle:function(){var t={bounds:e.layer.getBounds()};s.resolve(t),s=null}})[e.layerType]()}),i})},cancelDrawRectangle:function(){s&&(s.reject(),s=null,a&&a.disable())},drawRectangle:function(){return this.cancelDrawRectangle(),s=t.defer(),a?a.enable():o.getMap().then(function(e){a=new L.Draw.Rectangle(e,i.options.polyline),a.enable()}),s.promise}}}])}(angular),function(e,t){"use strict";e.module("geo.drawhelper",["geo.map"]).factory("drawHelperService",["$q","$rootScope","mapService",function(e,n,o){function i(e){n.$broadcast("drawhelper.active",e)}var a,r,s,l,c={};return c.getDrawHelper=function(){if(r)return e.when(c);var n=e.defer();return o.getMap().then(function(e){var o={color:"#000099",opacity:.4};r=new t.Draw.Polygon(e,o),s=new t.Draw.Polyline(e,o),l=new t.Draw.Rectangle(e,o),e.on("draw:created",function(e){a&&{polygon:function(){a(e.layer.getLatLngs())},polyline:function(){a({length:e.layer.getLength(),positions:e.layer.getLatLngs()})},rectangle:function(){a(e.layer.getBounds())}}[e.layerType](),i(!1)}),n.resolve(c)}),n.promise},c.drawPolyline=function(e){i(!0),a=e.callback,s.enable()},c.drawPolygon=function(e){i(!0),a=e.callback,r.enable()},c.drawExtent=function(e){i(!0),a=e.callback,l.enable()},c.stopDrawing=function(){a=void 0,r.disable(),s.disable(),l.disable(),i(!1)},c}])}(angular,L),function(e,t,n){"use strict";e.module("geo.elevation",["graph","explorer.crosshair","explorer.flasher","explorer.feature.summary","geo.map","geo.path"]).directive("pathElevationPlot",["$log","$timeout","$rootScope","$filter","elevationService","crosshairService","featureSummaryService",function(e,t,n,o,i,a,r){var s={fill:"orange",fillOpacity:.4,stroke:"darkred",strokeWidth:1.5},l={fill:"lightblue",fillOpacity:.8,stroke:"darkblue",strokeWidth:1.5},c='<span><img alt="Waiting..." src="resources/img/tinyloader.gif" ng-show="message.spinner" style="position:relative;top:2px;" width="12"></img></span>';return{templateUrl:"map/elevation/elevation.html",scope:!0,controller:["$scope",function(e){e.paths=[],e.config={yLabel:"Elevation (m)",xLabel:"Distance: 3000m"},n.$on("elevation.plot.data",function(t,n){e.length=n.length,e.geometry=n.geometry,e.config.xLabel="Distance: "+o("length")(n.length,!0),e.waterTable=null,e.length&&e.geometry&&(i.getElevation(e.geometry,e.length).then(function(t){e.elevation={style:s,data:t},e.config.leftText="Elevation Range: "+o("length")(d3.min(t,function(e){return e.z}),!0)+" to "+o("length")(d3.max(t,function(e){return e.z}),!0),e.paths=[e.elevation]}),i.intersectsWaterTable(e.geometry).then(function(t){e.intersectsWaterTable=t}))}),e.getInfoText=function(){e.infoText||(e.infoText=c,i.getInfoText().then(function(t){e.infoText=t}))},e.toggleWaterTable=function(){var n=e.paths.length;e.paths=[],e.waterTable?t(function(){1==n?e.paths=[e.elevation,e.waterTable]:e.paths=[e.elevation]}):i.getWaterTable(e.geometry,e.length).then(function(t){e.waterTable={style:l,data:t},e.paths=[e.elevation,e.waterTable]})},e.close=function(){e.paths=e.geometry=e.length=null}}],link:function(t,n){function o(){t.line&&(t.line=i.pathHide(t.line)),t.geometry?t.line=i.pathShow(t.geometry):i.hideWaterTable()}function s(){e.info("Deferred view"),r.deferView(t.position).then(function(e){t.featuresUnderPoint=e})}function l(){e.info("Cancel deferred view"),r.cancelView(),t.featuresUnderPoint=null}t.graphClick=function(e){if(e.position){var n=e.position.points[0].point;i.panToPoint(n),t.point=n}},t.graphLeave=function(n){t.position=null,a.remove(),l(),e.debug("Mouse left"),t.mapListener&&(e.info("offMapMove"),r.offMapMove(t.mapListener))},t.graphEnter=function(t){e.debug("Graph be entered")},t.graphMove=function(n){var o;t.position=n.position,t.position&&(o=t.position.point,window.eve=n,t.position.markerLonlat=a.move(o),s()),t.mapListener||(t.mapListener=function(){l(),s()},e.info("onMapMove"),r.onMapMove(t.mapListener)),e.debug("Mouse moving...")},t.$watch("geometry",o)}}}]).directive("marsPanTo",["$rootScope","mapService",function(t,o){var i={eventName:"elevation.plot.data",options:{paddingTopLeft:[50,50],paddingBottomRight:[50,250]}};return{restrict:"AE",scope:{eventName:"=",options:"="},link:function(a){e.forEach(i,function(e,t){"undefined"==typeof a[t]&&(a[t]=e)}),t.$on(a.eventName,function(e,t){var i=n.polyline(t.geometry),r=i.getBounds();o.getMap().then(function(e){e.fitBounds(r,a.options)})})}}}]).directive("marsInfoElevation",["$log","elevationService",function(e,t){return{templateUrl:"map/elevation/elevationInfo.html",scope:!0,link:function(e,n){e.toggleWaterTableShowing=function(){e.state=t.getState(),t.isWaterTableShowing()?t.hideWaterTable():t.showWaterTable()}}}}]).provider("elevationService",function(){var e,o=500,i="service/path/elevation",a="service/path/waterTable",r="service/artesianBasin/geometry/kml",s="service/artesianBasin/intersects",l=null,c={isWaterTableShowing:!1};this.setIntersectUrl=function(e){s=e},this.setKmlUrl=function(e){r=e},this.setElevationUrl=function(e){i=e},this.setWaterTableUrl=function(e){a=e},this.$get=["$log","httpData","$q","mapService","flashService",function(u,h,p,f,d){f.getMap().then(function(t){e=t});var g={panToPoint:function(e){f.zoomTo(e.y,e.x)},getState:function(){return c},getElevation:function(e,n){var a=d.add("Retrieving elevation details...",8e3),r=t.Util.toLineStringWkt(e);return h.post(i,{wkt:r,count:o,distance:n}).then(function(e){return d.remove(a),e.data})},intersectsWaterTable:function(e){var n=s+(s.indexOf("?")>-1?"":"?wkt=");return h.get(n+t.Util.toLineStringWkt(e),{cache:!0}).then(function(e){return e.data.intersects})},isWaterTableShowing:function(){return c.isWaterTableShowing=null!==l},showWaterTable:function(){l||this.getWaterTableLayer().then(function(t){t.addTo(e)}),c.isWaterTableShowing=!0},hideWaterTable:function(){l&&e.removeLayer(l),l=null,c.isWaterTableShowing=!1},createWaterTableLayer:function(){return f.getMap().then(function(e){var t=new n.KML(h.fixUrl(r),{async:!0});return t.on("loaded",function(e){return l=e.target})})},getWaterTableLayer:function(){return this.createWaterTableLayer()},getWaterTable:function(e,n){var i=d.add("Retrieving water table details...",8e3),r=t.Util.toLineStringWkt(e);return h.post(a,{wkt:r,count:o,distance:n}).then(function(e){return d.remove(i),e.data})},getInfoText:function(){return h.get("map/elevation/elevationInfo.html",{cache:!0}).then(function(e){return e.data})},pathShow:function(t){var o=n.polyline(t,{color:"red",weight:3,opacity:.8}).addTo(e);return o},pathHide:function(t){return e.removeLayer(t),null}};return g}]})}(angular,Exp,L),function(e,t){"use strict";e.module("geo.extent",[]).directive("geoExtent",["$log",function(e){var n={center:[-28,135],zoom:5};return{require:"^geoMap",restrict:"AE",scope:{options:"="},link:function(e,o,i,a){"undefined"==typeof e.options&&(e.options={}),"undefined"==typeof e.options.center&&(e.options.center=n.center),"undefined"==typeof e.options.zoom&&(e.options.zoom=n.zoom),a.getMap().then(function(n){t.control.zoommin(e.options).addTo(n)})}}}])}(angular,L),function(e,t,n){"use strict";e.module("geo.geosearch",["ngAutocomplete"]).directive("expSearch",[function(){return{templateUrl:"components/geosearch/search.html",scope:{hideTo:"="},link:function(e,t){t.addClass("")}}}]).directive("geoSearch",["$log","$q","googleService","mapHelper",function(e,t,n,o){return{controller:["$scope",function(i){i.values={from:{},to:{}},i.zoom=function(a){var r,s=[];i.values.from.description&&(r=n.getAddressDetails(i.values.from.description,i).then(function(t){e.debug("Received the results for from"),i.values.from.results=t,i.item=""},function(t){e.debug("Failed to complete the from lookup.")}),s.push(r)),i.values.to&&i.values.to.description&&(r=n.getAddressDetails(i.values.to.description,i).then(function(t){e.debug("Received the results for to"),i.values.to.results=t},function(t){e.debug("Failed to complete the to lookup.")}),s.push(r)),s.length>0&&t.all(s).then(function(){var t=[];i.values.from&&i.values.from.results&&t.push(i.values.from.results),i.values.to&&i.values.to.results&&t.push(i.values.to.results),o.zoomToMarkPoints(t,a),1==s.length,e.debug("Updating the map with what we have")}),e.debug("Zooming to map soon.")}}]}}]).factory("googleService",["$log","$q",function(e,n){var o,i=new t.maps.Geocoder;try{o=new t.maps.places.AutocompleteService(null,{types:["geocode"]})}catch(a){e.debug("Catching google error that manifests itself when debugging in Firefox only")}return{getAddressDetails:function(e,o){var a=n.defer();return i.geocode({address:e,region:"au"},function(e,n){n!=t.maps.GeocoderStatus.OK?o.$apply(function(){a.reject("Failed to find address")}):o.$apply(function(){a.resolve({lat:e[0].geometry.location.lat(),lon:e[0].geometry.location.lng(),address:e[0].formatted_address})})}),a.promise}}}])}(angular,google,window),function(e,t){"use strict";e.module("explorer.feature.summary",["geo.map"]).directive("featureSummaryToggle",["mapHelper",function(e){return{template:'<i class="fa fa-location-arrow fa-rotate-180"></i>',link:function(t){t.$watch("unlinked",function(t){e.fireEvent(t.featureSummary?"featuresactivate":"featuresdeactivate")},!0)}}}]).directive("featureGridToggle",["mapHelper",function(e){return{template:'<i class="fa fa-th"></i>',link:function(t){t.$watch("unlinked",function(t){e.showGrid(t.featureGrid)},!0)}}}]).directive("expPointFeatures",["featureSummaryService",function(e){return{scope:{features:"="},link:function(t,n){t.$watch("features",function(n,o){t.features?e.showPopup(t.features):o&&e.hidePopup()})}}}]).directive("featuresUnderPoint",["$timeout","featureSummaryService","mapService",function(e,t,n){var o=400;return{restrict:"AE",scope:!0,template:'<div exp-point-features features="featuresUnderPoint" class="featuresUnderPoint"></div>',link:function(i,a){n.getMap().then(function(n){function i(e){n.on("mousemove",l),n.on("mouseout",s)}function r(e){s(),n.off("mousemove",l),n.off("mouseout",s)}function s(){e.cancel(c),t.hidePopup()}function l(n){s(),c=e(function(){var e={markerLonLat:n.latlng,point:{x:n.latlng.lng,y:n.latlng.lat}};t.getAndShowFeatures(e)},o);
}var c;void 0===a.attr("no-control")&&n.addControl(L.control.features()),n.on("featuresactivate",i),n.on("featuresdeactivate",r)})}}}]).factory("featureSummaryService",["$log","configService","mapService","$timeout","$rootScope","$q","httpData",function(t,n,o,i,a,r,s){var l,c,u="service/path/featureCount";return o.getMap().then(function(e){l=e}),{getAndShowFeatures:function(e){this.view(e).then(function(e){this.showPopup(e)}.bind(this))},showPopup:function(t){var n=t.position.point;o.getMap().then(function(o){var i=[];e.forEach(t.data,function(e,t){i.push(t+" ("+e+")")}),L.popup().setLatLng([n.y,n.x]).setContent(i.length?i.join("<br />"):"No nearby features").openOn(o)})},hidePopup:function(){o.getMap().then(function(e){e.closePopup()})},view:function(t){var n=r.defer();return c=null,t.point&&this.featuresUnderPoint(t.point).then(function(o){var i=0;e.forEach(o,function(e){i+=e}),n.resolve({data:o,position:t,count:i})}),n.promise},deferView:function(e){var t=this,n=r.defer();return this.cancelView(),c=i(function(){t.view(e).then(function(e){n.resolve(e)})}.bind(this),200),n.promise},cancelView:function(){c&&i.cancel(c)},clearView:function(){},onMapMove:function(e){return t.debug("Adding event handler"),l.on("moveend",l,e),e},offMapMove:function(e){t.debug("Removing event handler"),l.off("moveend",l,e)},positionFromLonlat:function(e){var t=e.lat?e.lat:e.y,n=e.lon?e.lon:e.x,o=[t,n],i=l.project(o);return console.log([o,i]),i},getViewPort:function(){return l._container.getBoundingClientRect()},featuresUnderPoint:function(e){var t=r.defer(),o=l._container.getBoundingClientRect(),i=window.devicePixelRatio?window.devicePixelRatio:1,a=l.getBounds();return n.getConfig("clientSessionId").then(function(n){s.post(u,{clientSessionId:n,x:e.x,y:e.y,width:o.width/i,height:o.height/i,extent:{left:a.left,right:a.right,top:a.top,bottom:a.bottom}}).then(function(e){t.resolve(e.data)})}),t.promise}}}])}(angular,window),function(e,t){"use strict";e.module("explorer.layers",["geo.map"]).factory("layerService",["mapService","$log","$q",function(n,o,i){var a=null,r=["addToMap","removeFromMap","handleShow","init","destroy","moveUp","moveDown"],s={},l=0,c={WMS:{addToMap:function(){return this.layer=t.tileLayer.wms(this.wmsUrl,{layers:this.layers,format:"image/png",transparent:!0}),i.when(this.layer)},removeFromMap:function(){this.layer.map&&this.map.removeLayer(this.layer)},handleShow:function(){return this.layer._map?(this.map.removeLayer(this.layer),!1):(this.layer.addTo(this.map),!0)},moveUp:function(){var e,t,n=this.map.layers,o=0,i=this.map.getLayerIndex(this.layer);for(e=0;e<n.length;e++)if(t=n[e],!t.isBaseLayer&&!t.pseudoBaseLayer){o=e;break}return i>o?(a.raiseLayer(this.layer,-1),!0):!1},moveDown:function(){var e=a.getLayerIndex(this.layer),t=a.layers.length;return t-1>e?(a.raiseLayer(this.layer,1),!0):!1},init:function(){return this.addToMap()},destroy:function(){this.removeFromMap()}}},u={WMS:function(e){this.legend=this.legendUrl,this.thumbUrl||(this.thumbUrl=window.location.protocol+"//"+window.location.host+window.location.pathname.substr(0,window.location.pathname.substr(1).indexOf("/")+2)+"service/thumb/wms?wmsService="+encodeURIComponent(this.url)+"&layers="+encodeURIComponent(this.layers))},Tile:function(e){this.legend=this.legendUrl},Vector:function(e){}};return window.typeProtos=c,c.Tile=Object.create(c.WMS),c.Tile.addToMap=function(){return this.layer||(this.layer=t.tileLayer(this.tilecacheUrl,{format:"image/png",transparent:!0})),i.when(this.layer)},c.Vector=Object.create(c.WMS),c.Vector.addToMap=function(){},{decorate:function(t){var n,o;return t.assetId||(t.assetId="bogus_"+l++),s[t.assetId]?t:(this._createMapFeature(t),t.isWrapped=!0,n=t.type,o=c[n],o&&e.forEach(r,function(e){t[e]=o[e]}),t)},_createMapFeature:function(e){var t;"Vector"==e.type&&o.debug("Handling a vector service"),t=u[e.type],t&&(u[e.type].call(e),s[e.assetId]=e)}}}])}(angular,L),function(e){"use strict";e.module("explorer.layer.inpector",["explorer.layers"]).directive("layerInspector",["$rootScope","layerService",function(e,t){return{restrict:"AE",scope:{click:"&",showClose:"=?",active:"=",name:"=?"},controller:["$scope",function(e){e.toggleShow=function(){var e=this.active;e.isWrapped||(e=t.decorate(e),e.init(),e.show=!0,e.showExtra=!0),e.displayed=e.handleShow()}}],templateUrl:"map/layerinspector/layerInspector.html"}}])}(angular),function(e){"use strict";e.module("explorer.layer.slider",[]).directive("explorerLayerSlider",[function(){return{template:'<slider min="0" ng-show="layer" max="1" step="0.1" updateevent="slideStop" ng-model="slider.opacity" ng-disabled="!slider.visibility" ui-tooltip="hide"></slider>',scope:{layer:"=?"},link:function(e,t,n){e.slider={visibility:!0},e.$watch("slider.opacity",function(t,n){e.layer&&e.layer.setOpacity(t)}),e.$watch("layer.options.opacity",function(t,n){"undefined"!=typeof t&&"undefined"!=typeof n?e.slider.opacity=t:e.layer&&"undefined"==typeof n&&("undefined"==typeof e.slider.opacity?e.slider.opacity=e.layer.options.opacity:e.layer.setOpacity(e.slider.opacity))})}}}])}(angular),function(e,t){"use strict";var n;e.module("explorer.least.cost.path",["explorer.config","explorer.flasher","explorer.persist","explorer.message"]).directive("leastCostPathDraw",["$log","lcpService","flashService","persistService","configService",function(e,t,o,i,a){return{templateUrl:"map/leastCostPath/draw.html",replace:!0,restrict:"AE",controller:["$scope","$rootScope",function(e,o){e.points=[],a.getConfig().then(function(e){n=e.leastCostPathExtent}),e.remove=function(){var n=e.points.indexOf(this.point);n>-1&&(e.points.splice(n,1),t.removePoint(this.point))};var r=!1;e.pathComplete=function(){r=!0,o.$broadcast("leastCost.path.data",null),r=!1,e.pathGeometry=t.getPathGeometry(),e.lastResistanceCategories?e.resistanceCategories=e.lastResistanceCategories:t.weightings().then(function(t){i.getItem("lcpWeightings").then(function(e){e&&t.forEach(function(t){t.group.forEach(function(t){var n=e[t.key];(n||0===n)&&(t.value=n.value,t.selected=n.selected)})})}),e.resistanceCategories=t})},o.$on("leastCost.path.draw",function(t){e.show=!0,e.points=[]}),o.$on("leastCost.path.data",function(n,o){r||(o&&o.positions&&o.positions.length?(e.show=!0,e.points=o.positions,e.distance=o.length,t.setPathGeometry(o.positions)):(e.show=!1,e.points=[],e.distance=0,t.reset()))}),e.$watch("resistanceCategories",function(t,n){if(n){t||(e.show=!1),e.lastResistanceCategories=n;var o={};n.forEach(function(e){e.group.forEach(function(e){o[e.key]={value:e.value,selected:e.selected}})}),i.setItem("lcpWeightings",o)}})}]}}]).directive("leastCostWeightings",["$log","$modal","lcpService","messageService",function(e,o,i,a){return{scope:{weightings:"=",pathGeometry:"="},controller:[function(){}],link:function(e,r,s){function l(e){a.error(e.text)}function c(){e.weightings=null}var u;e.$watch("weightings",function(r,s){function h(t,n,o){var a={};t.forEach(function(e){e.group.forEach(function(e){a[e.key]=e})}),i.getLeastCostPath(n,a,0===o||o?o:.25).then(function(t){if(i.reset(),t)if("displayMessage"==t.jobName||t.error)t.text||(t.text=t.details),l(t),e.leastCostPath=null;else{var o=i.results();o.data=t.data,o.data.geometry=n,o.distance=Exp.Util.toLineDistance(n),o.data.timeStamp=Date.now()}else l({text:"Least cost path request failed."})},l)}r&&(u=o.open({templateUrl:"map/leastCostPath/leastCostWeightings.html",size:"md",backdrop:"static",controller:["$scope","$rootScope","$modalInstance","weightings","pathGeometry",function(e,o,i,r,s){function l(){function o(e){var t=(r.right-r.left)*e,o=(r.top-r.bottom)*e,i=t>o?t:o,a=r.left-i,s=r.right+i,l=r.bottom-i,c=r.top+i;return n.top>c&&n.left<a&&n.right>s&&n.bottom<l}var i=t.polyline(e.pathGeometry).getBounds(),r={right:i.getEast(),left:i.getWest(),top:i.getNorth(),bottom:i.getSouth()},s={0:0},l="0",c=null;o(.1)?(s[l="0.1"]=10,o(.25)?(s[l="0.25"]=25,o(.5)?s[l="0.5"]=50:c="Can not buffer extent by more than 25% as it would exceed the extent of our data"):c="Can not buffer extent by more than 10% as it would exceed the extent of our data"):c="Extent buffering restricted to line extent due to lack of data",e.bufferValues=s,e.bufferPercent=l,c&&a.info(c)}e.weightings=r,e.pathGeometry=s,l(),e.close=function(){e.weightings=null},e.cancelLeastCostPath=function(){e.weightings=null,i.dismiss(null)},e.showLeastCostPath=function(t){t.stopPropagation(),i.close(e.bufferPercent)}}],resolve:{weightings:function(){return e.weightings},pathGeometry:function(){return e.pathGeometry}}}),u.result.then(function(t){h(e.weightings,e.pathGeometry,t),c()},function(){c()}))})}}}]).directive("expLeastCostPathDisplay",["$log","lcpService","$filter",function(t,n,o){return{templateUrl:"map/leastCostPath/leastCostDisplay.html",restrict:"AE",controller:["$scope",function(t){t.results=n.results(),t.urls={},t.$watch("results.data",function(o){o&&(t.lcpKmlShown=t.lcpBufferKmlShown=t.pathShown=t.costSurfaceShown=!1,e.forEach(o.results,function(e,i){n.getResourceUrl(o.jobId,i).then(function(e){t.urls[i]=e,"lcpKml"==i?(t.lcpKmlShown=!0,n.showPathKml(e)):"lcpCorridorKml"==i&&(t.lcpBufferKmlShown=!0,n.showBufferKml(e))})}))}),t.clear=function(){t.results.data=t.results.distance=null},t.stringify=function(e){return e?JSON.stringify(e):void 0},t.bringToTop=function(){n.bringToTop()},t.zoomToCentre=function(){n.zoomToBufferlLayer()},t.toggleLcpKml=function(){t.lcpKmlShown=n.togglePathKml(t.urls.lcpKml)},t.toggleLcpBufferKml=function(){t.lcpBufferKmlShown=n.toggleBufferKml(t.urls.lcpCorridorKml)},t.togglePath=function(){t.pathShown=n.toggleLcpSourcePath(t.results.data.geometry,"Least cost path elevation plot")},t.elevationLcpKml=function(){n.elevationLcpKml()},t.elevationPath=function(e){n.elevationPath(t.results.data.geometry,"Elevation plot of original path for least cost path")},t.toggleCostSurface=function(){t.costSurfaceShown=n.toggleCostSurface({outline:t.urls.fullSegExtKml,image:t.urls.png,extent:t.urls.csExtKml})}}],link:function(e,t,o){e.$watch("results.distance",function(t,o){t?(e.pathShown=!0,n.showLcpSourcePath(e.results.data.geometry)):o&&n.reset()})}}}]).directive("pathLeastCostSlider",[function(){return{template:'<slider min="0" max="1" step="0.1" ng-model="weighting.value" updateevent="slideStop" ng-disabled="!weighting.selected" ui-tooltip="hide"></slider>',link:function(){}}}]).factory("lcpService",["$log","$q","httpData","$timeout","$rootScope","mapHelper","flashService",function(n,o,i,a,r,s,l){function c(e){var t=d[e];return void 0!==t&&null!==t}function u(e){var t=d[e];t&&(s.removeLayer(t),d[e]=null)}function h(){var e=[];g.forEach(function(t){var n=d[t];n&&(e.push(n),s.removeLayer(n))}),s.addLayers(e)}function p(){v&&s.removeLayer(v),s.addLayer(v=t.polyline(f,{width:2,color:"#000"}))}var f,d={pathBuffersKmlLayer:null,imageLayer:null,bufferKmlLayer:null,lcpSourcePath:null,pathKmlLayer:null},g=["pathBuffersKmlLayer","imageLayer","bufferKmlLayer","lcpSourcePath","pathKmlLayer"],m=null,v=null,y={data:null,distance:null};return{results:function(){return y},reset:function(){y.data=f=null,this.removePathKml(),this.removeBufferKml(),this.removeLcpSourcePath(),this.removePathBuffers(),this.removeCostSurface(),v&&(s.removeLayer(v),v=null)},triggerElevationPlot:function(e){r.$broadcast("elevation.plot.data",e)},elevationPath:function(e,t){var n=Exp.Util.toLineDistance(e);this.triggerElevationPlot({length:n,positions:e,heading:t})},elevationLcpKml:function(){var e=d.pathKmlLayer.getLatLngs(),t=Exp.Util.toLineDistance(e);this.triggerElevationPlot({length:t,positions:e,heading:"Least cost path elevation plot"})},bringToTop:function(){h()},removeLcpSourcePath:function(){u("lcpSourcePath")},removeBufferKml:function(){u("bufferKmlLayer")},removeCostSurface:function(){u("imageLayer")},removePathBuffers:function(){u("pathBuffersKmlLayer")},removePathKml:function(){u("pathKmlLayer")},zoomToBufferlLayer:function(){g.some(function(e){var t=d[e];return t?(s.zoomToBounds(t.getBounds()),!0):!1})},toggleLcpSourcePath:function(e){var t=c("lcpSourcePath");return t?this.removeLcpSourcePath():this.showLcpSourcePath(e),!t},showLcpSourcePath:function(e){this.removeLcpSourcePath(),d.lcpSourcePath=t.polyline(e,{width:2,color:"#000"}),h()},toggleCostSurface:function(e){var t=c("imageLayer");return t?(this.removeCostSurface(),this.removePathBuffers()):this.showCostSurface(e),!t},showCostSurface:function(e){this.removeCostSurface(),this.showPathBuffers(e.outline).then(function(){new t.KML(e.extent,{async:!0}).on("loaded",function(n){d.imageLayer=t.imageOverlay(e.image,n.target.getBounds(),{opacity:.7}),h()})})},showPathBuffers:function(e){var n=o.defer();return this.removePathBuffers(),d.pathBuffersKmlLayer=new t.KML(e,{async:!0}),d.pathBuffersKmlLayer.on("loaded",function(e){e.target.setStyle({width:2,color:"#44ee11",fillColor:"#ccff77",fillOpacity:.15}),n.resolve(e.target)}),n.promise},toggleBufferKml:function(e){var t=c("bufferKmlLayer");return t?this.removeBufferKml():this.showBufferKml(e),!t},showBufferKml:function(e){this.removeBufferKml(),d.bufferKmlLayer=new t.KML(e,{async:!0}),d.bufferKmlLayer.on("loaded",function(e){e.target.setStyle({width:2,color:"#ff4411",fillColor:"#bbff55",fillOpacity:.3})}),h()},togglePathKml:function(e){var t=c("pathKmlLayer");return t?this.removePathKml():this.showPathKml(e),!t},showPathKml:function(e){this.removePathKml(),d.pathKmlLayer=new t.KML(e,{async:!0}),d.pathKmlLayer.on("loaded",function(e){e.target.setStyle({width:2,color:"#ff9933",fillColor:"ffcc66",fillOpacity:.5})}),h()},getResourceUrl:function(e,t){var n=o.defer();return i.get("service/proxied/lcpService/jobs/"+e+"/results/"+t+"?f=json").then(function(e){e.data&&e.data.value&&n.resolve(e.data.value.url),n.reject()}),n.promise},getLeastCostPath:function(t,n,r){var s=Exp.Util.toLineStringWkt(t),c=o.defer(),u=[],h=!1;return p(),l.add("Initiating least cost path process...",3e3),a(function(){h||(m=l.add("Least cost path process is running.",12e4,!0))},4500),e.forEach(n,function(e,t){e.selected&&u.push('["'+t+'","'+e.label+'",'+e.value+"]")}),i.get("service/proxied/lcpService/submitJob",{params:{wkt:s,wTable:"["+u.join()+"]",f:"json",buffPct:r,returnZ:!1,returnM:!1}}).then(function(e){function t(){o++,i.get("service/proxied/lcpService/jobs/"+n+"?f=json").then(function(e){var n=e.data.jobStatus;if("esriJobSucceeded"==n||"esriJobFailed"==n){var i="A least cost process has completed";e.data&&"esriJobFailed"==e.data.jobStatus&&(i="A least cost process has failed"),h=!0,l.remove(m),l.add(i,4e3),c.resolve(e)}else o++<100&&a(t,4e3)})}var n=e.data.jobId,o=0;a(t,12e3)}),c.promise},getPathGeometry:function(){return f},setPathGeometry:function(e){f=e},weightings:function(){var e=o.defer();return i.get("resources/config/defaultLeastCostPathWeightings.json",{cache:!0}).then(function(t){e.resolve(t.data)},function(t){e.reject({error:"E1100",text:"Failed to retrieve weightings"})}),e.promise}}}]).run(["$templateCache",function(e){e.put("map/leastCostPath/draw.html",'<div class="popover bottom lcpPathDisplay" mars-lcp-path ng-show="show || resistanceCategories">	<div class="arrow"></div>	<div class="popover-inner">		<div class="pathHeader">			<span style="font-weight:bold">Least Cost Path</span><div style="float:right" ng-show="distance">{{(distance/1000) | number : 3}}km</div>		</div>       <div ng-hide="resistanceCategories">		   <div ng-show="points.length == 0">Click on map to start path. Double click to end path.</div>		   <div ng-show="points.length > 0">Drag vertices with mouse to change waypoints. Hover over waypoints and use the delete key to remove.</div>		   <div style="font-weight:bold;text-align:center" ng-cloak ng-show="distance > 300000">Reduce the length of your path. <br/>A limit of 300k applies.</div>		   <div class="buttons">			  <button ng-show="points.length > 1" type="button" class="btn btn-default" style="width:98%;margin:2px" ng-click="pathComplete($event)" ng-disabled="distance > 300000">Least cost path...</button>		   </div>       </div>	</div>	<div least-cost-weightings weightings="resistanceCategories" path-geometry="pathGeometry" class="expWeightings" success="disable"></div></div>')}]).filter("lcpLookup",[function(){var e={lcpKml:{name:"Least cost path KML",fileType:"kml",fileName:"lcp.kml",showInGoogle:!1},lcpCorridorKml:{name:"Least cost path buffer KML",fileType:"kml",fileName:"lcpCorridor.kml",showInGoogle:!1},cRasterKmz:{name:"Cost surface KML",fileType:"kmz",fileName:"costRaster.kmz",showInGoogle:!1},combinedKMZ:{name:"Combined KMZ",fileType:"kmz",fileName:"combinedKMZ",showInGoogle:!0},docPath:{name:"Least cost path report",fileType:"pdf",fileName:"lcpReport.pdf",showInGoogle:!0}};return function(t,n){var o=e[t];return(o||{name:t,fileType:""})[n||"name"]}}])}(angular,L),function(e,t,n){"use strict";e.module("geo.maphelper",["geo.map"]).factory("mapHelper",["mapService","$timeout","$q","$rootScope","flashService",function(e,t,n,o,i){var a,r=[[-47,107],[-9,156]];e.getMap().then(function(t){a=e.getGridLayer(),r=t.getBounds()});var s={timeoutPeriod:200,timeout:null,callbacks:{},checkMarkers:function(){},zoomToMarkPoints:function(t,n){e.getMap().then(function(e){e.setView(t[0],12,{animate:!0})})},zoomToLonLats:function(e){},zoomToBounds:function(t){e.getMap().then(function(e){e.fitBounds(t,{animate:!0})})},takeMeHomeCountryRoads:function(){e.getMap().then(function(e){e.fitBounds(r,{animate:!0})})},zoomOut:function(t){e.getMap().then(function(e){e.zoomOut(t)})},addLayer:function(t){e.getMap().then(function(e){e.addLayer(t)})},addLayers:function(t){e.getMap().then(function(e){t.forEach(function(t){e.addLayer(t)})})},removeLayer:function(t){e.getMap().then(function(e){e.removeLayer(t)})},fireEvent:function(t,n){e.getMap().then(function(e){e.fireEvent(t,n)})},showGrid:function(t){a&&e.getMap().then(function(e){t?a.addTo(e):e.removeLayer(a)})},markPoint:function(e){},getPseudoBaseLayer:function(){return e.getMap().then(function(e){var t=null;return e.eachLayer(function(e){e.pseudoBaseLayer&&(t=e)}),t})},subscribe:function(e,t){this.callbacks[e]||(this.callbacks[e]={subscribers:[]}),this.callbacks[e].subscribers.push(t)},pubChangeBaseLayerBias:function(e){},getExtentWkt:function(){return e.getMap().then(function(e){return Exp.Util.boundsToWktPoly(e.getBounds())})},decorateWfsLayer:function(e){}};return e.getMap().then(function(e){e.on("moveend",function(e){t.cancel(s.timeout),s.timeout=t(function(){s.getExtentWkt().then(function(e){o.$broadcast("extentOfInterestChanged",e)})},s.timoutPeriod)})}),s}])}(angular,window,L),function(e){"use strict";e.module("explorer.mapstate",[]).factory("mapStateService",["$log","mapService","persistService",function(e,t,n){var o=24e11;return{persist:function(){var e=Date.now();o-100>e&&n.setItem("marsMapTab",t.getState()),o=e},restore:function(){n.getItem("marsMapTab").then(function(e){e&&t.setState(e)})}}}])}(angular),function(e){"use strict";e.module("geo.measure",[]).directive("geoMeasure",["$log",function(e){return{require:"^geoMap",restrict:"AE",link:function(t,n,o,i){i.getMap().then(function(t){L.Control.measureControl().addTo(t),t.on("draw:drawstop",function(t){e.info("Draw stopped"),e.info(t)})})}}}])}(angular),function(){"use strict";var e={VIEW:1,CREATE:2,EDIT:4,DELETE:8,APPEND:16,EDIT_APPEND:20,ALL:31};L.Pather=L.FeatureGroup.extend({initialize:function(e){this.options=Object.assign(this.defaultOptions(),e||{}),this.creating=!1,this.polylines=[],this.eventHandlers=[]},createPath:function(e){if(e.length<=1)return!1;this.clearAll();var t=new L.Pather.Polyline(this.map,e,this.options,{fire:this.fire.bind(this),mode:this.getMode.bind(this),remove:this.removePath.bind(this)});return this.polylines.push(t),this.fire("created",{polyline:t,latLngs:t.getLatLngs()}),t},removePath:function(e){if(e instanceof L.Pather.Polyline){var t=this.polylines.indexOf(e);return this.polylines.splice(t,1),e.softRemove(),this.fire("deleted",{polyline:e,latLngs:[]}),!0}return!1},getPaths:function(){return this.polylines},onAdd:function(e){var t=this.element=this.options.element||e.getContainer();this.draggingState=e.dragging._enabled,this.map=e,this.fromPoint={x:0,y:0},this.svg=d3.select(t).append("svg").attr("pointer-events","none").attr("class",this.getOption("moduleClass")).attr("width",this.getOption("width")).attr("height",this.getOption("height")),e.dragging.disable(),this.attachEvents(e),this.setMode(this.options.mode)},onRemove:function(){if(this.svg.remove(),this.options.removePolylines)for(var e=this.polylines.length;e--;)this.removePath(this.polylines[e]);this.map.off("mousedown",this.eventHandlers.mouseDown),this.map.off("mousemove",this.eventHandlers.mouseMove),this.map.off("mouseup",this.eventHandlers.mouseUp),this.map.getContainer().removeEventListener("mouseleave",this.eventHandlers.mouseLeave),this.element.classList.remove("mode-create"),this.element.classList.remove("mode-delete"),this.element.classList.remove("mode-edit"),this.element.classList.remove("mode-append");var t=this.map.getContainer().querySelector(".leaflet-tile-pane"),n=this.draggingState?"enable":"disable";t.style.pointerEvents="all",this.map.dragging[n]()},getEvent:function(e){return e.touches?e.touches[0]:e},edgeBeingChanged:function(){var e=this.polylines.filter(function(e){return e.manipulating});return 0===e.length?null:e[0]},isPolylineCreatable:function(){return!!(this.options.mode&e.CREATE)},events:{mouseDown:function(e){e=e.originalEvent||this.getEvent(e);var t=this.map.mouseEventToContainerPoint(e),n=this.map.containerPointToLatLng(t);this.isPolylineCreatable()&&!this.edgeBeingChanged()&&(this.creating=!0,this.fromPoint=this.map.latLngToContainerPoint(n),this.latLngs=[])},mouseMove:function(e){e=e.originalEvent||this.getEvent(e);var t=this.map.mouseEventToContainerPoint(e);if(this.edgeBeingChanged())return void this.edgeBeingChanged().moveTo(this.map.containerPointToLayerPoint(t));var n=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear");if(this.creating){var o=[this.fromPoint,new L.Point(t.x,t.y,!1)];this.latLngs.push(t),this.svg.append("path").classed(this.getOption("lineClass"),!0).attr("d",n(o)).attr("stroke",this.getOption("strokeColour")).attr("stroke-width",this.getOption("strokeWidth")).attr("fill","none"),this.fromPoint={x:t.x,y:t.y}}},mouseLeave:function(){this.clearAll(),this.creating=!1},mouseUp:function(){return this.creating?(this.creating=!1,this.createPath(this.convertPointsToLatLngs(this.latLngs)),void(this.latLngs=[])):void(this.edgeBeingChanged()&&(this.edgeBeingChanged().attachElbows(),this.edgeBeingChanged().finished(),this.edgeBeingChanged().manipulating=!1))}},attachEvents:function(e){this.eventHandlers={mouseDown:this.events.mouseDown.bind(this),mouseMove:this.events.mouseMove.bind(this),mouseUp:this.events.mouseUp.bind(this),mouseLeave:this.events.mouseLeave.bind(this)},this.map.on("mousedown",this.eventHandlers.mouseDown),this.map.on("mousemove",this.eventHandlers.mouseMove),this.map.on("mouseup",this.eventHandlers.mouseUp),this.map.getContainer().addEventListener("mouseleave",this.eventHandlers.mouseLeave),this.map.getContainer().addEventListener("touchstart",this.fire.bind(e,"mousedown")),this.map.getContainer().addEventListener("touchmove",this.fire.bind(e,"mousemove")),this.map.getContainer().addEventListener("touchend",this.fire.bind(e,"mouseup"))},convertPointsToLatLngs:function(e){return e.map(function(e){return this.map.containerPointToLatLng(e)}.bind(this))},clearAll:function(){this.svg.text("")},getOption:function(e){return this.options[e]||this.defaultOptions()[e]},defaultOptions:function(){return{moduleClass:"pather",lineClass:"drawing-line",detectTouch:!0,elbowClass:"elbow",removePolylines:!0,strokeColour:"rgba(0,0,0,.5)",strokeWidth:2,width:"100%",height:"100%",smoothFactor:10,pathColour:"black",pathOpacity:.55,pathWidth:3,mode:e.ALL}},setSmoothFactor:function(e){this.options.smoothFactor=parseInt(e)},setMode:function(t){this.setClassName(t),this.options.mode=t;var n=this.map.getContainer().querySelector(".leaflet-tile-pane"),o=function(){return this.detectTouch&&("ontouchstart"in $window||"onmsgesturechange"in $window)?this.options.mode&e.CREATE||this.options.mode&e.EDIT:this.options.mode&e.CREATE}.bind(this);if(o()){var i=this.draggingState?"disable":"enable";return n.style.pointerEvents="none",void this.map.dragging[i]()}n.style.pointerEvents="all",this.map.dragging.enable()},setClassName:function(t){var n=function(n){var o=["mode",n].join("-");return e[n.toUpperCase()]&t?void this.element.classList.add(o):void this.element.classList.remove(o)}.bind(this);n("create"),n("delete"),n("edit"),n("append")},getMode:function(){return this.options.mode},setOptions:function(e){this.options=Object.assign(this.options,e||{})}}),L.Pather.MODE=e,L.pather=function(e){return new L.Pather(e)}}(window),function(){"use strict";Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var n=Object(e),o=1;o<arguments.length;o++){var i=arguments[o];if(void 0!==i&&null!==i){i=Object(i);for(var a=Object.keys(Object(i)),r=0,s=a.length;s>r;r++){var l=a[r],c=Object.getOwnPropertyDescriptor(i,l);void 0!==c&&c.enumerable&&(n[l]=i[l])}}}return n}})}(),function(){"use strict";var e="undefined"==typeof Symbol?"_pather":Symbol["for"]("pather");L.Pather.Polyline=function(e,t,n,o){this.options={color:n.pathColour,opacity:n.pathOpacity,weight:n.pathWidth,smoothFactor:n.smoothFactor||1,elbowClass:n.elbowClass},this.polyline=new L.Polyline(t,this.options).addTo(e),this.map=e,this.methods=o,this.edges=[],this.manipulating=!1,this.attachPolylineEvents(this.polyline),this.select()},L.Pather.Polyline.prototype={select:function(){this.attachElbows()},deselect:function(){this.manipulating=!1},attachElbows:function(){this.detachElbows(),this.polyline._parts[0].forEach(function(t){var n=new L.DivIcon({className:this.options.elbowClass}),o=this.map.layerPointToLatLng(t),i=new L.Marker(o,{icon:n}).addTo(this.map);i[e]={point:t},this.attachElbowEvents(i),this.edges.push(i)}.bind(this))},detachElbows:function(){this.edges.forEach(function(e){this.map.removeLayer(e)}.bind(this)),this.edges.length=0},attachPolylineEvents:function(e){e.on("click",function(e){if(e.originalEvent.stopPropagation(),e.originalEvent.preventDefault(),this.methods.mode()&L.Pather.MODE.APPEND){var t=this.map.mouseEventToLatLng(e.originalEvent);this.insertElbow(t)}else this.methods.mode()&L.Pather.MODE.DELETE&&this.methods.remove(this)}.bind(this))},attachElbowEvents:function(e){e.on("mousedown",function(t){t=t.originalEvent||t,this.methods.mode()&L.Pather.MODE.EDIT&&(t.stopPropagation&&(t.stopPropagation(),t.preventDefault()),this.manipulating=e)}.bind(this)),e.on("mouseup",function(e){e=e.originalEvent||e,e.stopPropagation&&(e.stopPropagation(),e.preventDefault()),this.manipulating=!1}),e._icon.addEventListener("touchstart",e.fire.bind(e,"mousedown")),e._icon.addEventListener("touchend",e.fire.bind(e,"mouseup"))},insertElbow:function(e){var t=this.map.latLngToLayerPoint(e),n=1/0,o=-1,i=this.polyline._parts[0];i.forEach(function(e,a){var r=i[a+1]||i[0],s=L.LineUtil.pointToSegmentDistance(t,e,r);n>s&&(n=s,o=a)}.bind(this)),i.splice(o+1,0,t);var a=i.map(function(e){var t=this.map.layerPointToLatLng(e);return{_latlng:t}}.bind(this));this.redraw(a),this.attachElbows()},moveTo:function(e){var t=this.map.layerPointToLatLng(e);this.manipulating.setLatLng(t),this.redraw(this.edges)},finished:function(){this.methods.fire("edited",{polyline:this,latLngs:this.getLatLngs()})},redraw:function(e){var t=[],n={};e.forEach(function(e){t.push(e._latlng)}),Object.keys(this.options).forEach(function(e){n[e]=this.options[e]}.bind(this)),n.smoothFactor=0,this.softRemove(!1),this.polyline=new L.Polyline(t,n).addTo(this.map),this.attachPolylineEvents(this.polyline)},softRemove:function(e){e="undefined"==typeof e?!0:e,this.map.removeLayer(this.polyline),e&&this.edges.forEach(function(e){this.map.removeLayer(e)}.bind(this))},getLatLngs:function(){return this.polyline._parts[0].map(function(e){return this.map.layerPointToLatLng(e)}.bind(this))}}}(),function(e,t){"use strict";e.module("geo.path",["geo.map","explorer.config","explorer.flasher","explorer.message"]).directive("geoPath",["mapService","pathService","$rootScope","flashService","messageService","configService","$timeout","$q",function(e,n,o,i,a,r,s,l){var c,u="distance";return{controller:["$scope",function(e){e.name="PATH"}],link:function(o,a,r){function s(){e.getMap().then(function(e){e.removeLayer(c)})}o.distanceMeasure={distance:"-"},o.showElevation=function(){var t=(c.getLatLngs(),e.getDistanceGeometry()),i=t.clone().transform(EPSG3857,EPSG4326).getGeodesicLength();o.disable(),n.triggerElevationPlot({length:i,geometry:t})},o.disable=function(){o.item="",s()},o.$watch("item",function(n,o){n==u?(i.add("Click on map to start a path or add next point. Double click to end path.",4e3),e.getMap().then(function(e){c=t.Polyline.Plotter([],{weight:4}),c.addTo(e)})):o==u&&s()})}}}]).factory("pathService",["$rootScope",function(e){return{triggerElevationPlot:function(t){e.$broadcast("elevation.plot.data",t)}}}]).filter("length",["$filter",function(e){var t={units:"m",threshold:1e5,aboveThresholdUnits:"km",divideBy:1e3};return function(n,o){var i,a;return n||0===n?(t.threshold&&n>t.threshold?(n/=t.divideBy,i=t.aboveThresholdUnits):i=t.units,a=e("number")(n,0)+" "+i,o?a:"("+a+")"):null}}])}(angular,L),function(e,t,n){"use strict";function o(e,t){this.click=function(){},this.mouseenter=function(e){t.overFeatures(e.feature)},this.mouseleave=function(e){t.outFeatures(e.feature)},this.groupEnter=function(n,o){var i=e("filterGroupsByLayername")(n,o);i.forEach(function(e){t.overFeatures(e.feature)})},this.groupLeave=function(n,o){var i=e("filterGroupsByLayername")(n,o);i.forEach(function(e){t.outFeatures(e.feature)})}}e.module("explorer.point",["geo.map","explorer.flasher"]).directive("expPoint",["pointService",function(e){return{scope:{data:"=point"},controller:["$scope",function(t){t.$watch("data",function(n,o){(n||o)&&e.showPoint(t.data)})}]}}]).directive("expClickMapPoint",["pointService",function(e){return{template:'<div style="position:relative;overflow:hidden"><i style="position:relative;display:inline-block;right:-3px;top:-3px" class="fa fa-location-arrow fa-rotate-180"></i><i style="position:absolute;display:inline-block;right:4px;top:7px" class="fa fa-location-arrow fa-rotate-180"></i></div>',restrict:"AE",scope:{},link:function(t,n){e.addMapListener(function(t){e.showPoint(t)},this)}}}]).directive("expClickModalMapPoint",["pointService","$rootScope",function(e,t){return{template:'<div style="position:relative;overflow:hidden"><i style="position:relative;display:inline-block;right:-3px;top:-3px" class="fa fa-location-arrow fa-rotate-180"></i><i style="position:absolute;display:inline-block;right:4px;top:7px" class="fa fa-location-arrow fa-rotate-180"></i></div>',restrict:"A",link:function(n){var o=!1,i=!1;t.$on("drawhelper.active",function(t,n){o&&!i&&e.showPoint(null),i=n}),e.addMapListener(function(t){e.showPoint(o&&!i&&t)},this),n.$watch("unlinked",function(t){o&&!i&&e.showPoint(null),o=t.featureDetails},!0)}}}]).directive("expPointInspector",["pointService","flashService","$rootScope","$filter",function(t,n,o,i){var a={actions:[],visible:!0,modal:!1,minWidth:240,title:"Features within approx 2km",position:{top:140,left:40}};return{restrict:"AE",templateUrl:"map/point/point.html",scope:!0,controller:["$scope",function(t){t.options?t.windowOptions=e.extend({},a,scope.options):t.windowOptions=e.extend({},a)}],link:function(e,n){function a(n){e.featuresInfo=n,t.createLayer()}o.$on("map.point.changed",function(n,o){e.point=o,t.removeLayer(),e.changePoint(o),o&&t.getMetaData().then(function(t){e.metadata=t.data})}),e.createTitle=function(){var e=!this.greaterThanOneItem(),t=this.feature.layerName,n=this.metadata[t],o=n.preferredLabel,i=this.feature.attributes[o];return!e&&i&&"Null"!=i?i:n.label;
},e.changePoint=function(e){t.moveMarker(e),e&&t.getInfo(e).then(function(e){a(e)}),t.removeLayer()},e.clearPoint=function(){e.point=!1,t.removeLayer(),t.removeMarker()},e.toggleShow=function(){this.feature.displayed=!this.feature.displayed,this.feature.displayed?this.feature.feature=t.showFeature(this.feature):(t.hideFeature(this.feature.feature),this.feature.layer=null)},e.oneShowing=function(){var t=i("filterGroupsByLayername")(e.featuresInfo.results,this.item),n=!1;return t.forEach(function(e){n|=e.displayed}),n},e.greaterThanOneItem=function(){return i("filterGroupsByLayername")(e.featuresInfo.results,this.item).length>1},e.groupShow=function(){var n=i("filterGroupsByLayername")(e.featuresInfo.results,this.item),o=!1;n.forEach(function(e){o|=e.displayed}),n.forEach(function(e){o?(e.feature=t.hideFeature(e.feature),e.displayed=!1):(e.feature=t.showFeature(e),e.displayed=!0)})},e.allHidden=function(){var e=!0;return this.featuresInfo&&this.featuresInfo.results&&this.featuresInfo.results.forEach(function(t){e&=!t.displayed}),e},e.toggleAll=function(){var n=e.allHidden();this.featuresInfo.results.forEach(function(e){n?e.displayed||(e.displayed=!0,e.feature=t.showFeature(e)):e.displayed&&(e.displayed=!1,e.feature=t.hideFeature(e.feature))})},e.elevationPath=function(e){this.feature.feature||(this.feature.feature=t.createFeature(this.feature)),t.triggerElevationPlot(this.feature.feature[0],e)}}}}]).factory("pointService",["httpData","$q","configService","mapService","$rootScope",function(o,i,a,r,s){var l="service/path/featureInfo",c=null,u={esriGeometryPoint:{createFeatures:function(e){var n=[e.y,e.x];return[t.circleMarker(n)]},type:"x,y"},esriGeometryPolyline:{createFeatures:function(e){var n=[];return e.paths.forEach(function(e){var o=[];e.forEach(function(e){o.push([e[1],e[0]])}),n.push(t.polyline(o))}),n},type:"paths"},esriGeometryPolygon:{createFeatures:function(e){var n,o=[];return e.rings.forEach(function(e){var t=[];e.forEach(function(e){t.push([e[1],e[0]])}),o.push(t)}),n=t.multiPolygon(o),[n]},type:"rings"}},h=o.baseUrlForPkg("ga-explorer-map")+"resources/point/pointMetadata.json",p=null,f=null,d=[];return{triggerElevationPlot:function(e,t){var n=e.getLength();s.$broadcast("elevation.plot.data",{length:n,geometry:e.getLatLngs(),heading:t})},addMapListener:function(e,t){var n=!1;d.forEach(function(o){o.callback==e&&o.bound==t&&(n=!0)}),n||d.push({callback:e,bound:t}),f||(f=!0,r.getMap().then(function(e){e.on("click",function(e){d.forEach(function(t){var n=t.callback,o={x:e.latlng.lng,y:e.latlng.lat};o.lat=o.y,o.lng=o.x,t.bound&&n.bind(t.bound),n(o)})})}))},getMetaData:function(){return o.get(h,{cache:!0})},moveMarker:function(e){r.getMap().then(function(n){p&&n.removeLayer(p),p=e?t.marker(e).addTo(n):null})},removeMarker:function(){p&&r.getMap().then(function(e){e.removeLayer(p),p=null})},showPoint:function(e){s.$broadcast("map.point.changed",e)},removePoint:function(){s.$broadcast("map.point.changed",null)},getBehaviour:function(e){},getInfo:function(e){return r.getMap().then(function(t){var i=t._container.getBoundingClientRect(),r=n.devicePixelRatio?n.devicePixelRatio:1,s=t.getBounds();return a.getConfig("clientSessionId").then(function(t){return o.post(l,{clientSessionId:t,x:e.x,y:e.y,width:i.width/r,height:i.height/r,extent:{left:s.left,right:s.right,top:s.top,bottom:s.bottom}}).then(function(e){return e.data})})})},overFeatures:function(t){var n;t&&(n=e.isArray(t)?t[0]:t,n&&n.bringToFront().setStyle({color:"red"}))},outFeatures:function(e){e&&e.forEach(function(e){e.setStyle({color:"#03f"})})},createLayer:function(){return r.getMap().then(function(e){return c=t.layerGroup(),e.addLayer(c),c})},removeLayer:function(){return r.getMap().then(function(e){return c&&e.removeLayer(c),c=null})},createFeature:function(e){return u[e.geometryType].createFeatures(e.geometry)},showFeature:function(e){var t=this.createFeature(e);return t.forEach(function(e){c.addLayer(e)}),t},hideFeature:function(e){e&&e.forEach(function(e){c.removeLayer(e)})}}}]).filter("dashNull",[function(){return function(e){return e&&"Null"!=e?e:"-"}}]).filter("featureGroups",[function(){return function(e){var t=[],n={};return e?(e.forEach(function(e){var o=e.layerName;n[o]||(n[o]=!0,t.push(o))}),t):t}}]).filter("filterGroupsByLayername",[function(){return function(e,t){var n=[];return e?(e.forEach(function(e){t==e.layerName&&n.push(e)}),n):n}}]).controller("OverFeatureCtrl",o),o.$invoke=["$filter","pointService"]}(angular,L,window),function(e,t){"use strict";function n(e){e=e||{},this.load=function(t,n,o){var i=new XMLHttpRequest;i.addEventListener("load",function(e){var t=new GeotiffParser;t.parseHeader(e.target.response),n(t.loadPixels())},!1),void 0!==o&&i.addEventListener("error",function(e){o(e)},!1),void 0!==e.crossOrigin&&(i.crossOrigin=e.crossOrigin),i.open("GET",t,!0),i.responseType="arraybuffer",i.send(null)},this.setCrossOrigin=function(t){e.crossOrigin=t}}e.module("geo.transect",["explorer.config","explorer.feature.summary","explorer.flasher","geo.path"]).provider("transectService",function(){function o(e,t){var n=Math.sqrt(e*e/(1+t*t));return{y:Math.ceil(n),x:Math.ceil(n*t)}}var i,a=500,r={},s={lngMin:112.99986111100009,lngMax:153.999861113351,latMin:-44.0001389004617,latMax:-10.00013890099995};this.extent=function(t){s.lngMin=e.isUndefined(t.lngMin)?s.lngMin:t.lngMin,s.lngMax=e.isUndefined(t.lngMax)?s.lngMax:t.lngMax,s.latMin=e.isUndefined(t.latMin)?s.latMin:t.latMin,s.latMax=e.isUndefined(t.latMax)?s.latMax:t.latMax},this.setServiceUrl=function(e,t){e=e.toLowerCase(),r[e]={urlTemplate:t},"elevation"===e&&(i=t.replace(/{height}|{width}/g,"1"))},this.$get=["$q","httpData","flashService",function(e,l,c){return{getElevation:function(e,t){return this.getServiceData("elevation",e,t)},getServiceData:function(i,s,l){var u=(c.add("Retrieving "+i+" details...",8e3),t.Util.toGeoJSONFeature(s)),h=turf.extent(u),p={type:"FeatureCollection",features:[]},f=h[0],d=h[1],g=h[2],m=h[3];i=i.toLowerCase();var v=r[i]&&r[i].urlTemplate;if(!v)return e.when(p);g=g>f?g:f+1e-4,m=m>d?m:d+1e-4;var y=g-f,b=m-d;l||(l=0),d-=l*b,m+=l*b,f-=l*y,g+=l*y;var w=o(a,y/b),L=turf.lineDistance(u,"kilometers"),x=new n,S=e.defer();return v=v.replace("{bbox}",f+","+d+","+g+","+m).replace(/{width}/g,""+Math.ceil(w.x)).replace(/{height}/g,""+Math.ceil(w.y)),x.load(v,function(e){function t(t){var n=t[0],o=t[1],i=f,a=m,r=Math.round((a-o)/b*(w.y-1)),s=Math.round((n-i)/y*(w.x-1)),l=r*w.x+s;return e[l]}for(var n=L/(a-1),o=0;a>o;o++){var i=turf.along(u,o*n,"kilometers");i.geometry.coordinates.push(t(i.geometry.coordinates)),p.features.push(i)}S.resolve(p)}),S.promise},canGetElevationAtPoint:function(){return i},getElevationAtPoint:function(t){var o=t.lng,a=t.lat;if(a<s.latMin||a>s.latMax||o<s.lngMin||o>s.lngMax)return e.when(null);var r=[o-1e-6,a-1e-6,o+1e-6,a+1e-6],l=e.defer();return(new n).load(i.replace("{bbox}",r.join(",")),function(e){l.resolve(e)}),l.promise}}}]})}(angular,Exp),function(e){"use strict";e.Control.Features=e.Control.extend({_active:!1,_map:null,includes:e.Mixin.Events,options:{position:"topleft",className:"fa fa-location-arrow fa-rotate-180",modal:!1},onAdd:function(t){this._map=t,this._container=e.DomUtil.create("div","leaflet-feature-control leaflet-bar"),this._container.title="Show features under point";var n=e.DomUtil.create("a",this.options.className,this._container);return n.href="#",e.DomEvent.on(this._container,"dblclick",e.DomEvent.stop).on(this._container,"click",e.DomEvent.stop).on(this._container,"click",function(n){this._active=!this._active,this._active?(t.fireEvent("featuresactivate",n),e.DomUtil.addClass(this,"active")):(t.fireEvent("featuresdeactivate",n),e.DomUtil.removeClass(this,"active"))}),this._container},activate:function(){e.DomUtil.addClass(this._container,"active")},deactivate:function(){e.DomUtil.removeClass(this._container,"active"),this._active=!1}}),e.control.features=function(t){return new e.Control.Features(t)}}(L),L.Google=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1,mapOptions:{backgroundColor:"#dddddd"}},initialize:function(e,t){L.Util.setOptions(this,t),this._ready=void 0!==google.maps.Map,this._ready||L.Google.asyncWait.push(this),this._type=e||"SATELLITE"},onAdd:function(e,t){this._map=e,this._insertAtTheBottom=t,this._initContainer(),this._initMapObject(),e.on("viewreset",this._resetCallback,this),this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this),e.on("move",this._update,this),e.on("zoomanim",this._handleZoomAnim,this),e._controlCorners.bottomright.style.marginBottom="20px",this._reset(),this._update()},onRemove:function(e){e._container.removeChild(this._container),e.off("viewreset",this._resetCallback,this),e.off("move",this._update,this),e.off("zoomanim",this._handleZoomAnim,this),e._controlCorners.bottomright.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(e){this.options.opacity=e,1>e&&L.DomUtil.setOpacity(this._container,e)},setElementSize:function(e,t){e.style.width=t.x+"px",e.style.height=t.y+"px"},_initContainer:function(){var e=this._map._container,t=e.firstChild;this._container||(this._container=L.DomUtil.create("div","leaflet-google-layer leaflet-top leaflet-left"),this._container.id="_GMapContainer_"+L.Util.stamp(this),this._container.style.zIndex="auto"),e.insertBefore(this._container,t),this.setOpacity(this.options.opacity),this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(this._ready){this._google_center=new google.maps.LatLng(0,0);var e=new google.maps.Map(this._container,{center:this._google_center,zoom:0,tilt:0,mapTypeId:google.maps.MapTypeId[this._type],disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:this.options.mapOptions.styles,backgroundColor:this.options.mapOptions.backgroundColor}),t=this;this._reposition=google.maps.event.addListenerOnce(e,"center_changed",function(){t.onReposition()}),this._google=e,google.maps.event.addListenerOnce(e,"idle",function(){t._checkZoomLevels()}),this.fire("MapObjectInitialized",{mapObject:e})}},_checkZoomLevels:function(){this._google.getZoom()!==this._map.getZoom()&&this._map.setZoom(this._google.getZoom())},_resetCallback:function(e){this._reset(e.hard)},_reset:function(e){this._initContainer()},_update:function(e){if(this._google){this._resize();var t=this._map.getCenter(),n=new google.maps.LatLng(t.lat,t.lng);this._google.setCenter(n),this._google.setZoom(Math.round(this._map.getZoom())),this._checkZoomLevels()}},_resize:function(){var e=this._map.getSize();this._container.style.width===e.x&&this._container.style.height===e.y||(this.setElementSize(this._container,e),this.onReposition())},_handleZoomAnim:function(e){var t=e.center,n=new google.maps.LatLng(t.lat,t.lng);this._google.setCenter(n),this._google.setZoom(Math.round(e.zoom))},onReposition:function(){this._google&&google.maps.event.trigger(this._google,"resize")}}),L.Google.asyncWait=[],L.Google.asyncInitialize=function(){var e;for(e=0;e<L.Google.asyncWait.length;e++){var t=L.Google.asyncWait[e];t._ready=!0,t._container&&(t._initMapObject(),t._update())}L.Google.asyncWait=[]},function(e){"use strict";e.Control.Legend=e.Control.extend({_active:!1,_map:null,includes:e.Mixin.Events,options:{position:"topleft",overlayClass:"leaflet-legend",className:"fa fa-list",modal:!1,url:"resources/img/NationalLegend.png"},onAdd:function(t){var n=this;this._map=t,this._container=e.DomUtil.create("div","leaflet-legend-control leaflet-bar"),this._container.title="Show legend";var o=e.DomUtil.create("a",this.options.className,this._container);return o.href="#",e.DomEvent.on(this._container,"dblclick",e.DomEvent.stop).on(this._container,"click",e.DomEvent.stop).on(this._container,"click",function(){n._active=!n._active,n._active?(n._legend=e.control({position:"topleft"}),n._legend.onAdd=function(t){var o=e.DomUtil.create("div",n.options.overlayClass),i='<img src="'+n.options.url+'"></img>';return e.DomEvent.disableClickPropagation(o).disableScrollPropagation(o).on(o,"keydown",function(e){function t(e){e.stopPropogation(),e.preventDefault()}24==e.keyCode?(this.scrollTop-=20,t(e)):25==e.keyCode&&(this.scrollTop+=20,t(e))}),o.innerHTML=i,o.tabIndex=0,o.focus(),o},t.addControl(n._legend),e.DomUtil.addClass(n._container,"active")):(t.removeControl(n._legend),e.DomUtil.removeClass(n._container,"active"))}),this._container},activate:function(){e.DomUtil.addClass(this._container,"active")},deactivate:function(){e.DomUtil.removeClass(this._container,"active"),this._active=!1}}),e.control.legend=function(t){return new e.Control.Legend(t)}}(L),L.Control.MousePosition=L.Control.extend({options:{position:"bottomleft",separator:" : ",emptyString:"Unavailable",lngFirst:!1,numDigits:5,elevGetter:void 0,lngFormatter:void 0,latFormatter:void 0,prefix:""},onAdd:function(e){return this._container=L.DomUtil.create("div","leaflet-control-mouseposition"),L.DomEvent.disableClickPropagation(this._container),e.on("mousemove",this._onMouseMove,this),this._container.innerHTML=this.options.emptyString,this._container},onRemove:function(e){e.off("mousemove",this._onMouseMove)},_onMouseHover:function(){var e=this._hoverInfo;this._hoverInfo=void 0,this.options.elevGetter(e).then(function(e){this._hoverInfo||(this._container.innerHTML=this.options.prefix+" "+e+" "+this._latLngValue)}.bind(this))},_onMouseMove:function(e){var t=e.latlng.wrap();lng=this.options.lngFormatter?this.options.lngFormatter(t.lng):L.Util.formatNum(t.lng,this.options.numDigits),lat=this.options.latFormatter?this.options.latFormatter(t.lat):L.Util.formatNum(t.lat,this.options.numDigits),this._latLngValue=this.options.lngFirst?lng+this.options.separator+lat:lat+this.options.separator+lng,this.options.elevGetter&&(this._hoverInfo&&window.clearTimeout(this._hoverInfo.timeout),this._hoverInfo={lat:t.lat,lng:t.lng,timeout:window.setTimeout(this._onMouseHover.bind(this),400)}),this._container.innerHTML=this.options.prefix+" "+this._latLngValue}}),L.Map.mergeOptions({positionControl:!1}),L.Map.addInitHook(function(){this.options.positionControl&&(this.positionControl=new L.Control.MousePosition,this.addControl(this.positionControl))}),L.control.mousePosition=function(e){return new L.Control.MousePosition(e)},L.Control.ZoomBox=L.Control.extend({_active:!1,_map:null,includes:L.Mixin.Events,options:{position:"topleft",className:"fa fa-search-plus",modal:!1},onAdd:function(e){this._map=e,this._container=L.DomUtil.create("div","leaflet-zoom-box-control leaflet-bar"),this._container.title="Zoom to specific area";var t=L.DomUtil.create("a",this.options.className,this._container);t.href="#";var n=e.boxZoom._onMouseDown;return e.boxZoom._onMouseDown=function(t){n.call(e.boxZoom,{clientX:t.clientX,clientY:t.clientY,which:1,shiftKey:!0})},e.on("zoomend",function(){e.getZoom()==e.getMaxZoom()?L.DomUtil.addClass(t,"leaflet-disabled"):L.DomUtil.removeClass(t,"leaflet-disabled")},this),this.options.modal||e.on("boxzoomend",this.deactivate,this),L.DomEvent.on(this._container,"dblclick",L.DomEvent.stop).on(this._container,"click",L.DomEvent.stop).on(this._container,"click",function(){this._active=!this._active,this._active&&e.getZoom()!=e.getMaxZoom()?this.activate():this.deactivate()},this),this._container},activate:function(){L.DomUtil.addClass(this._container,"active"),this._map.dragging.disable(),this._map.boxZoom.addHooks(),L.DomUtil.addClass(this._map.getContainer(),"leaflet-zoom-box-crosshair")},deactivate:function(){L.DomUtil.removeClass(this._container,"active"),this._map.dragging.enable(),this._map.boxZoom.removeHooks(),L.DomUtil.removeClass(this._map.getContainer(),"leaflet-zoom-box-crosshair"),this._active=!1,this._map.boxZoom._moved=!1}}),L.control.zoomBox=function(e){return new L.Control.ZoomBox(e)},L.Control.Zoommin=L.Control.extend({_active:!1,_map:null,includes:L.Mixin.Events,options:{position:"topleft",className:"fa fa-home",modal:!1},onAdd:function(e){this._map=e,this._container=L.DomUtil.create("div","leaflet-zoom-box-control leaflet-bar"),this._container.title="Zoom to max extent";var t=L.DomUtil.create("a",this.options.className,this._container);return t.href="#",L.DomEvent.on(this._container,"dblclick",L.DomEvent.stop).on(this._container,"click",L.DomEvent.stop).on(this._container,"click",function(){this._active=!this._active,e.setView(this.options.center,this.options.zoom)},this),this._container},activate:function(){L.DomUtil.addClass(this._container,"active")},deactivate:function(){L.DomUtil.removeClass(this._container,"active"),this._active=!1}}),L.control.zoommin=function(e){return new L.Control.Zoommin(e)},L.Control.Zoomout=L.Control.extend({_active:!1,_map:null,includes:L.Mixin.Events,options:{position:"topleft",className:"fa fa-search-minus",modal:!1},onAdd:function(e){this._map=e,this._container=L.DomUtil.create("div","leaflet-zoom-box-control leaflet-bar"),this._container.title="Zoom out";var t=L.DomUtil.create("a",this.options.className,this._container);return t.href="#",e.on("zoomend",function(){e.getZoom()==e.getMaxZoom()?L.DomUtil.addClass(t,"leaflet-disabled"):L.DomUtil.removeClass(t,"leaflet-disabled")},this),e.on("boxzoomend",this.deactivate,this),L.DomEvent.on(this._container,"dblclick",L.DomEvent.stop).on(this._container,"click",L.DomEvent.stop).on(this._container,"click",function(){this._active=!this._active;var t,n=e.getZoom();n<=e.getMinZoom()||(t=10>n?n-1:13>n?n-2:n-3,e.setZoom(t))},this),this._container},activate:function(){L.DomUtil.addClass(this._container,"active")},deactivate:function(){L.DomUtil.removeClass(this._container,"active"),this._active=!1}}),L.control.zoomout=function(e){return new L.Control.Zoomout(e)},function(e){e.Polyline.prototype.getLength=function(){var e=0,t=null;return this._latlngs.forEach(function(n,o,i){t=n,o&&(e+=t.distanceTo(i[o-1]))}),e}}(L),function(e,t,n){"use strict";e.module("geo.map",[]).directive("geoMap",["mapService","waiting",function(e,t){var n;return{restrict:"AE",scope:{configuration:"="},controller:["$q","$scope",function(e,o){this.getMap=function(){return o.map?void e.when(o.map):(n||(n=t.wait()),n.waiter().promise)}}],link:function(t,o){t.$watch("configuration",function(i){i&&(i.element=o[0],t.map=e.addMap(i),n&&n.resolve(t.map))})}}}]).factory("mapService",["$injector","$filter","$q","$rootScope","waiting",function(o,i,a,r,s){function l(e,n,o){var i=c(e);i.pseudoBaseLayer=e.pseudoBaseLayer,e.addLayerControl&&(p||(p={}),p[e.name]=i),(e.defaultLayer||e.pseudoBaseLayer)&&n.addLayer(i),p&&o.addControl(new t.Control.Layers(p,{})),e.layer=i}function c(n){var o=[];return e.isArray(n.type)?(o=t,n.type.forEach(function(e){o=o[e]})):o=t[n.type],n.parameters&&n.parameters.length>0?new o(n.parameters[0],n.parameters[1],n.parameters[2],n.parameters[3],n.parameters[4]):new o}var u,h,p,f,d="MAP_",g=0,m={},v={maps:{}};return v.getMap=function(e){return e||(e=u),u?a.when(v.maps[e]):(h||(h=s.wait()),h.waiter().promise)},v.addToGroup=function(e,t){this.getMap().then(function(n){var o=m[t];o&&l(e,o,n)})},v.getGroup=function(e){return m[e]},v.clearGroup=function(e){var t=m[e],n=t.getLayers();n.forEach(function(e){t.removeLayer(e)})},v.removeFromGroup=function(e,t){var n=m[t];n&&(n.removeLayer(e.layer),e.layer=null)},v.getGridLayer=function(){return f},v.addMap=function(e){var a,r=null;e.name||(e.name=d+g++),u=e.name,a=v.maps[e.name]=new t.Map(e.element,{center:e.options.center,zoom:e.options.zoom,zoomControl:!e.options.noZoomControl}),e.gridLayer&&(e.gridLayer.name="Grid",f=c(e.gridLayer)),e.layers&&e.layers.forEach(function(e){var n;"LayerGroup"==e.type?e.layers&&(m[e.name]=n=t.layerGroup([]),e.layers.forEach(function(e){l(e,a,n)}),a.addLayer(n)):(l(e,a,a),e.pseudoBaseLayer&&e.legendUrl&&(r={url:e.legendUrl}))});var s,p=o.get("transectService");return p.canGetElevationAtPoint()&&(s=function(e){return p.getElevationAtPoint(e).then(function(e){return null===e?"":"Elev: "+i("length")(Math.round(e),!0)})}),t.control.scale({imperial:!1}).addTo(a),t.control.mousePosition({position:"bottomright",emptyString:"",seperator:" ",elevGetter:s,latFormatter:function(e){return"Lat "+t.Util.formatNum(e,5)+""},lngFormatter:function(e){return"Lng "+t.Util.formatNum(e%180,5)+""}}).addTo(a),e.options.noZoomControl||t.control.zoomBox({}).addTo(a),n.map=a,h&&h.resolve(a),r&&a.addControl(t.control.legend(r)),a},v}])}(angular,L,window),angular.module("explorer.map.templates",[]).run(["$templateCache",function(e){e.put("map/baselayer/baseLayerSlider.html",'<span style="width:30em;">\r\n	<span id="baselayerCtrl">\r\n 		<input id="baselayerSlider" class="temperature" baselayer-slider title="Slide to emphasize either a satellite or topography view." />\r\n	</span>\r\n</span>'),e.put("map/chartTransect/chartTransect.html",'<div id="transectChart" ng-style="{ \'width\': transectChartService.minPanelWidth }" ng-show="chartState.targetChartId == \'transectChart\'">\r\n\r\n	<div ng-show="transectChartService.faultTransected"\r\n		 class="fault-legend danger-pulse" ng-class="{\'danger-pulse\': transectChartService.faultTransected}"\r\n		 tooltip="Faults are not ideal for CCS.."\r\n		 tooltip-placement="left">\r\n		<span class="fault-legend-color"></span>\r\n		<strong> Known Faults Transected <i class="fa fa-exclamation-triangle"></i></strong>\r\n	</div>\r\n\r\n	<div id="transectChartD3Legend" class="clear-float">\r\n\r\n		<div class="btn-group" style="float: right; margin: -10px 0px 20px 0px">\r\n			<button type="button" class="btn btn-default" title="Find out information about the data behind these graphs"\r\n					ng-click="showInfo = !showInfo">\r\n				<i class="fa fa-info-circle" role="presentation" style="font-size:16px; color:black"></i>\r\n			</button>\r\n\r\n			<button type="button" class="btn btn-default" title="Close graphs" ng-click="transectChartService.hideChart()">\r\n				<i class="fa fa-times-circle" role="presentation" style="font-size:16px; color:black"></i>\r\n			</button>\r\n		</div>\r\n\r\n		<div ng-repeat="property in transectChartService.properties" class="clear-float" tooltip="{{property.description}}" tooltip-placement="left">\r\n			<p>\r\n				<span ng-style="{ \'background\': property.color }" class="rect"></span>\r\n				<strong>{{ property.label }} Z (m) </strong>\r\n				<code ng-if="transectChartService.targetData && transectChartService.targetData[property.name]"> {{ transectChartService.targetData[property.name].z | number: 3}}</code>\r\n				<code ng-if="!transectChartService.targetData || !transectChartService.targetData[property.name]"> -- </code>\r\n			</p>\r\n		</div>\r\n\r\n		<div class="clear-float">\r\n			<p tooltip="Closest x value to you cursor\'s position" tooltip-placement="left">\r\n				<strong>X</strong>\r\n				<code ng-if="transectChartService.targetData">{{transectChartService.targetData.x | number: 3}}</code>\r\n				<code ng-if="!transectChartService.targetData"> -- </code>\r\n			</p>\r\n			<p tooltip="Closest y value to you cursor\'s position" tooltip-placement="left">\r\n				<strong>Y</strong>\r\n				<code ng-if="transectChartService.targetData">{{transectChartService.targetData.y | number: 3}}</code>\r\n				<code ng-if="!transectChartService.targetData"> -- </code>\r\n			</p>\r\n		</div>\r\n\r\n	</div>\r\n\r\n	<div id="transectChartD3"></div>\r\n\r\n</div>'),e.put("map/elevation/elevation.html",'<div class="container-full elevationContainer" ng-show="geometry" style="background-color:white; opacity:0.9;padding:2px">\r\n	<div class="row">\r\n		<div class="col-md-4">\r\n			<span class="graph-brand">Path Elevation</span>\r\n		</div>	\r\n		<div class="col-md-8">\r\n			<div class="btn-toolbar pull-right" role="toolbar" style="margin-right: 3px;">\r\n				<div class="btn-group" ng-show="intersectsWaterTable">	\r\n					<button type="button" class="btn btn-default" ng-click="toggleWaterTable()" \r\n							title="Show groundwater over elevation">{{paths.length == 1?\'Show\':\'Hide\'}} Water Table</button>\r\n				</div>	\r\n				<div class="btn-group">	\r\n					<button type="button" class="btn btn-default" title="Find out information about the data behind these graphs" \r\n							ng-click="showInfo = !showInfo">\r\n						<i class="fa fa-info-circle" role="presentation" style="font-size:16px; color:black"></i>\r\n					</button>\r\n					<exp-info title="Graph Information" style="width:400px;position:absolute;bottom:-80px;right:60px" show-close="true" is-open="showInfo"><div mars-info-elevation></div></exp-info>				\r\n					<button type="button" class="btn btn-default" title="Close graphs" ng-click="close()">\r\n						<i class="fa fa-times-circle" role="presentation" style="font-size:16px; color:black"></i>\r\n					</button>				\r\n				</div>\r\n			</div>\r\n		</div>	\r\n	</div>\r\n	<div explorer-graph data="paths" config="config" click="graphClick(event)" move="graphMove(event)" leave="graphLeave(event)" enter="graphEnter(event)" show-zero-line="true"></div>\r\n	<div exp-point-features features="featuresUnderPoint" class="featuresUnderPoint"></div>\r\n	<div exp-point point="point" class="featuresInfo" style="display:none"></div>\r\n	<div class="elevationHoverPanel" mars-point-info ng-show="position"\r\n		ng-attr-style="top:{{position.pageY - 70}}px;left:{{position.pageX * 0.94 - 10}}px;">\r\n		<div class="ng-binding"><strong>Elev.:</strong>{{position.point.z|number:0}}m</div>\r\n		<div class="ng-binding"><strong>Dist.:</strong>{{length * position.percentX * 0.01|length : true }}</div>\r\n	</div>\r\n	</div>\r\n</div>'),e.put("map/elevation/elevationInfo.html",'<div>\r\nThe elevation graph is calculated from the 3" DEM data. \r\nThe data is held in a grid with a cell size of approx. 90 m. \r\nThe data has a &plusmn;5 m error. Full metadata about the data and how to acquire the data can be found \r\n<a target="_blank" href="http://www.ga.gov.au/metadata-gateway/metadata/record/gcat_aac46307-fce9-449d-e044-00144fdd4fa6">here</a>\r\n<br/>\r\nIf the path of the graph intersects areas that we have prepared water table data there will be the ability to plot this data. \r\nThe accuracy is not as high as the elevation data and has &plusmn;50 m error. Smoothing with this error can make the \r\nwater table appear above the elevation of the surface on occasions. \r\nData availability will be indicated by the button labelled "Show Water Table". \r\n<a href="javascript:;" ng-click="toggleWaterTableShowing()">Click to {{state.isWaterTableShowing?\'hide\':\'view\'}} the water table extent.</a>\r\n</div>\r\n'),e.put("map/featuresummary/featuresSummary.html",'<div class="marsfeatures" ng-show="features" ng-style="featurePanelPosition()" ng-class="features.popupClass">\r\n	<div id="menu_mn_active_tt_active" data-role="popup" role="tooltip">\r\n		<div class="pathContent">\r\n			<div ng-repeat="(key, feature) in features.data">\r\n				{{mappings[key].title}}  ({{feature}})\r\n			</div>\r\n			<div ng-hide="features.count">No nearby features</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'),e.put("map/layerinspector/layerInspector.html",'<div class="interactionPanel">\r\n	<div class="exp-block" ng-show="active" style="height:100%">\r\n		<div class="exp-header">\r\n			<div class="interactionPanelHeader" ng-hide="hidename">\r\n				<a href="javascript:;" ng-click="click()" ng-show="showClose" title="Name is {{name || active.name}}">{{name || active.name}}</a>\r\n				<span ng-hide="showClose">{{name || active.name}}</span>\r\n			</div>\r\n			<div style="float:right">\r\n				<a class="featureLink" href="javascript:;" title="Show on map" \r\n						ng-click="toggleShow(active)"><i class="fa" ng-class="{\'fa-eye-slash\':(!active.displayed), \'fa-eye\':active.displayed}"></i></a>\r\n				<a class="featureLink" href="javascript:;" title="Collapse extra information" ng-show="showClose"\r\n						ng-click="click()"><i class="fa fa-caret-square-o-up"></i></a>\r\n			</div>\r\n		</div>\r\n		<div>\r\n			<div class="thumbNailContainer" ng-show="active.thumbUrl">\r\n				<img width="100" ng-src="{{active.thumbUrl}}" class="img-thumbnail" alt="{{active.description}}"></img>\r\n			</div>\r\n			<strong>Opacity</strong><br/>\r\n			<span explorer-layer-slider layer="active.layer" title="Change the opacity of the selected layer when shown on the map" class="opacitySlider"></span>\r\n			<p/>\r\n			{{active.description}}\r\n		</div> \r\n	</div>\r\n</div>'),e.put("map/leastCostPath/leastCostDisplay.html",'\r\n<exp-modal is-open="results.data" style="position:fixed;top:132px;left:42px" title="Least cost path control panel" on-close="clear()">\r\n    <div ng-if="results.data.jobStatus != \'esriJobFailed\'" class="esriLcpSuccess">\r\n        <div>\r\n            <div>\r\n                <div style="float:left;font-zize:120%; font-weight:bold; padding:5px;">View...</div>\r\n                <div style="float:right">\r\n                    <a class="featureLink" href="javascript:;" title="Bring least cost path layers to the top of the map."\r\n                       ng-click="bringToTop()"><i class="fa fa-arrow-up"></i> </a>\r\n                </div>\r\n                <div ng-mouseenter="mouseenterPath()" ng-mouseleave="mouseleavePath()" style="clear:both">\r\n                    <div>\r\n                        <div style="float: left;padding-left:16px">\r\n                            Original drawn path\r\n                        </div>\r\n                        <div style="float: right">\r\n                            <a class="featureLink" href="javascript:;" title="Plot elevation for path."\r\n                               ng-click="elevationPath()"><i class="fa fa-align-left fa-rotate-270"></i> </a>\r\n                            <a class="featureLink" href="javascript:;" title="Toggle showing original drawn path on map"\r\n                               ng-click="togglePath()"><i class="fa" ng-class="{\'fa-eye-slash\':(!pathShown), \'fa-eye\':pathShown}"></i></a>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div ng-mouseenter="mouseenterLcp()" ng-mouseleave="mouseleaveLcp()" style="clear:both">\r\n                    <div>\r\n                        <div style="float: left;padding-left:16px">\r\n                            Least cost path\r\n                        </div>\r\n                        <div style="float: right">\r\n                            <a class="featureLink" href="javascript:;" title="Plot elevation for least cost path."\r\n                               ng-click="elevationLcpKml()"><i class="fa fa-align-left fa-rotate-270"></i> </a>\r\n                            <a class="featureLink" href="javascript:;" title="Toggle showing least cost path on map"\r\n                               ng-click="toggleLcpKml()"><i class="fa" ng-class="{\'fa-eye-slash\':(!lcpKmlShown), \'fa-eye\':lcpKmlShown}"></i></a>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n\r\n                <div ng-mouseenter="mouseenterLcpBuffer()" ng-mouseleave="mouseleaveLcpBuffer()" style="clear:both">\r\n                    <div>\r\n                        <div style="float: left;padding-left:16px">\r\n                            Least cost path buffer\r\n                        </div>\r\n                        <div style="float: right">\r\n                            <a class="featureLink" href="javascript:;" title="Toggle showing least cost path buffer on map"\r\n                               ng-click="toggleLcpBufferKml()"><i class="fa" ng-class="{\'fa-eye-slash\':(!lcpBufferKmlShown), \'fa-eye\':lcpBufferKmlShown}"></i></a>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div ng-mouseenter="mouseenterCostSurface()" ng-mouseleave="mouseleaveCostSurface()" style="clear:both">\r\n                    <div>\r\n                        <div style="float: left;padding-left:16px">\r\n                            Cost surface\r\n                        </div>\r\n                        <div style="float: right">\r\n                            <a class="featureLink" href="javascript:;" title="Toggle showing cost surface on map"\r\n                               ng-click="toggleCostSurface()"><i class="fa" ng-class="{\'fa-eye-slash\':(!costSurfaceShown), \'fa-eye\':costSurfaceShown}"></i></a>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <button type="button" class="btn btn-default" style="margin:2px;width:90%" ng-click="zoomToCentre()">Zoom to least cost path.</button>\r\n            </div>\r\n            <br/>\r\n            <div>\r\n                <div style="font-zize:120%; font-weight:bold; padding:5px;" title="Requires that you have Google Earth installed and associated with KML and KMZ files.">Link to Google Earth...</div>\r\n                <div ng-repeat="(key, result) in results.data.results" ng-show="key | lcpLookup : \'showInGoogle\'">\r\n                    <a target="_blank" ng-href="{{urls[key]}}" style="margin:3px;width:14em;display:inline-block">{{key | lcpLookup}}</a> ({{key | lcpLookup : "fileType"}})<br/>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div ng-if="results.data.jobStatus == \'esriJobFailed\'">\r\n        <div>\r\n            The least cost path process failed. You may be able to help provide<br/>\r\n            information to assist the resolution of this problem by reporting:\r\n			<pre>ESRI Least cost path processing failed.\r\nTime: {{results.data.timeStamp | date : \'d/M/yyyy hh:mm:ss a\'}}\r\nJob ID: {{results.data.jobId}}</pre>\r\n        </div>\r\n    </div>\r\n    <div style="clear:both;padding:5px;text-align:center"></div>\r\n</exp-modal>'),
e.put("map/leastCostPath/leastCostWeightings.html",'<div class="expWeightings">\r\n    <div class="panel-group" id="accordion">\r\n        <div class="panel panel-default" ng-repeat="category in weightings"  ng-show="category.group.length">\r\n            <div class="panel-heading">\r\n                {{category.label}}\r\n            </div>\r\n            <div id="collapseOne" class="panel-collapse collapse in">\r\n                <div class="panel-body">\r\n                    <div ng-repeat="weighting in category.group" class="lcpSlider">\r\n                        <div style="float:left">\r\n                            <input type="checkbox" ng-model="weighting.selected" class="fixAlignment" />\r\n                            <span class="leastCostPathLabel" ng-class="{disabled:!weighting.selected}">{{weighting.label}}</span>\r\n                        </div>\r\n                        <span style="width:180px;float:right;margin-right:20px" path-least-cost-slider></span>\r\n                        <div style="clear:both"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div style="padding-left:7px;padding-bottom:7px">\r\n        <label for="lcpBufferSelect">Path bounding box buffered by:</label>\r\n        <select ng-model="bufferPercent" ng-options="k as v for (k, v) in bufferValues"></select>%\r\n    </div>\r\n    <div class="buttons" style="float:right">\r\n        <button type="button" class="btn btn-default" style="width:6em;margin:2px" ng-click="cancelLeastCostPath()" title="Cancel calculation of least cost path">Cancel</button>\r\n        <button type="button" class="btn btn-default focusMe" style="width:6em;margin:2px" ng-click="showLeastCostPath($event)" title="Confirm to continue calculation of least cost path">Continue</button>\r\n    </div>\r\n    <div style="clear:both;text-align:center"><strong>Note:</strong>The processing can take a while.<br/>You will be notified when the process is complete.</div>\r\n</div>'),e.put("map/point/point.html",'<exp-modal class="pointInspector ng-cloak" icon-class="fa-map-marker" is-open="point" on-close="clearPoint()" title="Features within approx. 2km">	\r\n	<div class="pointContent" ng-controller="OverFeatureCtrl as over">\r\n		<div style="padding-bottom:7px;">Elev. {{point.z | length : true}}, Lat. {{point.y | number : 3}}&deg;, Long. {{point.x | number:3}}&deg;</div>\r\n		<div ng-show="featuresInfo.results.length > 0">\r\n			<div>\r\n				<div style="float:left; padding-bottom:10px">{{allHidden() && "Show" || "Hide"}} all features</div>\r\n				<div style="float: right">				\r\n					<a class="featureLink" href="javascript:;" title="Show all features on map"\r\n						ng-click="toggleAll()"><i class="fa" ng-class="{\'fa-eye-slash\':allHidden(), \'fa-eye\':!allHidden()}"></i></a>\r\n				</div>\r\n			</div>\r\n			<div style="clear:both;"></div>\r\n		</div>\r\n		<div ng-hide="featuresInfo.results.length > 0">No nearby features.</div>\r\n	\r\n		<div ng-repeat="item in featuresInfo.results | featureGroups" ng-class="{\'underlined\':!$last}">\r\n			<div ng-show="greaterThanOneItem()"  ng-mouseover="over.groupEnter(featuresInfo.results, item)" ng-mouseout="over.groupLeave(featuresInfo.results, item)">\r\n				<div style="float:left">\r\n					<button type="button" class="undecorated" ng-click="expanded = !expanded"><i class="fa fa-caret-right pad-right" ng-class="{\'fa-caret-down\':expanded,\'fa-caret-right\':(!expanded)}"></i></button></button><strong>{{metadata[item].heading}}</strong>\r\n				</div>\r\n				<div style="float: right">	\r\n					<a class="featureLink" href="javascript:;" title="Show on map"   \r\n						ng-click="groupShow(item)"><i class="fa" ng-class="{\'fa-eye-slash\':(!oneShowing()), \'fa-eye\':oneShowing()}"></i></a>\r\n				</div>\r\n				<div style="clear:both;"></div>\r\n			</div>\r\n			<div ng-repeat="feature in featuresInfo.results | filterGroupsByLayername : item" ng-show="expanded || !greaterThanOneItem()">\r\n				<div ng-mouseover="over.mouseenter(feature)" ng-mouseout="over.mouseleave(feature)" ng-click="over.click()">\r\n					<div style="float: left;" ng-class="{\'pad-left-big\':greaterThanOneItem()}">\r\n						<button type="button" ng-click="feature.expanded = !feature.expanded" class="undecorated"><i class="fa fa-caret-right pad-right" ng-class="{\'fa-caret-down\':feature.expanded,\'fa-caret-right\':(!feature.expanded)}"></i></button>\r\n						<a href="javascript:;" class="featureLink" title="{{metadata[feature.layerName].description}}"\r\n							ng-click="makeFeatureActive()" ng-class="{active:(feature.active)}">{{createTitle()}}</a>\r\n					</div>\r\n					<div style="float: right">	\r\n						<a class="featureLink" href="javascript:;" title="Graph elevation changes for feature\'s path."\r\n							ng-click="elevationPath(metadata[feature.layerName].label + \' elevation plot\')"><i class="fa fa-align-left fa-rotate-270" ng-show="feature.geometryType == \'esriGeometryPolyline\'"></i></a>					\r\n						<a class="featureLink" href="javascript:;" title="Show on map"\r\n							ng-click="toggleShow(feature)"><i class="fa" ng-class="{\'fa-eye-slash\':(!feature.displayed), \'fa-eye\':feature.displayed}"></i> </a>\r\n					</div>\r\n				</div>\r\n				<div style="clear:both;" ng-init="featureMeta = metadata[feature.layerName]">\r\n					<div ng-repeat="attribute in featureMeta.attributes" ng-show="feature.expanded">\r\n						<div style="width:7em;float:left;font-weight:bold;padding-left:9px">{{attribute.label}}</div>\r\n						<div style="min-width:12em;width:12em;margin-left:7.5em;" class="ellipsis" title="{{feature.attributes[attribute.key]}}">{{feature.attributes[attribute.key] | dashNull}}</div>\r\n					</div>\r\n					<div style="border-bottom:1px solid lightgray" ng-show="feature.expanded && !last"></div>\r\n				</div>\r\n			</div>	\r\n		</div>\r\n	</div>\r\n</exp-modal>')}]);