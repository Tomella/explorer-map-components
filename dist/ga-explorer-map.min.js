void 0===window.Exp&&(window.Exp={}),function(t,e){"use strict";function n(e,o){function i(t){function e(t,e){return t.x1-e.x1}window.bugger=t;for(var n,o,i=t.getLatLngs(),a=i.length-1,r=[],s=0;s<a;++s)n=i[s],o=i[s+1],n.lng<o.lng?r[s]={x1:n.lng,y1:n.lat,x2:o.lng,y2:o.lat}:r[s]={x1:o.lng,y1:o.lat,x2:n.lng,y2:n.lat};return r.sort(e)}function a(t,e,n){var o,i,a=n&&n.point,r=n&&n.tolerance,s=!1,l=t.x1-e.x1,c=t.y1-e.y1,u=t.x2-t.x1,h=t.y2-t.y1,p=e.y2-e.y1,f=e.x2-e.x1,d=p*u-f*h,g=f*c-p*l,m=u*c-h*l;if(0===d)0===g&&0===m&&(s=!0);else{var v=g/d,y=m/d;v>=0&&v<=1&&y>=0&&y<=1&&(a?(o=t.x1+v*u,i=t.y1+v*h,s=new OpenLayers.Geometry.Point(o,i)):s=!0)}if(r){var b,L,w,x,_=[t,e];if(s){if(a)t:for(w=0;w<2;++w)for(L=_[w],x=1;x<3;++x)if(o=L["x"+x],i=L["y"+x],b=Math.sqrt(Math.pow(o-s.x,2)+Math.pow(i-s.y,2)),b<r){s.x=o,s.y=i;break t}}else{var k,T,E,S;t:for(w=0;w<2;++w)for(k=_[w],T=_[(w+1)%2],x=1;x<3;++x)if(E={x:k["x"+x],y:k["y"+x]},S=OpenLayers.Geometry.distanceToSegment(E,T),S.distance<r){s=!a||new OpenLayers.Geometry.Point(E.x,E.y);break t}}}return s}var r=!1;if(e instanceof t.Polyline||e instanceof t.Polygon||e instanceof t.Marker){var s,l,c=i(o);e instanceof t.Marker?(l=e.getLatLng(),s=[{x1:l.lng,y1:l.lat,x2:l.lng,y2:l.lat}]):s=i(e);var u,h,p,f,d,g,m,v;t:for(var y=0,b=c.length;y<b;++y){u=c[y],h=u.x1,p=u.x2,f=u.y1,d=u.y2;for(var L=0,w=s.length;L<w&&(g=s[L],!(g.x1>p));++L)if(!(g.x2<h)&&(m=g.y1,v=g.y2,!(Math.min(m,v)>Math.max(f,d))&&!(Math.max(m,v)<Math.min(f,d))&&a(u,g))){r=!0;break t}}}else r=n(o,e);return r}function o(t){var e=[],n=t.getWest()+" "+t.getSouth();return e.push(n),e.push(t.getEast()+" "+t.getSouth()),e.push(t.getEast()+" "+t.getNorth()),e.push(t.getWest()+" "+t.getNorth()),e.push(n),"POLYGON(("+e.join(",")+"))"}function i(t){var e,n=0;if(t)for(e=t.length;--e>0;)n+=t[e].distanceTo(t[e-1]);return n}function a(t){var e=[];return t&&t.forEach(function(t){e.push(t.lng+" "+t.lat)}),"LINESTRING("+e.join(",")+")"}function r(t){var e=[];return t&&t.forEach(function(t){e.push([t.lng,t.lat])}),{type:"Feature",properties:{prop0:"value0"},geometry:{type:"LineString",coordinates:e}}}e.Util||(e.Util={}),e.Util.toGeoJSONFeature=r,e.Util.toLineDistance=i,e.Util.toLineStringWkt=a,e.Util.intersects=n,e.Util.boundsToWktPoly=o,e.Util.toGeoJSON=function(){function t(t){if(!t||!t.length)return 0;for(var e=0,n=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e)|0;return n}function e(t,e){return t.getElementsByTagName(e)}function n(t,e){return t.getAttribute(e)}function o(t,e){return parseFloat(n(t,e))}function i(t,n){var o=e(t,n);return o.length?o[0]:null}function a(t){return t.normalize&&t.normalize(),t}function r(t){for(var e=0,n=[];e<t.length;e++)n[e]=parseFloat(t[e]);return n}function s(t){var e={};for(var n in t)t[n]&&(e[n]=t[n]);return e}function l(t){return t&&a(t),t&&t.textContent||""}function c(t){return r(t.replace(g,"").split(","))}function u(t){for(var e=t.replace(m,"").split(v),n=[],o=0;o<e.length;o++)n.push(c(e[o]));return n}function h(t){var e,n=[o(t,"lon"),o(t,"lat")],a=i(t,"ele"),r=i(t,"gpxtpx:hr")||i(t,"hr"),s=i(t,"time");return a&&(e=parseFloat(l(a)),e&&n.push(e)),{coordinates:n,time:s?l(s):null,heartRate:r?parseFloat(l(r)):null}}function p(){return{type:"FeatureCollection",features:[]}}function f(t){return void 0!==t.xml?t.xml:d.serializeToString(t)}var d,g=/\s*/g,m=/^\s*|\s*$/g,v=/\s+/;"undefined"!=typeof XMLSerializer?d=new XMLSerializer:"object"!=typeof exports||"object"!=typeof process||process.browser||(d=new(require("xmldom").XMLSerializer));var y={kml:function(o){function a(t){var e,n;return t=t||"","#"===t.substr(0,1)&&(t=t.substr(1)),6!==t.length&&3!==t.length||(e=t),8===t.length&&(n=parseInt(t.substr(0,2),16)/255,e=t.substr(2)),[e,isNaN(n)?void 0:n]}function s(t){return r(t.split(" "))}function h(t){var n,o=e(t,"coord","gx"),i=[],a=[];for(0===o.length&&(o=e(t,"gx:coord")),n=0;n<o.length;n++)i.push(s(l(o[n])));var r=e(t,"when");for(n=0;n<r.length;n++)a.push(l(r[n]));return{coords:i,times:a}}function d(t){var n,o,a,r,s,p=[],f=[];if(i(t,"MultiGeometry"))return d(i(t,"MultiGeometry"));if(i(t,"MultiTrack"))return d(i(t,"MultiTrack"));if(i(t,"gx:MultiTrack"))return d(i(t,"gx:MultiTrack"));for(a=0;a<y.length;a++)if(o=e(t,y[a]))for(r=0;r<o.length;r++)if(n=o[r],"Point"===y[a])p.push({type:"Point",coordinates:c(l(i(n,"coordinates")))});else if("LineString"===y[a])p.push({type:"LineString",coordinates:u(l(i(n,"coordinates")))});else if("Polygon"===y[a]){var g=e(n,"LinearRing"),m=[];for(s=0;s<g.length;s++)m.push(u(l(i(g[s],"coordinates"))));p.push({type:"Polygon",coordinates:m})}else if("Track"===y[a]||"gx:Track"===y[a]){var v=h(n);p.push({type:"LineString",coordinates:v.coords}),v.times.length&&f.push(v.times)}return{geoms:p,coordTimes:f}}function g(t){var o,r=d(t),s={},c=l(i(t,"name")),u=l(i(t,"styleUrl")),h=l(i(t,"description")),p=i(t,"TimeSpan"),f=i(t,"ExtendedData"),g=i(t,"LineStyle"),m=i(t,"PolyStyle");if(!r.geoms.length)return[];if(c&&(s.name=c),u&&v[u]&&(s.styleUrl=u,s.styleHash=v[u]),h&&(s.description=h),p){var y=l(i(p,"begin")),b=l(i(p,"end"));s.timespan={begin:y,end:b}}if(g){var L=a(l(i(g,"color"))),w=L[0],x=L[1],_=parseFloat(l(i(g,"width")));w&&(s.stroke=w),isNaN(x)||(s["stroke-opacity"]=x),isNaN(_)||(s["stroke-width"]=_)}if(m){var k=a(l(i(m,"color"))),T=k[0],E=k[1],S=l(i(m,"fill")),M=l(i(m,"outline"));T&&(s.fill=T),isNaN(E)||(s["fill-opacity"]=E),S&&(s["fill-opacity"]="1"===S?1:0),M&&(s["stroke-opacity"]="1"===M?1:0)}if(f){var P=e(f,"Data"),C=e(f,"SimpleData");for(o=0;o<P.length;o++)s[P[o].getAttribute("name")]=l(i(P[o],"value"));for(o=0;o<C.length;o++)s[C[o].getAttribute("name")]=l(C[o])}r.coordTimes.length&&(s.coordTimes=1===r.coordTimes.length?r.coordTimes[0]:r.coordTimes);var D={type:"Feature",geometry:1===r.geoms.length?r.geoms[0]:{type:"GeometryCollection",geometries:r.geoms},properties:s};return n(t,"id")&&(D.id=n(t,"id")),[D]}for(var m=p(),v={},y=["Polygon","LineString","Point","Track","gx:Track"],b=e(o,"Placemark"),L=e(o,"Style"),w=0;w<L.length;w++)v["#"+n(L[w],"id")]=t(f(L[w])).toString(16);for(var x=0;x<b.length;x++)m.features=m.features.concat(g(b[x]));return m},gpx:function(t){function n(t,n){var o=e(t,n),i=[],a=[],r=[],s=o.length;if(s<2)return{};for(var l=0;l<s;l++){var c=h(o[l]);i.push(c.coordinates),c.time&&a.push(c.time),c.heartRate&&r.push(c.heartRate)}return{line:i,times:a,heartRates:r}}function o(t){for(var o,i=e(t,"trkseg"),a=[],r=[],s=[],l=0;l<i.length;l++)o=n(i[l],"trkpt"),o.line&&a.push(o.line),o.times&&o.times.length&&r.push(o.times),o.heartRates&&o.heartRates.length&&s.push(o.heartRates);if(0!==a.length){var u=c(t);return r.length&&(u.coordTimes=1===a.length?r[0]:r),s.length&&(u.heartRates=1===a.length?s[0]:s),{type:"Feature",properties:u,geometry:{type:1===a.length?"LineString":"MultiLineString",coordinates:1===a.length?a[0]:a}}}}function a(t){var e=n(t,"rtept");if(e){var o={type:"Feature",properties:c(t),geometry:{type:"LineString",coordinates:e.line}};return o}}function r(t){var e=c(t);return e.sym=l(i(t,"sym")),{type:"Feature",properties:e,geometry:{type:"Point",coordinates:h(t).coordinates}}}function c(t){var e,n=["name","desc","author","copyright","link","time","keywords"],o={};for(e=0;e<n.length;e++)o[n[e]]=l(i(t,n[e]));return s(o)}var u,f,d=e(t,"trk"),g=e(t,"rte"),m=e(t,"wpt"),v=p();for(u=0;u<d.length;u++)f=o(d[u]),f&&v.features.push(f);for(u=0;u<g.length;u++)f=a(g[u]),f&&v.features.push(f);for(u=0;u<m.length;u++)v.features.push(r(m[u]));return v}};return y}(),t.KML=t.FeatureGroup.extend({options:{async:!0},initialize:function(e,n){t.Util.setOptions(this,n),this._kml=e,this._layers={},e&&this.addKML(e,n,this.options.async)},loadXML:function(t,e,n,o){void 0===o&&(o=this.options.async),void 0===n&&(n=this.options);var i=new window.XMLHttpRequest;i.open("GET",t,o);try{i.overrideMimeType("text/xml")}catch(a){}i.onreadystatechange=function(){4==i.readyState&&200==i.status&&e(i.responseXML,n)},i.send(null)},addKML:function(t,e,n){var o=this,i=function(t,e){o._addKML(t,e)};this.loadXML(t,i,e,n)},_addKML:function(e,n){var o=t.KML.parseKML(e);if(o&&o.length){for(var i=0;i<o.length;i++)this.fire("addlayer",{layer:o[i]}),this.addLayer(o[i]);this.latLngs=t.KML.getLatLngs(e),this.fire("loaded")}},latLngs:[]}),t.Util.extend(t.KML,{parseKML:function(t){for(var e,n=this.parseStyle(t),o=t.getElementsByTagName("Folder"),i=[],a=0;a<o.length;a++)this._check_folder(o[a])&&(e=this.parseFolder(o[a],n),e&&i.push(e));o=t.getElementsByTagName("Placemark");for(var r=0;r<o.length;r++)this._check_folder(o[r])&&(e=this.parsePlacemark(o[r],t,n),e&&i.push(e));return i},_check_folder:function(t,e){for(t=t.parentElement;t&&"Folder"!==t.tagName;)t=t.parentElement;return!t||t===e},parseStyle:function(e){function n(t){for(var e={},o=0;o<t.childNodes.length;o++){var i=t.childNodes[o],r=i.tagName;if(a[r])if("hotSpot"===r)for(var s=0;s<i.attributes.length;s++)e[i.attributes[s].name]=i.attributes[s].nodeValue;else{var l=i.childNodes[0].nodeValue;"color"===r?(e.opacity=parseInt(l.substring(0,2),16)/255,e.color="#"+l.substring(2,8)):"width"===r?e.weight=l:"Icon"===r?(h=n(i),h.href&&(e.href=h.href)):"href"===r&&(e.href=l)}}return e}for(var o={},i=e.getElementsByTagName("Style"),a={color:!0,width:!0,Icon:!0,href:!0,hotSpot:!0},r=0;r<i.length;r++){var s,l=i[r],c={},u={},h={};s=l.getElementsByTagName("LineStyle"),s&&s[0]&&(c=n(s[0])),s=l.getElementsByTagName("PolyStyle"),s&&s[0]&&(u=n(s[0])),u.color&&(c.fillColor=u.color),u.opacity&&(c.fillOpacity=u.opacity),s=l.getElementsByTagName("IconStyle"),s&&s[0]&&(h=n(s[0])),h.href&&(c.icon=new t.KMLIcon({iconUrl:h.href,shadowUrl:null,iconAnchorRef:{x:h.x,y:h.y},iconAnchorType:{x:h.xunits,y:h.yunits}})),o["#"+l.getAttribute("id")]=c}return o},parseFolder:function(e,n){var o,i,a=[];o=e.getElementsByTagName("Folder");for(var r=0;r<o.length;r++)this._check_folder(o[r],e)&&(i=this.parseFolder(o[r],n),i&&a.push(i));o=e.getElementsByTagName("Placemark");for(var s=0;s<o.length;s++)this._check_folder(o[s],e)&&(i=this.parsePlacemark(o[s],e,n),i&&a.push(i));if(a.length)return 1===a.length?a[0]:new t.FeatureGroup(a)},parsePlacemark:function(e,n,o){var i,a,r,s={};for(r=e.getElementsByTagName("styleUrl"),i=0;i<r.length;i++){var l=r[i].childNodes[0].nodeValue;for(var c in o[l])s[c]=o[l][c]}var u=[],h=["LineString","Polygon","Point"];for(a in h){var p=h[a];for(r=e.getElementsByTagName(p),i=0;i<r.length;i++){var f=this["parse"+p](r[i],n,s);f&&u.push(f)}}if(u.length){var d=u[0];u.length>1&&(d=new t.FeatureGroup(u));var g,m="";for(r=e.getElementsByTagName("name"),r.length&&(g=r[0].childNodes[0].nodeValue),r=e.getElementsByTagName("description"),i=0;i<r.length;i++)for(a=0;a<r[i].childNodes.length;a++)m+=r[i].childNodes[a].nodeValue;return g&&d.bindPopup("<h2>"+g+"</h2>"+m),d}},parseCoords:function(t){var e=t.getElementsByTagName("coordinates");return this._read_coords(e[0])},parseLineString:function(e,n,o){var i=this.parseCoords(e);if(i.length)return new t.Polyline(i,o)},parsePoint:function(e,n,o){var i=e.getElementsByTagName("coordinates");if(i.length){var a=i[0].childNodes[0].nodeValue.split(",");return new t.KMLMarker(new t.LatLng(a[1],a[0]),o)}},parsePolygon:function(e,n,o){var i,a,r,s=[],l=[];for(i=e.getElementsByTagName("outerBoundaryIs"),a=0;a<i.length;a++)r=this.parseCoords(i[a]),r&&s.push(r);for(i=e.getElementsByTagName("innerBoundaryIs"),a=0;a<i.length;a++)r=this.parseCoords(i[a]),r&&l.push(r);if(s.length)return o.fillColor&&(o.fill=!0),1===s.length?new t.Polygon(s.concat(l),o):new t.MultiPolygon(s,o)},getLatLngs:function(t){for(var e=t.getElementsByTagName("coordinates"),n=[],o=0;o<e.length;o++)n=n.concat(this._read_coords(e[o]));return n},_read_coords:function(e){var n,o="",i=[];for(n=0;n<e.childNodes.length;n++)o+=e.childNodes[n].nodeValue;for(o=o.split(/[\s\n]+/),n=0;n<o.length;n++){var a=o[n].split(",");a.length<2||i.push(new t.LatLng(a[1],a[0]))}return i}}),t.KMLIcon=t.Icon.extend({createIcon:function(){var t=this._createIcon("icon");return t.onload=function(){var e=new Image;e.src=this.src,this.style.width=e.width+"px",this.style.height=e.height+"px","UNITS_FRACTION"!==this.anchorType.x&&"fraction"!==this.anchorType.x||(t.style.marginLeft=-this.anchor.x*e.width+"px"),"UNITS_FRACTION"!==this.anchorType.y&&"fraction"!==this.anchorType.x||(t.style.marginTop=-(1-this.anchor.y)*e.height+"px"),this.style.display=""},t},_setIconStyles:function(e,n){t.Icon.prototype._setIconStyles.apply(this,[e,n]),e.anchor=this.options.iconAnchorRef,e.anchorType=this.options.iconAnchorType}}),t.KMLMarker=t.Marker.extend({options:{icon:new t.KMLIcon.Default}})}(L,Exp),function(t){"use strict";t.module("geo.baselayer.control",["geo.maphelper","geo.map"]).directive("geoBaselayerControl",["$rootScope","mapHelper","mapService",function(t,e,n){var o={maxZoom:12};return{template:'<input type="range" min="0" max="1" step="0.1" style="background: transparent" title="Topographic layer transparency"ng-model="slider.opacity" updateevent="slideStop" class="base-layer-input"></input>',scope:{maxZoom:"=?12"},link:function(t,i){"undefined"==typeof t.maxZoom&&(t.maxZoom=o.maxZoom),t.slider={opacity:1,visibility:!0,lastOpacity:1},e.getPseudoBaseLayer().then(function(e){t.layer=e,t.slider.opacity=e.options.opacity,t.$watch("slider.opacity",function(e,n){t.layer.setOpacity(e)})}),n.getMap().then(function(e){function n(){var n=e.getZoom();t.lastZoom<t.maxZoom&&(t.lastOpacity=t.layer.options.opacity),n===t.maxZoom?(t.lastZoom>t.maxZoom?t.lastOpacity<.5?(t.slider.opacity=t.lastOpacity,t.layer.setOpacity(t.lastOpacity)):(t.slider.opacity=.5,t.layer.setOpacity(.5)):t.slider.opacity>.5&&(t.slider.opacity=.5,t.layer.setOpacity(.5)),t.slider.visibility=!1,o(!1)):n<t.maxZoom?(t.lastZoom<=t.maxZoom&&(t.slider.opacity=t.lastOpacity,t.layer.setOpacity(t.lastOpacity)),o(!0)):n>t.maxZoom&&t.lastZoom<=t.maxZoom&&(t.slider.visibility=!1,t.slider.opacity=0,o(!1)),t.lastZoom=n}function o(t){$(i).find("input")[0].disabled=!t&&"disabled"}e.on("zoomend",n)})}}}]).run(["$rootScope","mapService","flashService",function(t,e,n){var o;e.getMap().then(function(e){e.oldZoomTo=e.zoomTo,e.zoomTo=function(i){this.layers.forEach(function(a){if(a.pseudoBaseLayer&&a.visibility){var r=e.zoom,s=.4,l=a.numZoomLevels,c=i>l-2,u=i<l-1,h=i===l-2,p=r<l-1,f=r===l-2,d=i>r,g=i<r;d?l<=i+1&&!o&&(o=!0,n.add("No detail available at this scale for "+a.name,3e3),t.$broadcast("overlay.has.detail",!1)):o=!1,u&&t.$broadcast("overlay.has.detail",!0),d&&p&&(!h&&!c||f||(a.restoreOpacity=a.opacity),a.opacity>=s&&h&&a.setOpacity(s)),c&&a.opacity&&a.setOpacity(0),g&&u&&(h?a.opacity||a.setOpacity(a.restoreOpacity<s?a.restoreOpacity:s):a.restoreOpacity&&(a.setOpacity(a.restoreOpacity),a.restoreOpacity=null))}}),this.oldZoomTo(i)}})}])}(angular),function(t,e){"use strict";t.module("explorer.crosshair",["geo.map"]).factory("crosshairService",["mapService",function(t){var n,o;return t.getMap().then(function(t){n=t}),{add:function(t){this.move(t)},remove:function(){o&&(n.removeLayer(o),o=null)},move:function(t){var i;if(t)return this.remove(),i=e.icon({iconUrl:"resources/img/cursor-crosshair.png",iconAnchor:[16,16]}),o=e.marker([t.y,t.x],{icon:i}),o.addTo(n),t}}}])}(angular,L),function(t){"use strict";t.module("geo.draw",["geo.map"]).directive("geoDraw",["$log","$rootScope","drawService",function(e,n,o){var i={rectangleEvent:"geo.draw.rectangle.created",lineEvent:"geo.draw.line.created"};return{restrict:"AE",scope:{data:"=",rectangleEvent:"@",lineEvent:"@"},link:function(e,n,a,r){t.forEach(i,function(t,n){e[n]||(e[n]=t)}),o.createControl(e)}}}]).factory("drawService",["$q","$rootScope","mapService",function(e,n,o){var i,a,r,s;return{createControl:function(a){return i&&e.when(i),o.getMap().then(function(e){var o=new L.FeatureGroup,l={edit:{featureGroup:o}};return a.data&&t.extend(l,a.data),r=a.drawnItems=o,e.addLayer(o),i=new L.Control.Draw(l),e.addControl(i),e.on("draw:created",function(t){({polyline:function(){var e={length:t.layer.getLength(),geometry:t.layer.getLatLngs()};n.$broadcast(a.lineEvent,e)},rectangle:function(){var e={bounds:t.layer.getBounds()};s.resolve(e),s=null,n.$broadcast(a.rectangleEvent,e)}})[t.layerType]()}),i})},cancelDrawRectangle:function(){s&&(s.reject(),s=null,a&&a.disable())},drawRectangle:function(){return this.cancelDrawRectangle(),s=e.defer(),a?a.enable():o.getMap().then(function(t){a=new L.Draw.Rectangle(t,i.options.polyline),a.enable()}),s.promise}}}])}(angular),function(t,e){"use strict";t.module("geo.drawhelper",["geo.map"]).factory("drawHelperService",["$q","$rootScope","mapService",function(t,n,o){function i(t){n.$broadcast("drawhelper.active",t)}var a,r,s,l,c={};return c.getDrawHelper=function(){if(r)return t.when(c);var n=t.defer();return o.getMap().then(function(t){function o(t){if(a.callback){var e=a._layer;e?{polygon:function(){a.callback(e.getLatLngs())},polyline:function(){a.callback({length:e.getLength(),positions:e.getLatLngs()})},rectangle:function(){a.callback(e.getBounds())}}[a._layerType]():a.callback(null)}}function u(t){o(t),i(!1)}var h={color:"#000099",opacity:.4};r=new e.Draw.Polygon(t,h),s=new e.Draw.Polyline(t,h),l=new e.Draw.Rectangle(t,h),t.on("draw:created",function(e){return a._layer=e.layer,a.editable?(o(e),t.addLayer(a._layer),e.layer.options.editing=h,void e.layer.editing.enable()):u(e)}),t.on("draw:deleted",u),t.on("draw:edited",u),t.on("draw:editresized",o),t.on("draw:editvertex",o),n.resolve(c)}),n.promise},c.drawPolyline=function(t){i(!0),a=t,a._layerType="polyline",s.enable()},c.drawPolygon=function(t){i(!0),a=t,a._layerType="polygon",r.enable()},c.drawExtent=function(t){i(!0),a=t,a._layerType="rectangle",l.enable()},c.stopDrawing=function(){if(a&&a._layer){var t=a._layer;o.getMap().then(function(e){e.removeLayer(t)})}a=void 0,r.disable(),s.disable(),l.disable(),i(!1)},c}])}(angular,L),function(t,e,n){"use strict";t.module("geo.elevation",["graph","explorer.crosshair","explorer.flasher","explorer.feature.summary","geo.map","geo.path"]).directive("pathElevationPlot",["$log","$timeout","$rootScope","$filter","elevationService","crosshairService","featureSummaryService",function(t,e,n,o,i,a,r){var s={fill:"orange",fillOpacity:.4,stroke:"darkred",strokeWidth:1.5},l={fill:"lightblue",fillOpacity:.8,stroke:"darkblue",strokeWidth:1.5},c='<span><img alt="Waiting..." src="resources/img/tinyloader.gif" ng-show="message.spinner" style="position:relative;top:2px;" width="12"></img></span>';return{templateUrl:"map/elevation/elevation.html",scope:!0,controller:["$scope",function(t){t.paths=[],t.config={yLabel:"Elevation (m)",xLabel:"Distance: 3000m"},n.$on("elevation.plot.data",function(e,n){t.length=n.length,t.geometry=n.geometry,t.config.xLabel="Distance: "+o("length")(n.length,!0),t.waterTable=null,t.length&&t.geometry&&(i.getElevation(t.geometry,t.length).then(function(e){t.elevation={style:s,data:e},t.config.leftText="Elevation Range: "+o("length")(d3.min(e,function(t){return t.z}),!0)+" to "+o("length")(d3.max(e,function(t){return t.z}),!0),t.paths=[t.elevation]}),i.intersectsWaterTable(t.geometry).then(function(e){t.intersectsWaterTable=e}))}),t.getInfoText=function(){t.infoText||(t.infoText=c,i.getInfoText().then(function(e){t.infoText=e}))},t.toggleWaterTable=function(){var n=t.paths.length;t.paths=[],t.waterTable?e(function(){1==n?t.paths=[t.elevation,t.waterTable]:t.paths=[t.elevation]}):i.getWaterTable(t.geometry,t.length).then(function(e){t.waterTable={style:l,data:e},t.paths=[t.elevation,t.waterTable]})},t.close=function(){t.paths=t.geometry=t.length=null}}],link:function(e,n){function o(){e.line&&(e.line=i.pathHide(e.line)),e.geometry?e.line=i.pathShow(e.geometry):i.hideWaterTable()}function s(){t.info("Deferred view"),r.deferView(e.position).then(function(t){e.featuresUnderPoint=t})}function l(){t.info("Cancel deferred view"),r.cancelView(),e.featuresUnderPoint=null}e.graphClick=function(t){if(t.position){var n=t.position.points[0].point;i.panToPoint(n),e.point=n}},e.graphLeave=function(n){e.position=null,a.remove(),l(),t.debug("Mouse left"),e.mapListener&&(t.info("offMapMove"),r.offMapMove(e.mapListener))},e.graphEnter=function(e){t.debug("Graph be entered")},e.graphMove=function(n){var o;e.position=n.position,e.position&&(o=e.position.point,window.eve=n,e.position.markerLonlat=a.move(o),s()),e.mapListener||(e.mapListener=function(){l(),s()},t.info("onMapMove"),r.onMapMove(e.mapListener)),t.debug("Mouse moving...")},e.$watch("geometry",o)}}}]).directive("marsPanTo",["$rootScope","mapService",function(e,o){var i={eventName:"elevation.plot.data",options:{paddingTopLeft:[50,50],paddingBottomRight:[50,250]}};return{restrict:"AE",scope:{eventName:"=",options:"="},link:function(a){t.forEach(i,function(t,e){"undefined"==typeof a[e]&&(a[e]=t)}),e.$on(a.eventName,function(t,e){var i=n.polyline(e.geometry),r=i.getBounds();o.getMap().then(function(t){t.fitBounds(r,a.options)})})}}}]).directive("marsInfoElevation",["$log","elevationService",function(t,e){return{templateUrl:"map/elevation/elevationInfo.html",scope:!0,link:function(t,n){t.toggleWaterTableShowing=function(){t.state=e.getState(),e.isWaterTableShowing()?e.hideWaterTable():e.showWaterTable()}}}}]).provider("elevationService",function(){var t,o=500,i="service/path/elevation",a="service/path/waterTable",r="service/artesianBasin/geometry/kml",s="service/artesianBasin/intersects",l=null,c={isWaterTableShowing:!1};this.setIntersectUrl=function(t){s=t},this.setKmlUrl=function(t){r=t},this.setElevationUrl=function(t){i=t},this.setWaterTableUrl=function(t){a=t},this.$get=["$log","httpData","$q","mapService","flashService",function(u,h,p,f,d){f.getMap().then(function(e){t=e});var g={panToPoint:function(t){f.zoomTo(t.y,t.x)},getState:function(){return c},getElevation:function(t,n){var a=d.add("Retrieving elevation details...",8e3),r=e.Util.toLineStringWkt(t);return h.post(i,{wkt:r,count:o,distance:n}).then(function(t){return d.remove(a),t.data})},intersectsWaterTable:function(t){var n=s+(s.indexOf("?")>-1?"":"?wkt=");return h.get(n+e.Util.toLineStringWkt(t),{cache:!0}).then(function(t){return t.data.intersects})},isWaterTableShowing:function(){return c.isWaterTableShowing=null!==l},showWaterTable:function(){l||this.getWaterTableLayer().then(function(e){e.addTo(t)}),c.isWaterTableShowing=!0},hideWaterTable:function(){l&&t.removeLayer(l),l=null,c.isWaterTableShowing=!1},createWaterTableLayer:function(){return f.getMap().then(function(t){var e=new n.KML(h.fixUrl(r),{async:!0});return e.on("loaded",function(t){return l=t.target})})},getWaterTableLayer:function(){return this.createWaterTableLayer()},getWaterTable:function(t,n){var i=d.add("Retrieving water table details...",8e3),r=e.Util.toLineStringWkt(t);return h.post(a,{wkt:r,count:o,distance:n}).then(function(t){return d.remove(i),t.data})},getInfoText:function(){return h.get("map/elevation/elevationInfo.html",{cache:!0}).then(function(t){return t.data})},pathShow:function(e){var o=n.polyline(e,{color:"red",weight:3,opacity:.8}).addTo(t);return o},pathHide:function(e){return t.removeLayer(e),null}};return g}]})}(angular,Exp,L),function(t,e){"use strict";t.module("geo.extent",[]).directive("geoExtent",["$log",function(t){var n={center:[-28,135],zoom:5};return{require:"^geoMap",restrict:"AE",scope:{options:"="},link:function(t,o,i,a){"undefined"==typeof t.options&&(t.options={}),"undefined"==typeof t.options.center&&(t.options.center=n.center),"undefined"==typeof t.options.zoom&&(t.options.zoom=n.zoom),a.getMap().then(function(n){e.control.zoommin(t.options).addTo(n)})}}}])}(angular,L),function(t,e){"use strict";t.module("explorer.feature.summary",["geo.map"]).directive("featureSummaryToggle",["mapHelper",function(t){return{template:'<i class="fa fa-location-arrow fa-rotate-180"></i>',link:function(e){e.$watch("unlinked",function(e){t.fireEvent(e.featureSummary?"featuresactivate":"featuresdeactivate")},!0)}}}]).directive("featureGridToggle",["mapHelper",function(t){return{template:'<i class="fa fa-th"></i>',link:function(e){e.$watch("unlinked",function(e){t.showGrid(e.featureGrid)},!0)}}}]).directive("expPointFeatures",["featureSummaryService",function(t){return{scope:{features:"="},link:function(e,n){e.$watch("features",function(n,o){e.features?t.showPopup(e.features):o&&t.hidePopup()})}}}]).directive("featuresUnderPoint",["$timeout","featureSummaryService","mapService",function(t,e,n){var o=400;return{restrict:"AE",scope:!0,template:'<div exp-point-features features="featuresUnderPoint" class="featuresUnderPoint"></div>',link:function(i,a){n.getMap().then(function(n){function i(t){n.on("mousemove",l),n.on("mouseout",s)}function r(t){s(),n.off("mousemove",l),n.off("mouseout",s)}function s(){t.cancel(c),e.hidePopup()}function l(n){s(),c=t(function(){var t={markerLonLat:n.latlng,point:{x:n.latlng.lng,y:n.latlng.lat}};e.getAndShowFeatures(t)},o)}var c;void 0===a.attr("no-control")&&n.addControl(L.control.features()),n.on("featuresactivate",i),n.on("featuresdeactivate",r)})}}}]).factory("featureSummaryService",["$log","configService","mapService","$timeout","$rootScope","$q","httpData",function(e,n,o,i,a,r,s){var l,c,u="service/path/featureCount";return o.getMap().then(function(t){l=t}),{getAndShowFeatures:function(t){this.view(t).then(function(t){this.showPopup(t)}.bind(this))},showPopup:function(e){var n=e.position.point;o.getMap().then(function(o){var i=[];t.forEach(e.data,function(t,e){i.push(e+" ("+t+")")}),L.popup().setLatLng([n.y,n.x]).setContent(i.length?i.join("<br />"):"No nearby features").openOn(o)})},hidePopup:function(){o.getMap().then(function(t){t.closePopup()})},view:function(e){var n=r.defer();return c=null,e.point&&this.featuresUnderPoint(e.point).then(function(o){var i=0;t.forEach(o,function(t){i+=t}),n.resolve({data:o,position:e,count:i})}),n.promise},deferView:function(t){var e=this,n=r.defer();return this.cancelView(),c=i(function(){e.view(t).then(function(t){n.resolve(t)})}.bind(this),200),n.promise},cancelView:function(){c&&i.cancel(c)},clearView:function(){},onMapMove:function(t){return e.debug("Adding event handler"),l.on("moveend",l,t),t},offMapMove:function(t){e.debug("Removing event handler"),l.off("moveend",l,t)},positionFromLonlat:function(t){var e=t.lat?t.lat:t.y,n=t.lon?t.lon:t.x,o=[e,n],i=l.project(o);return console.log([o,i]),i},getViewPort:function(){return l._container.getBoundingClientRect()},featuresUnderPoint:function(t){var e=r.defer(),o=l._container.getBoundingClientRect(),i=window.devicePixelRatio?window.devicePixelRatio:1,a=l.getBounds();return n.getConfig("clientSessionId").then(function(n){s.post(u,{clientSessionId:n,x:t.x,y:t.y,width:o.width/i,height:o.height/i,extent:{left:a.left,right:a.right,top:a.top,bottom:a.bottom}}).then(function(t){e.resolve(t.data)})}),e.promise}}}])}(angular,window),function(t,e,n){"use strict";t.module("geo.geosearch",["ngAutocomplete"]).directive("expSearch",[function(){return{templateUrl:"components/geosearch/search.html",scope:{hideTo:"="},link:function(t,e){e.addClass("")}}}]).directive("geoSearch",["$log","$q","googleService","mapHelper",function(t,e,n,o){return{controller:["$scope",function(i){i.values={from:{},to:{}},i.zoom=function(a){var r,s=[];i.values.from.description&&(r=n.getAddressDetails(i.values.from.description,i).then(function(e){t.debug("Received the results for from"),i.values.from.results=e,i.item=""},function(e){t.debug("Failed to complete the from lookup.")}),s.push(r)),i.values.to&&i.values.to.description&&(r=n.getAddressDetails(i.values.to.description,i).then(function(e){t.debug("Received the results for to"),i.values.to.results=e},function(e){t.debug("Failed to complete the to lookup.")}),s.push(r)),s.length>0&&e.all(s).then(function(){var e=[];i.values.from&&i.values.from.results&&e.push(i.values.from.results),i.values.to&&i.values.to.results&&e.push(i.values.to.results),o.zoomToMarkPoints(e,a),1==s.length,t.debug("Updating the map with what we have")}),t.debug("Zooming to map soon.")}}]}}]).factory("googleService",["$log","$q",function(t,n){var o,i=new e.maps.Geocoder;try{o=new e.maps.places.AutocompleteService(null,{types:["geocode"]})}catch(a){t.debug("Catching google error that manifests itself when debugging in Firefox only")}return{getAddressDetails:function(t,o){var a=n.defer();return i.geocode({address:t,region:"au"},function(t,n){n!=e.maps.GeocoderStatus.OK?o.$apply(function(){a.reject("Failed to find address")}):o.$apply(function(){a.resolve({lat:t[0].geometry.location.lat(),lon:t[0].geometry.location.lng(),address:t[0].formatted_address})})}),a.promise}}}])}(angular,google,window),function(t,e){"use strict";t.module("explorer.layers",["geo.map"]).factory("layerService",["mapService","$log","$q",function(n,o,i){var a=null,r=["addToMap","removeFromMap","handleShow","init","destroy","moveUp","moveDown"],s={},l=0,c={WMS:{addToMap:function(){return this.layer=e.tileLayer.wms(this.wmsUrl,{layers:this.layers,format:"image/png",transparent:!0}),i.when(this.layer)},removeFromMap:function(){this.layer.map&&this.map.removeLayer(this.layer)},handleShow:function(){return this.layer._map?(this.map.removeLayer(this.layer),!1):(this.layer.addTo(this.map),!0)},moveUp:function(){var t,e,n=this.map.layers,o=0,i=this.map.getLayerIndex(this.layer);for(t=0;t<n.length;t++)if(e=n[t],!e.isBaseLayer&&!e.pseudoBaseLayer){o=t;break}return i>o&&(a.raiseLayer(this.layer,-1),!0)},moveDown:function(){var t=a.getLayerIndex(this.layer),e=a.layers.length;return t<e-1&&(a.raiseLayer(this.layer,1),!0)},init:function(){return this.addToMap()},destroy:function(){this.removeFromMap()}}},u={WMS:function(t){this.legend=this.legendUrl,this.thumbUrl||(this.thumbUrl=window.location.protocol+"//"+window.location.host+window.location.pathname.substr(0,window.location.pathname.substr(1).indexOf("/")+2)+"service/thumb/wms?wmsService="+encodeURIComponent(this.url)+"&layers="+encodeURIComponent(this.layers))},Tile:function(t){this.legend=this.legendUrl},Vector:function(t){}};return window.typeProtos=c,c.Tile=Object.create(c.WMS),c.Tile.addToMap=function(){return this.layer||(this.layer=e.tileLayer(this.tilecacheUrl,{format:"image/png",transparent:!0})),i.when(this.layer)},c.Vector=Object.create(c.WMS),c.Vector.addToMap=function(){},{decorate:function(e){var n,o;return e.assetId||(e.assetId="bogus_"+l++),s[e.assetId]?e:(this._createMapFeature(e),e.isWrapped=!0,n=e.type,o=c[n],o&&t.forEach(r,function(t){e[t]=o[t]}),e)},_createMapFeature:function(t){var e;"Vector"==t.type&&o.debug("Handling a vector service"),e=u[t.type],e&&(u[t.type].call(t),s[t.assetId]=t)}}}])}(angular,L),function(t){"use strict";t.module("explorer.layer.inpector",["explorer.layers"]).directive("layerInspector",["$rootScope","layerService",function(t,e){return{restrict:"AE",scope:{click:"&",showClose:"=?",active:"=",name:"=?"},controller:["$scope",function(t){t.toggleShow=function(){var t=this.active;t.isWrapped||(t=e.decorate(t),t.init(),t.show=!0,t.showExtra=!0),t.displayed=t.handleShow()}}],templateUrl:"map/layerinspector/layerInspector.html"}}])}(angular),function(t){"use strict";t.module("explorer.layer.slider",[]).directive("explorerLayerSlider",[function(){return{template:'<slider min="0" ng-show="layer" max="1" step="0.1" updateevent="slideStop" ng-model="slider.opacity" ng-disabled="!slider.visibility" ui-tooltip="hide"></slider>',scope:{layer:"=?"},link:function(t,e,n){t.slider={visibility:!0},t.$watch("slider.opacity",function(e,n){t.layer&&t.layer.setOpacity(e)}),t.$watch("layer.options.opacity",function(e,n){"undefined"!=typeof e&&"undefined"!=typeof n?t.slider.opacity=e:t.layer&&"undefined"==typeof n&&("undefined"==typeof t.slider.opacity?t.slider.opacity=t.layer.options.opacity:t.layer.setOpacity(t.slider.opacity))})}}}])}(angular),function(t,e,n){"use strict";t.module("geo.maphelper",["geo.map"]).factory("mapHelper",["mapService","$timeout","$q","$rootScope","flashService",function(t,e,n,o,i){var a,r=[[-47,107],[-9,156]];t.getMap().then(function(e){a=t.getGridLayer(),r=e.getBounds()});var s={timeoutPeriod:200,timeout:null,callbacks:{},checkMarkers:function(){},zoomToMarkPoints:function(e,n){t.getMap().then(function(t){t.setView(e[0],12,{animate:!0})})},zoomToLonLats:function(t){},
zoomToBounds:function(e){t.getMap().then(function(t){t.fitBounds(e,{animate:!0})})},takeMeHomeCountryRoads:function(){t.getMap().then(function(t){t.fitBounds(r,{animate:!0})})},zoomOut:function(e){t.getMap().then(function(t){t.zoomOut(e)})},addLayer:function(e){t.getMap().then(function(t){t.addLayer(e)})},addLayers:function(e){t.getMap().then(function(t){e.forEach(function(e){t.addLayer(e)})})},removeLayer:function(e){t.getMap().then(function(t){t.removeLayer(e)})},fireEvent:function(e,n){t.getMap().then(function(t){t.fireEvent(e,n)})},showGrid:function(e){a&&t.getMap().then(function(t){e?a.addTo(t):t.removeLayer(a)})},markPoint:function(t){},getPseudoBaseLayer:function(){return t.getMap().then(function(t){var e=null;return t.eachLayer(function(t){t.pseudoBaseLayer&&(e=t)}),e})},subscribe:function(t,e){this.callbacks[t]||(this.callbacks[t]={subscribers:[]}),this.callbacks[t].subscribers.push(e)},pubChangeBaseLayerBias:function(t){},getExtentWkt:function(){return t.getMap().then(function(t){return Exp.Util.boundsToWktPoly(t.getBounds())})},decorateWfsLayer:function(t){}};return t.getMap().then(function(t){t.on("moveend",function(t){e.cancel(s.timeout),s.timeout=e(function(){s.getExtentWkt().then(function(t){o.$broadcast("extentOfInterestChanged",t)})},s.timoutPeriod)})}),s}])}(angular,window,L),function(t){"use strict";t.module("explorer.mapstate",[]).factory("mapStateService",["$log","mapService","persistService",function(t,e,n){var o=24e11;return{persist:function(){var t=Date.now();o-100>t&&n.setItem("marsMapTab",e.getState()),o=t},restore:function(){n.getItem("marsMapTab").then(function(t){t&&e.setState(t)})}}}])}(angular),function(t){"use strict";t.module("geo.measure",[]).directive("geoMeasure",["$log",function(t){return{require:"^geoMap",restrict:"AE",link:function(e,n,o,i){i.getMap().then(function(e){L.Control.measureControl().addTo(e),e.on("draw:drawstop",function(e){t.info("Draw stopped"),t.info(e)})})}}}])}(angular),function(t,e){"use strict";t.module("geo.path",["geo.map","explorer.config","explorer.flasher","explorer.message"]).directive("geoPath",["mapService","pathService","$rootScope","flashService","messageService","configService","$timeout","$q",function(t,n,o,i,a,r,s,l){var c,u="distance";return{controller:["$scope",function(t){t.name="PATH"}],link:function(o,a,r){function s(){t.getMap().then(function(t){t.removeLayer(c)})}o.distanceMeasure={distance:"-"},o.showElevation=function(){var e=(c.getLatLngs(),t.getDistanceGeometry()),i=e.clone().transform(EPSG3857,EPSG4326).getGeodesicLength();o.disable(),n.triggerElevationPlot({length:i,geometry:e})},o.disable=function(){o.item="",s()},o.$watch("item",function(n,o){n==u?(i.add("Click on map to start a path or add next point. Double click to end path.",4e3),t.getMap().then(function(t){c=e.Polyline.Plotter([],{weight:4}),c.addTo(t)})):o==u&&s()})}}}]).factory("pathService",["$rootScope",function(t){return{triggerElevationPlot:function(e){t.$broadcast("elevation.plot.data",e)}}}]).filter("length",["$filter",function(t){var e={units:"m",threshold:1e5,aboveThresholdUnits:"km",divideBy:1e3};return function(n,o){var i,a;return n||0===n?(e.threshold&&n>e.threshold?(n/=e.divideBy,i=e.aboveThresholdUnits):i=e.units,a=t("number")(n,0)+" "+i,o?a:"("+a+")"):null}}])}(angular,L),function(){"use strict";function t(t){throw"L.Pather: "+t+"."}"undefined"==typeof L&&t("Leaflet.js is required: http://leafletjs.com/");var e={VIEW:1,CREATE:2,EDIT:4,DELETE:8,APPEND:16,EDIT_APPEND:20,ALL:31};L.Pather=L.FeatureGroup.extend({initialize:function(t){this.options=Object.assign(this.defaultOptions(),t||{}),this.creating=!1,this.polylines=[]},createPath:function(t){if(t.length<=1)return!1;this.clearAll();var e=new L.Pather.Polyline(this.map,t,this.options,{fire:this.fire.bind(this),mode:this.getMode.bind(this),remove:this.removePath.bind(this)});return this.polylines.push(e),this.fire("created",{polyline:e,latLngs:e.getLatLngs()}),e},removePath:function(t){if(t instanceof L.Pather.Polyline){var e=this.polylines.indexOf(t);return this.polylines.splice(e,1),t.remove(),this.fire("deleted",{polyline:t,latLngs:[]}),!0}return!1},getPaths:function(){return this.polylines},onAdd:function(t){var e=this.element=this.options.element||t._container;this.draggingState=t.dragging._enabled,this.map=t,this.fromPoint={x:0,y:0},this.svg=d3.select(e).append("svg").attr("pointer-events","none").attr("class",this.getOption("moduleClass")).attr("width",this.getOption("width")).attr("height",this.getOption("height")),t.dragging.disable(),this.attachEvents(t),this.setMode(this.options.mode)},attachEvents:function(t){var n=function(){return this.polylines.filter(function(t){return t.manipulating})}.bind(this),o=function(){return!!(this.options.mode&e.CREATE)}.bind(this);t.on("mousedown",function(e){o()&&0===n().length&&(this.creating=!0,this.fromPoint=t.latLngToContainerPoint(e.latlng),this.latLngs=[])}.bind(this)),t.on("mouseup",function(){return 0===n().length?(this.creating=!1,this.createPath(this.convertPointsToLatLngs(this.latLngs)),void(this.latLngs=[])):(n()[0].attachElbows(),n()[0].finished(),void(n()[0].manipulating=!1))}.bind(this)),t.on("mousemove",function(e){if(n().length>0)return void n()[0].moveTo(e.layerPoint);var o=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear");if(this.creating){var i=t.mouseEventToContainerPoint(e.originalEvent),a=[this.fromPoint,new L.Point(i.x,i.y,(!1))];this.latLngs.push(i),this.svg.append("path").classed(this.getOption("lineClass"),!0).attr("d",o(a)).attr("stroke",this.getOption("strokeColour")).attr("stroke-width",this.getOption("strokeWidth")).attr("fill","none"),this.fromPoint={x:i.x,y:i.y}}}.bind(this))},convertPointsToLatLngs:function(t){return t.map(function(t){return this.map.containerPointToLatLng(t)}.bind(this))},clearAll:function(){this.svg.text("")},getOption:function(t){return this.options[t]||this.defaultOptions()[t]},defaultOptions:function(){return{moduleClass:"pather",lineClass:"drawing-line",elbowClass:"elbow",strokeColour:"rgba(0,0,0,.5)",strokeWidth:2,width:"100%",height:"100%",smoothFactor:10,pathColour:"black",pathOpacity:.55,pathWidth:3,mode:e.ALL}},setSmoothFactor:function(t){this.options.smoothFactor=parseInt(t)},setMode:function(t){if(this.setClassName(t),this.options.mode=t,this.options.mode&e.CREATE){var n=this.draggingState?"disable":"enable";return void this.map.dragging[n]()}this.map.dragging.enable()},setClassName:function(t){var n=function(n){var o=["mode",n].join("-");return e[n.toUpperCase()]&t?void this.element.classList.add(o):void this.element.classList.remove(o)}.bind(this);n("create"),n("delete"),n("edit"),n("append")},getMode:function(){return this.options.mode}}),L.Pather.MODE=e,L.pather=function(t){return new L.Pather(t)}}(),function(){"use strict";Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(t,e){if(void 0===t||null===t)throw new TypeError("Cannot convert first argument to object");for(var n=Object(t),o=1;o<arguments.length;o++){var i=arguments[o];if(void 0!==i&&null!==i){i=Object(i);for(var a=Object.keys(Object(i)),r=0,s=a.length;r<s;r++){var l=a[r],c=Object.getOwnPropertyDescriptor(i,l);void 0!==c&&c.enumerable&&(n[l]=i[l])}}}return n}})}(),function(){"use strict";var t="_pather";L.Pather.Polyline=function(t,e,n,o){this.options={color:n.pathColour,opacity:n.pathOpacity,weight:n.pathWidth,smoothFactor:n.smoothFactor||1,elbowClass:n.elbowClass},this.polyline=new L.Polyline(e,this.options).addTo(t),this.map=t,this.methods=o,this.edges=[],this.manipulating=!1,this.attachPolylineEvents(this.polyline),this.select()},L.Pather.Polyline.prototype={select:function(){this.attachElbows()},deselect:function(){this.manipulating=!1},attachElbows:function(){this.detachElbows(),this.polyline._parts[0].forEach(function(e){var n=new L.DivIcon({className:this.options.elbowClass}),o=this.map.layerPointToLatLng(e),i=new L.Marker(o,{icon:n}).addTo(this.map);i[t]={point:e},this.attachElbowEvents(i),this.edges.push(i)}.bind(this))},detachElbows:function(){this.edges.forEach(function(t){this.map.removeLayer(t)}.bind(this)),this.edges.length=0},attachPolylineEvents:function(t){t.on("click",function(t){if(t.originalEvent.stopPropagation(),t.originalEvent.preventDefault(),this.methods.mode()&L.Pather.MODE.APPEND){var e=this.map.mouseEventToLatLng(t.originalEvent);this.insertElbow(e)}else this.methods.mode()&L.Pather.MODE.DELETE&&this.methods.remove(this)}.bind(this))},attachElbowEvents:function(t){t.on("mousedown",function(e){this.methods.mode()&L.Pather.MODE.EDIT&&(e.originalEvent.stopPropagation(),e.originalEvent.preventDefault(),this.manipulating=t)}.bind(this)),t.on("mouseup",function(t){t.originalEvent.stopPropagation(),t.originalEvent.preventDefault(),this.manipulating=!1})},insertElbow:function(t){var e=this.map.latLngToLayerPoint(t),n=1/0,o=-1,i=this.polyline._parts[0];i.forEach(function(t,a){var r=i[a+1]||i[0],s=L.LineUtil.pointToSegmentDistance(e,t,r);s<n&&(n=s,o=a)}.bind(this)),i.splice(o+1,0,e);var a=i.map(function(t){var e=this.map.layerPointToLatLng(t);return{_latlng:e}}.bind(this));this.redraw(a),this.attachElbows()},moveTo:function(t){var e=this.map.layerPointToLatLng(t);this.manipulating.setLatLng(e),this.redraw(this.edges)},finished:function(){this.methods.fire("edited",{polyline:this,latLngs:this.getLatLngs()})},redraw:function(t){var e=[],n={};t.forEach(function(t){e.push(t._latlng)}),Object.keys(this.options).forEach(function(t){n[t]=this.options[t]}.bind(this)),n.smoothFactor=0,this.remove(!1),this.polyline=new L.Polyline(e,n).addTo(this.map),this.attachPolylineEvents(this.polyline)},remove:function(t){t="undefined"==typeof t||t,this.map.removeLayer(this.polyline),t&&this.edges.forEach(function(t){this.map.removeLayer(t)}.bind(this))},latLngsToEdges:function(t){return t.map(function(t){return{_latlng:t}})},getLatLngs:function(){return this.polyline._parts[0].map(function(t){return this.map.containerPointToLatLng(t)}.bind(this))}}}(),function(t,e,n){"use strict";t.module("explorer.point",["geo.map","explorer.flasher"]).directive("expPoint",["pointService",function(t){return{scope:{data:"=point"},controller:["$scope",function(e){e.$watch("data",function(n,o){(n||o)&&t.showPoint(e.data)})}]}}]).directive("expClickMapPoint",["pointService",function(t){return{template:'<div style="position:relative;overflow:hidden"><i style="position:relative;display:inline-block;right:-3px;top:-3px" class="fa fa-location-arrow fa-rotate-180"></i><i style="position:absolute;display:inline-block;right:4px;top:7px" class="fa fa-location-arrow fa-rotate-180"></i></div>',restrict:"AE",scope:{},link:function(e,n){t.addMapListener(function(e){t.showPoint(e)},this)}}}]).directive("expClickModalMapPoint",["pointService","$rootScope",function(t,e){return{template:'<div style="position:relative;overflow:hidden"><i style="position:relative;display:inline-block;right:-3px;top:-3px" class="fa fa-location-arrow fa-rotate-180"></i><i style="position:absolute;display:inline-block;right:4px;top:7px" class="fa fa-location-arrow fa-rotate-180"></i></div>',restrict:"A",link:function(n){var o=!1,i=!1;e.$on("drawhelper.active",function(e,n){o&&!i&&t.showPoint(null),i=n}),t.addMapListener(function(e){t.showPoint(o&&!i&&e)},this),n.$watch("unlinked",function(e){o&&!i&&t.showPoint(null),o=e.featureDetails},!0)}}}]).directive("expPointInspector",["pointService","flashService","$rootScope","$filter",function(e,n,o,i){var a={actions:[],visible:!0,modal:!1,minWidth:240,title:"Features within approx 2km",position:{top:140,left:40}};return{restrict:"AE",templateUrl:"map/point/point.html",scope:!0,controller:["$scope",function(e){e.options?e.windowOptions=t.extend({},a,scope.options):e.windowOptions=t.extend({},a)}],link:function(t,n){function a(n){t.featuresInfo=n,e.createLayer()}o.$on("map.point.changed",function(n,o){t.point=o,e.removeLayer(),t.changePoint(o),o&&e.getMetaData().then(function(e){t.metadata=e.data})}),t.createTitle=function(){var t=!this.greaterThanOneItem(),e=this.feature.layerName,n=this.metadata[e],o=n.preferredLabel,i=this.feature.attributes[o];return!t&&i&&"Null"!=i?i:n.label},t.changePoint=function(t){e.moveMarker(t),t&&e.getInfo(t).then(function(t){a(t)}),e.removeLayer()},t.clearPoint=function(){t.point=!1,e.removeLayer(),e.removeMarker()},t.toggleShow=function(){this.feature.displayed=!this.feature.displayed,this.feature.displayed?this.feature.feature=e.showFeature(this.feature):(e.hideFeature(this.feature.feature),this.feature.layer=null)},t.oneShowing=function(){var e=i("filterGroupsByLayername")(t.featuresInfo.results,this.item),n=!1;return e.forEach(function(t){n|=t.displayed}),n},t.greaterThanOneItem=function(){return i("filterGroupsByLayername")(t.featuresInfo.results,this.item).length>1},t.groupShow=function(){var n=i("filterGroupsByLayername")(t.featuresInfo.results,this.item),o=!1;n.forEach(function(t){o|=t.displayed}),n.forEach(function(t){o?(t.feature=e.hideFeature(t.feature),t.displayed=!1):(t.feature=e.showFeature(t),t.displayed=!0)})},t.allHidden=function(){var t=!0;return this.featuresInfo&&this.featuresInfo.results&&this.featuresInfo.results.forEach(function(e){t&=!e.displayed}),t},t.toggleAll=function(){var n=t.allHidden();this.featuresInfo.results.forEach(function(t){n?t.displayed||(t.displayed=!0,t.feature=e.showFeature(t)):t.displayed&&(t.displayed=!1,t.feature=e.hideFeature(t.feature))})},t.elevationPath=function(t){this.feature.feature||(this.feature.feature=e.createFeature(this.feature)),e.triggerElevationPlot(this.feature.feature[0],t)}}}}]).factory("pointService",["httpData","$q","configService","mapService","$rootScope",function(o,i,a,r,s){var l="service/path/featureInfo",c=null,u={esriGeometryPoint:{createFeatures:function(t){var n=[t.y,t.x];return[e.circleMarker(n)]},type:"x,y"},esriGeometryPolyline:{createFeatures:function(t){var n=[];return t.paths.forEach(function(t){var o=[];t.forEach(function(t){o.push([t[1],t[0]])}),n.push(e.polyline(o))}),n},type:"paths"},esriGeometryPolygon:{createFeatures:function(t){var n,o=[];return t.rings.forEach(function(t){var e=[];t.forEach(function(t){e.push([t[1],t[0]])}),o.push(e)}),n=e.multiPolygon(o),[n]},type:"rings"}},h=o.baseUrlForPkg("ga-explorer-map")+"resources/point/pointMetadata.json",p=null,f=null,d=[];return{triggerElevationPlot:function(t,e){var n=t.getLength();s.$broadcast("elevation.plot.data",{length:n,geometry:t.getLatLngs(),heading:e})},addMapListener:function(t,e){var n=!1;d.forEach(function(o){o.callback==t&&o.bound==e&&(n=!0)}),n||d.push({callback:t,bound:e}),f||(f=!0,r.getMap().then(function(t){t.on("click",function(t){d.forEach(function(e){var n=e.callback,o={x:t.latlng.lng,y:t.latlng.lat};o.lat=o.y,o.lng=o.x,e.bound&&n.bind(e.bound),n(o)})})}))},getMetaData:function(){return o.get(h,{cache:!0})},moveMarker:function(t){r.getMap().then(function(n){p&&n.removeLayer(p),p=t?e.marker(t).addTo(n):null})},removeMarker:function(){p&&r.getMap().then(function(t){t.removeLayer(p),p=null})},showPoint:function(t){s.$broadcast("map.point.changed",t)},removePoint:function(){s.$broadcast("map.point.changed",null)},getBehaviour:function(t){},getInfo:function(t){return r.getMap().then(function(e){var i=e._container.getBoundingClientRect(),r=n.devicePixelRatio?n.devicePixelRatio:1,s=e.getBounds();return a.getConfig("clientSessionId").then(function(e){return o.post(l,{clientSessionId:e,x:t.x,y:t.y,width:i.width/r,height:i.height/r,extent:{left:s.left,right:s.right,top:s.top,bottom:s.bottom}}).then(function(t){return t.data})})})},overFeatures:function(e){var n;e&&(n=t.isArray(e)?e[0]:e,n&&n.bringToFront().setStyle({color:"red"}))},outFeatures:function(t){t&&t.forEach(function(t){t.setStyle({color:"#03f"})})},createLayer:function(){return r.getMap().then(function(t){return c=e.layerGroup(),t.addLayer(c),c})},removeLayer:function(){return r.getMap().then(function(t){return c&&t.removeLayer(c),c=null})},createFeature:function(t){return u[t.geometryType].createFeatures(t.geometry)},showFeature:function(t){var e=this.createFeature(t);return e.forEach(function(t){c.addLayer(t)}),e},hideFeature:function(t){t&&t.forEach(function(t){c.removeLayer(t)})}}}]).filter("dashNull",[function(){return function(t){return t&&"Null"!=t?t:"-"}}]).filter("featureGroups",[function(){return function(t){var e=[],n={};return t?(t.forEach(function(t){var o=t.layerName;n[o]||(n[o]=!0,e.push(o))}),e):e}}]).filter("filterGroupsByLayername",[function(){return function(t,e){var n=[];return t?(t.forEach(function(t){e==t.layerName&&n.push(t)}),n):n}}]).controller("OverFeatureCtrl",["$filter","pointService",function(t,e){this.click=function(){},this.mouseenter=function(t){e.overFeatures(t.feature)},this.mouseleave=function(t){e.outFeatures(t.feature)},this.groupEnter=function(n,o){var i=t("filterGroupsByLayername")(n,o);i.forEach(function(t){e.overFeatures(t.feature)})},this.groupLeave=function(n,o){var i=t("filterGroupsByLayername")(n,o);i.forEach(function(t){e.outFeatures(t.feature)})}}])}(angular,L,window),function(t){"use strict";t.Control.Features=t.Control.extend({_active:!1,_map:null,includes:t.Mixin.Events,options:{position:"topleft",className:"fa fa-location-arrow fa-rotate-180",modal:!1},onAdd:function(e){this._map=e,this._container=t.DomUtil.create("div","leaflet-feature-control leaflet-bar"),this._container.title="Show features under point";var n=t.DomUtil.create("a",this.options.className,this._container);return n.href="#",t.DomEvent.on(this._container,"dblclick",t.DomEvent.stop).on(this._container,"click",t.DomEvent.stop).on(this._container,"click",function(n){this._active=!this._active,this._active?(e.fireEvent("featuresactivate",n),t.DomUtil.addClass(this,"active")):(e.fireEvent("featuresdeactivate",n),t.DomUtil.removeClass(this,"active"))}),this._container},activate:function(){t.DomUtil.addClass(this._container,"active")},deactivate:function(){t.DomUtil.removeClass(this._container,"active"),this._active=!1}}),t.control.features=function(e){return new t.Control.Features(e)}}(L),L.Google=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1,mapOptions:{backgroundColor:"#dddddd"}},initialize:function(t,e){L.Util.setOptions(this,e),this._ready=void 0!==google.maps.Map,this._ready||L.Google.asyncWait.push(this),this._type=t||"SATELLITE"},onAdd:function(t,e){this._map=t,this._insertAtTheBottom=e,this._initContainer(),this._initMapObject(),t.on("viewreset",this._resetCallback,this),this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this),t.on("move",this._update,this),t.on("zoomanim",this._handleZoomAnim,this),t._controlCorners.bottomright.style.marginBottom="20px",this._reset(),this._update()},onRemove:function(t){t._container.removeChild(this._container),t.off("viewreset",this._resetCallback,this),t.off("move",this._update,this),t.off("zoomanim",this._handleZoomAnim,this),t._controlCorners.bottomright.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(t){this.options.opacity=t,t<1&&L.DomUtil.setOpacity(this._container,t)},setElementSize:function(t,e){t.style.width=e.x+"px",t.style.height=e.y+"px"},_initContainer:function(){var t=this._map._container,e=t.firstChild;this._container||(this._container=L.DomUtil.create("div","leaflet-google-layer leaflet-top leaflet-left"),this._container.id="_GMapContainer_"+L.Util.stamp(this),this._container.style.zIndex="auto"),t.insertBefore(this._container,e),this.setOpacity(this.options.opacity),this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(this._ready){this._google_center=new google.maps.LatLng(0,0);var t=new google.maps.Map(this._container,{center:this._google_center,zoom:0,tilt:0,mapTypeId:google.maps.MapTypeId[this._type],disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:this.options.mapOptions.styles,backgroundColor:this.options.mapOptions.backgroundColor}),e=this;this._reposition=google.maps.event.addListenerOnce(t,"center_changed",function(){e.onReposition()}),this._google=t,google.maps.event.addListenerOnce(t,"idle",function(){e._checkZoomLevels()}),this.fire("MapObjectInitialized",{mapObject:t})}},_checkZoomLevels:function(){this._google.getZoom()!==this._map.getZoom()&&this._map.setZoom(this._google.getZoom())},_resetCallback:function(t){this._reset(t.hard)},_reset:function(t){this._initContainer()},_update:function(t){if(this._google){this._resize();var e=this._map.getCenter(),n=new google.maps.LatLng(e.lat,e.lng);this._google.setCenter(n),this._google.setZoom(Math.round(this._map.getZoom())),this._checkZoomLevels()}},_resize:function(){var t=this._map.getSize();this._container.style.width===t.x&&this._container.style.height===t.y||(this.setElementSize(this._container,t),this.onReposition())},_handleZoomAnim:function(t){var e=t.center,n=new google.maps.LatLng(e.lat,e.lng);this._google.setCenter(n),this._google.setZoom(Math.round(t.zoom))},onReposition:function(){this._google&&google.maps.event.trigger(this._google,"resize")}}),L.Google.asyncWait=[],L.Google.asyncInitialize=function(){var t;for(t=0;t<L.Google.asyncWait.length;t++){var e=L.Google.asyncWait[t];e._ready=!0,e._container&&(e._initMapObject(),e._update())}L.Google.asyncWait=[]},function(t){"use strict";t.Control.Legend=t.Control.extend({_active:!1,_map:null,includes:t.Mixin.Events,options:{position:"topleft",overlayClass:"leaflet-legend",className:"fa fa-list",modal:!1,url:"resources/img/NationalLegend.png"},onAdd:function(e){var n=this;this._map=e,this._container=t.DomUtil.create("div","leaflet-legend-control leaflet-bar"),this._container.title="Show legend";var o=t.DomUtil.create("a",this.options.className,this._container);return o.href="#",t.DomEvent.on(this._container,"dblclick",t.DomEvent.stop).on(this._container,"click",t.DomEvent.stop).on(this._container,"click",function(){n._active=!n._active,n._active?(n._legend=t.control({position:"topleft"}),n._legend.onAdd=function(e){var o=t.DomUtil.create("div",n.options.overlayClass),i='<img src="'+n.options.url+'"></img>';return t.DomEvent.disableClickPropagation(o).disableScrollPropagation(o).on(o,"keydown",function(t){function e(t){t.stopPropogation(),t.preventDefault()}24==t.keyCode?(this.scrollTop-=20,e(t)):25==t.keyCode&&(this.scrollTop+=20,e(t))}),o.innerHTML=i,o.tabIndex=0,o.focus(),o},e.addControl(n._legend),t.DomUtil.addClass(n._container,"active")):(e.removeControl(n._legend),t.DomUtil.removeClass(n._container,"active"))}),this._container},activate:function(){t.DomUtil.addClass(this._container,"active")},deactivate:function(){t.DomUtil.removeClass(this._container,"active"),this._active=!1}}),t.control.legend=function(e){return new t.Control.Legend(e)}}(L),L.Control.MousePosition=L.Control.extend({options:{position:"bottomleft",separator:" : ",emptyString:"Unavailable",lngFirst:!1,numDigits:5,elevGetter:void 0,lngFormatter:void 0,latFormatter:void 0,prefix:""},onAdd:function(t){return this._container=L.DomUtil.create("div","leaflet-control-mouseposition"),L.DomEvent.disableClickPropagation(this._container),t.on("mousemove",this._onMouseMove,this),this._container.innerHTML=this.options.emptyString,this._container},onRemove:function(t){t.off("mousemove",this._onMouseMove)},_onMouseHover:function(){var t=this._hoverInfo;this._hoverInfo=void 0,this.options.elevGetter(t).then(function(t){this._hoverInfo||(this._container.innerHTML=this.options.prefix+" "+t+" "+this._latLngValue)}.bind(this))},_onMouseMove:function(t){var e=t.latlng.wrap();lng=this.options.lngFormatter?this.options.lngFormatter(e.lng):L.Util.formatNum(e.lng,this.options.numDigits),lat=this.options.latFormatter?this.options.latFormatter(e.lat):L.Util.formatNum(e.lat,this.options.numDigits),this._latLngValue=this.options.lngFirst?lng+this.options.separator+lat:lat+this.options.separator+lng,this.options.elevGetter&&(this._hoverInfo&&window.clearTimeout(this._hoverInfo.timeout),this._hoverInfo={lat:e.lat,lng:e.lng,timeout:window.setTimeout(this._onMouseHover.bind(this),400)}),this._container.innerHTML=this.options.prefix+" "+this._latLngValue}}),L.Map.mergeOptions({positionControl:!1}),L.Map.addInitHook(function(){this.options.positionControl&&(this.positionControl=new L.Control.MousePosition,this.addControl(this.positionControl))}),L.control.mousePosition=function(t){return new L.Control.MousePosition(t)},L.Control.ZoomBox=L.Control.extend({_active:!1,_map:null,includes:L.Mixin.Events,options:{position:"topleft",className:"fa fa-search-plus",modal:!1},onAdd:function(t){this._map=t,this._container=L.DomUtil.create("div","leaflet-zoom-box-control leaflet-bar"),this._container.title="Zoom to specific area";var e=L.DomUtil.create("a",this.options.className,this._container);e.href="#";var n=t.boxZoom._onMouseDown;return t.boxZoom._onMouseDown=function(e){n.call(t.boxZoom,{clientX:e.clientX,clientY:e.clientY,which:1,shiftKey:!0})},t.on("zoomend",function(){t.getZoom()==t.getMaxZoom()?L.DomUtil.addClass(e,"leaflet-disabled"):L.DomUtil.removeClass(e,"leaflet-disabled")},this),this.options.modal||t.on("boxzoomend",this.deactivate,this),L.DomEvent.on(this._container,"dblclick",L.DomEvent.stop).on(this._container,"click",L.DomEvent.stop).on(this._container,"click",function(){this._active=!this._active,this._active&&t.getZoom()!=t.getMaxZoom()?this.activate():this.deactivate()},this),this._container},activate:function(){L.DomUtil.addClass(this._container,"active"),this._map.dragging.disable(),this._map.boxZoom.addHooks(),L.DomUtil.addClass(this._map.getContainer(),"leaflet-zoom-box-crosshair")},deactivate:function(){L.DomUtil.removeClass(this._container,"active"),this._map.dragging.enable(),this._map.boxZoom.removeHooks(),L.DomUtil.removeClass(this._map.getContainer(),"leaflet-zoom-box-crosshair"),this._active=!1,this._map.boxZoom._moved=!1}}),L.control.zoomBox=function(t){return new L.Control.ZoomBox(t)},L.Control.Zoommin=L.Control.extend({_active:!1,_map:null,includes:L.Mixin.Events,options:{position:"topleft",className:"fa fa-home",modal:!1},onAdd:function(t){this._map=t,this._container=L.DomUtil.create("div","leaflet-zoom-box-control leaflet-bar"),this._container.title="Zoom to max extent";var e=L.DomUtil.create("a",this.options.className,this._container);return e.href="#",L.DomEvent.on(this._container,"dblclick",L.DomEvent.stop).on(this._container,"click",L.DomEvent.stop).on(this._container,"click",function(){this._active=!this._active,t.setView(this.options.center,this.options.zoom)},this),this._container},activate:function(){L.DomUtil.addClass(this._container,"active")},deactivate:function(){L.DomUtil.removeClass(this._container,"active"),this._active=!1}}),L.control.zoommin=function(t){return new L.Control.Zoommin(t)},L.Control.Zoomout=L.Control.extend({_active:!1,_map:null,includes:L.Mixin.Events,options:{position:"topleft",className:"fa fa-search-minus",modal:!1},onAdd:function(t){this._map=t,this._container=L.DomUtil.create("div","leaflet-zoom-box-control leaflet-bar"),this._container.title="Zoom out";var e=L.DomUtil.create("a",this.options.className,this._container);return e.href="#",t.on("zoomend",function(){t.getZoom()==t.getMaxZoom()?L.DomUtil.addClass(e,"leaflet-disabled"):L.DomUtil.removeClass(e,"leaflet-disabled")},this),t.on("boxzoomend",this.deactivate,this),L.DomEvent.on(this._container,"dblclick",L.DomEvent.stop).on(this._container,"click",L.DomEvent.stop).on(this._container,"click",function(){this._active=!this._active;var e,n=t.getZoom();n<=t.getMinZoom()||(e=n<10?n-1:n<13?n-2:n-3,t.setZoom(e))},this),this._container},activate:function(){L.DomUtil.addClass(this._container,"active")},deactivate:function(){L.DomUtil.removeClass(this._container,"active"),this._active=!1}}),L.control.zoomout=function(t){return new L.Control.Zoomout(t)},function(t){t.Polyline.prototype.getLength=function(){var t=0,e=null;return this._latlngs.forEach(function(n,o,i){e=n,o&&(t+=e.distanceTo(i[o-1]))}),t}}(L),function(t,e,n){"use strict";t.module("geo.map",[]).directive("geoMap",["mapService","waiting",function(t,e){var n;return{restrict:"AE",scope:{configuration:"="},controller:["$q","$scope",function(t,o){this.getMap=function(){return o.map?void t.when(o.map):(n||(n=e.wait()),n.waiter().promise)}}],link:function(e,o){e.$watch("configuration",function(i){i&&(i.element=o[0],e.map=t.addMap(i),n&&n.resolve(e.map))})}}}]).factory("mapService",["$injector","$filter","$q","$rootScope","waiting",function(o,i,a,r,s){function l(t,n,o){var i=c(t);i.pseudoBaseLayer=t.pseudoBaseLayer,t.addLayerControl&&(f||(f={}),f[t.name]=i),(t.defaultLayer||t.pseudoBaseLayer)&&n.addLayer(i),f&&o.addControl(new e.Control.Layers(f,{})),t.layer=i}function c(n){var o=[];if(t.isArray(n.type)?(o=e,n.type.forEach(function(t){o=o[t]})):o=e[n.type],n.parameters&&n.parameters.length>0){var i=n.parameters[1];return i&&(i=u(i)),new o(n.parameters[0],i,n.parameters[2],n.parameters[3],n.parameters[4])}return new o}function u(n){if(n.bounds&&t.isArray(n.bounds)){var o=n.bounds,i=o[0],a=o[1];t.isArray(i)&&t.isArray(a)&&(n.bounds=e.latLngBounds(o))}return n}var h,p,f,d,g="MAP_",m=0,v={},y={maps:{}};return y.getMap=function(t){return t||(t=h),h?a.when(y.maps[t]):(p||(p=s.wait()),p.waiter().promise)},y.addToGroup=function(t,e){this.getMap().then(function(n){var o=v[e];o&&l(t,o,n)})},y.getGroup=function(t){return v[t]},y.clearGroup=function(t){var e=v[t],n=e.getLayers();n.forEach(function(t){e.removeLayer(t)})},y.removeFromGroup=function(t,e){var n=v[e];n&&(n.removeLayer(t.layer),t.layer=null)},y.getGridLayer=function(){return d},y.addMap=function(t){var a,r=null;t.name||(t.name=g+m++),h=t.name,a=y.maps[t.name]=new e.Map(t.element,{center:t.options.center,zoom:t.options.zoom,zoomControl:!t.options.noZoomControl,maxZoom:t.options.maxZoom,minZoom:t.options.minZoom}),t.gridLayer&&(t.gridLayer.name="Grid",d=c(t.gridLayer)),t.layers&&t.layers.forEach(function(t){var n;"LayerGroup"===t.type?t.layers&&(v[t.name]=n=e.layerGroup([]),t.layers.forEach(function(t){l(t,a,n)}),a.addLayer(n)):(l(t,a,a),t.pseudoBaseLayer&&t.legendUrl&&(r={url:t.legendUrl}))});var s;try{var u=o.get("elevationPointService");u&&u.getElevation&&(s=function(t){return u.getElevation(t).then(function(t){return null===t?"":"Elev "+i("length")(Math.round(t),!0)+" : "})})}catch(f){console.log("No elevation point service available")}return e.control.scale({imperial:!1}).addTo(a),e.control.mousePosition({position:"bottomright",emptyString:"",seperator:" ",elevGetter:s,latFormatter:function(t){return"Lat "+e.Util.formatNum(t,5)+"°"},lngFormatter:function(t){return"Lng "+e.Util.formatNum(t%180,5)+"°"}}).addTo(a),t.options.noZoomControl||e.control.zoomBox({}).addTo(a),n.map=a,p&&p.resolve(a),r&&a.addControl(e.control.legend(r)),a},y}])}(angular,L,window),angular.module("explorer.map.templates",[]).run(["$templateCache",function(t){t.put("map/elevation/elevation.html",'<div class="container-full elevationContainer" ng-show="geometry" style="background-color:white; opacity:0.9;padding:2px">\r\n\t<div class="row">\r\n\t\t<div class="col-md-4">\r\n\t\t\t<span class="graph-brand">Path Elevation</span>\r\n\t\t</div>\t\r\n\t\t<div class="col-md-8">\r\n\t\t\t<div class="btn-toolbar pull-right" role="toolbar" style="margin-right: 3px;">\r\n\t\t\t\t<div class="btn-group" ng-show="intersectsWaterTable">\t\r\n\t\t\t\t\t<button type="button" class="btn btn-default" ng-click="toggleWaterTable()" \r\n\t\t\t\t\t\t\ttitle="Show groundwater over elevation">{{paths.length == 1?\'Show\':\'Hide\'}} Water Table</button>\r\n\t\t\t\t</div>\t\r\n\t\t\t\t<div class="btn-group">\t\r\n\t\t\t\t\t<button type="button" class="btn btn-default" title="Find out information about the data behind these graphs" \r\n\t\t\t\t\t\t\tng-click="showInfo = !showInfo">\r\n\t\t\t\t\t\t<i class="fa fa-info-circle" role="presentation" style="font-size:16px; color:black"></i>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<exp-info title="Graph Information" style="width:400px;position:absolute;bottom:-80px;right:60px" show-close="true" is-open="showInfo"><div mars-info-elevation></div></exp-info>\t\t\t\t\r\n\t\t\t\t\t<button type="button" class="btn btn-default" title="Close graphs" ng-click="close()">\r\n\t\t\t\t\t\t<i class="fa fa-times-circle" role="presentation" style="font-size:16px; color:black"></i>\r\n\t\t\t\t\t</button>\t\t\t\t\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\t\r\n\t</div>\r\n\t<div explorer-graph data="paths" config="config" click="graphClick(event)" move="graphMove(event)" leave="graphLeave(event)" enter="graphEnter(event)" show-zero-line="true"></div>\r\n\t<div exp-point-features features="featuresUnderPoint" class="featuresUnderPoint"></div>\r\n\t<div exp-point point="point" class="featuresInfo" style="display:none"></div>\r\n\t<div class="elevationHoverPanel" mars-point-info ng-show="position"\r\n\t\tng-attr-style="top:{{position.pageY - 70}}px;left:{{position.pageX * 0.94 - 10}}px;">\r\n\t\t<div class="ng-binding"><strong>Elev.:</strong>{{position.point.z|number:0}}m</div>\r\n\t\t<div class="ng-binding"><strong>Dist.:</strong>{{length * position.percentX * 0.01|length : true }}</div>\r\n\t</div>\r\n\t</div>\r\n</div>'),
t.put("map/elevation/elevationInfo.html",'<div>\r\nThe elevation graph is calculated from the 3" DEM data. \r\nThe data is held in a grid with a cell size of approx. 90 m. \r\nThe data has a &plusmn;5 m error. Full metadata about the data and how to acquire the data can be found \r\n<a target="_blank" href="http://www.ga.gov.au/metadata-gateway/metadata/record/gcat_aac46307-fce9-449d-e044-00144fdd4fa6">here</a>\r\n<br/>\r\nIf the path of the graph intersects areas that we have prepared water table data there will be the ability to plot this data. \r\nThe accuracy is not as high as the elevation data and has &plusmn;50 m error. Smoothing with this error can make the \r\nwater table appear above the elevation of the surface on occasions. \r\nData availability will be indicated by the button labelled "Show Water Table". \r\n<a href="javascript:;" ng-click="toggleWaterTableShowing()">Click to {{state.isWaterTableShowing?\'hide\':\'view\'}} the water table extent.</a>\r\n</div>\r\n'),t.put("map/featuresummary/featuresSummary.html",'<div class="marsfeatures" ng-show="features" ng-style="featurePanelPosition()" ng-class="features.popupClass">\r\n\t<div id="menu_mn_active_tt_active" data-role="popup" role="tooltip">\r\n\t\t<div class="pathContent">\r\n\t\t\t<div ng-repeat="(key, feature) in features.data">\r\n\t\t\t\t{{mappings[key].title}}  ({{feature}})\r\n\t\t\t</div>\r\n\t\t\t<div ng-hide="features.count">No nearby features</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),t.put("map/layerinspector/layerInspector.html",'<div class="interactionPanel">\r\n\t<div class="exp-block" ng-show="active" style="height:100%">\r\n\t\t<div class="exp-header">\r\n\t\t\t<div class="interactionPanelHeader" ng-hide="hidename">\r\n\t\t\t\t<a href="javascript:;" ng-click="click()" ng-show="showClose" title="Name is {{name || active.name}}">{{name || active.name}}</a>\r\n\t\t\t\t<span ng-hide="showClose">{{name || active.name}}</span>\r\n\t\t\t</div>\r\n\t\t\t<div style="float:right">\r\n\t\t\t\t<a class="featureLink" href="javascript:;" title="Show on map" \r\n\t\t\t\t\t\tng-click="toggleShow(active)"><i class="fa" ng-class="{\'fa-eye-slash\':(!active.displayed), \'fa-eye\':active.displayed}"></i></a>\r\n\t\t\t\t<a class="featureLink" href="javascript:;" title="Collapse extra information" ng-show="showClose"\r\n\t\t\t\t\t\tng-click="click()"><i class="fa fa-caret-square-o-up"></i></a>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div>\r\n\t\t\t<div class="thumbNailContainer" ng-show="active.thumbUrl">\r\n\t\t\t\t<img width="100" ng-src="{{active.thumbUrl}}" class="img-thumbnail" alt="{{active.description}}"></img>\r\n\t\t\t</div>\r\n\t\t\t<strong>Opacity</strong><br/>\r\n\t\t\t<span explorer-layer-slider layer="active.layer" title="Change the opacity of the selected layer when shown on the map" class="opacitySlider"></span>\r\n\t\t\t<p/>\r\n\t\t\t{{active.description}}\r\n\t\t</div> \r\n\t</div>\r\n</div>'),t.put("map/point/point.html",'<exp-modal class="pointInspector ng-cloak" icon-class="fa-map-marker" is-open="point" on-close="clearPoint()" title="Features within approx. 2km">\t\r\n\t<div class="pointContent" ng-controller="OverFeatureCtrl as over">\r\n\t\t<div style="padding-bottom:7px;">Elev. {{point.z | length : true}}, Lat. {{point.y | number : 3}}&deg;, Long. {{point.x | number:3}}&deg;</div>\r\n\t\t<div ng-show="featuresInfo.results.length > 0">\r\n\t\t\t<div>\r\n\t\t\t\t<div style="float:left; padding-bottom:10px">{{allHidden() && "Show" || "Hide"}} all features</div>\r\n\t\t\t\t<div style="float: right">\t\t\t\t\r\n\t\t\t\t\t<a class="featureLink" href="javascript:;" title="Show all features on map"\r\n\t\t\t\t\t\tng-click="toggleAll()"><i class="fa" ng-class="{\'fa-eye-slash\':allHidden(), \'fa-eye\':!allHidden()}"></i></a>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div style="clear:both;"></div>\r\n\t\t</div>\r\n\t\t<div ng-hide="featuresInfo.results.length > 0">No nearby features.</div>\r\n\t\r\n\t\t<div ng-repeat="item in featuresInfo.results | featureGroups" ng-class="{\'underlined\':!$last}">\r\n\t\t\t<div ng-show="greaterThanOneItem()"  ng-mouseover="over.groupEnter(featuresInfo.results, item)" ng-mouseout="over.groupLeave(featuresInfo.results, item)">\r\n\t\t\t\t<div style="float:left">\r\n\t\t\t\t\t<button type="button" class="undecorated" ng-click="expanded = !expanded"><i class="fa fa-caret-right pad-right" ng-class="{\'fa-caret-down\':expanded,\'fa-caret-right\':(!expanded)}"></i></button></button><strong>{{metadata[item].heading}}</strong>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style="float: right">\t\r\n\t\t\t\t\t<a class="featureLink" href="javascript:;" title="Show on map"   \r\n\t\t\t\t\t\tng-click="groupShow(item)"><i class="fa" ng-class="{\'fa-eye-slash\':(!oneShowing()), \'fa-eye\':oneShowing()}"></i></a>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style="clear:both;"></div>\r\n\t\t\t</div>\r\n\t\t\t<div ng-repeat="feature in featuresInfo.results | filterGroupsByLayername : item" ng-show="expanded || !greaterThanOneItem()">\r\n\t\t\t\t<div ng-mouseover="over.mouseenter(feature)" ng-mouseout="over.mouseleave(feature)" ng-click="over.click()">\r\n\t\t\t\t\t<div style="float: left;" ng-class="{\'pad-left-big\':greaterThanOneItem()}">\r\n\t\t\t\t\t\t<button type="button" ng-click="feature.expanded = !feature.expanded" class="undecorated"><i class="fa fa-caret-right pad-right" ng-class="{\'fa-caret-down\':feature.expanded,\'fa-caret-right\':(!feature.expanded)}"></i></button>\r\n\t\t\t\t\t\t<a href="javascript:;" class="featureLink" title="{{metadata[feature.layerName].description}}"\r\n\t\t\t\t\t\t\tng-click="makeFeatureActive()" ng-class="{active:(feature.active)}">{{createTitle()}}</a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div style="float: right">\t\r\n\t\t\t\t\t\t<a class="featureLink" href="javascript:;" title="Graph elevation changes for feature\'s path."\r\n\t\t\t\t\t\t\tng-click="elevationPath(metadata[feature.layerName].label + \' elevation plot\')"><i class="fa fa-align-left fa-rotate-270" ng-show="feature.geometryType == \'esriGeometryPolyline\'"></i></a>\t\t\t\t\t\r\n\t\t\t\t\t\t<a class="featureLink" href="javascript:;" title="Show on map"\r\n\t\t\t\t\t\t\tng-click="toggleShow(feature)"><i class="fa" ng-class="{\'fa-eye-slash\':(!feature.displayed), \'fa-eye\':feature.displayed}"></i> </a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style="clear:both;" ng-init="featureMeta = metadata[feature.layerName]">\r\n\t\t\t\t\t<div ng-repeat="attribute in featureMeta.attributes" ng-show="feature.expanded">\r\n\t\t\t\t\t\t<div style="width:7em;float:left;font-weight:bold;padding-left:9px">{{attribute.label}}</div>\r\n\t\t\t\t\t\t<div style="min-width:12em;width:12em;margin-left:7.5em;" class="ellipsis" title="{{feature.attributes[attribute.key]}}">{{feature.attributes[attribute.key] | dashNull}}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div style="border-bottom:1px solid lightgray" ng-show="feature.expanded && !last"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\t\r\n\t\t</div>\r\n\t</div>\r\n</exp-modal>')}]);